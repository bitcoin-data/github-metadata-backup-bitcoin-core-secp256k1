{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028",
    "id": 794616943,
    "node_id": "PR_kwDOAP4Jqs4vXORv",
    "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1028",
    "diff_url": "https://github.com/bitcoin-core/secp256k1/pull/1028.diff",
    "patch_url": "https://github.com/bitcoin-core/secp256k1/pull/1028.patch",
    "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1028",
    "commits_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1028/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin-core/secp256k1/statuses/8932956fe553235d4b0789e7bd82ff0bee59335d",
    "number": 1028,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Faster const-time normalization",
    "user": {
      "login": "peterdettman",
      "id": 3423981,
      "node_id": "MDQ6VXNlcjM0MjM5ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/peterdettman",
      "html_url": "https://github.com/peterdettman",
      "followers_url": "https://api.github.com/users/peterdettman/followers",
      "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
      "organizations_url": "https://api.github.com/users/peterdettman/orgs",
      "repos_url": "https://api.github.com/users/peterdettman/repos",
      "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/peterdettman/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Use a \"borrowing\" trick in _fe_normalize  to simplify the handling of values in [P, 2^256). This is significantly faster too (according to bench_internal), though performance of _fe_normalize isn't that important.\r\n\r\nApplying a similar idea to _fe_normalizes_to_zero also results in a performance boost, and in this case it appears to boost signing speed by 2% or more (also ECDH), due to three calls in _gej_add_ge.",
    "labels": [
      {
        "id": 4975389731,
        "node_id": "LA_kwDOAP4Jqs8AAAABKI5sIw",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/labels/performance",
        "name": "performance",
        "description": "",
        "color": "DE3CCC",
        "default": false
      }
    ],
    "created_at": "2021-12-03T13:58:30Z",
    "updated_at": "2023-05-11T17:46:46Z",
    "mergeable": true,
    "mergeable_state": "clean",
    "merge_commit_sha": "1b00173f9d06add7fe0108725ceca52f98af243c",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "peterdettman:opt_normalize",
      "ref": "opt_normalize",
      "sha": "8932956fe553235d4b0789e7bd82ff0bee59335d",
      "user": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 19929656,
        "node_id": "MDEwOlJlcG9zaXRvcnkxOTkyOTY1Ng==",
        "name": "secp256k1",
        "full_name": "peterdettman/secp256k1",
        "owner": {
          "login": "peterdettman",
          "id": 3423981,
          "node_id": "MDQ6VXNlcjM0MjM5ODE=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/peterdettman",
          "html_url": "https://github.com/peterdettman",
          "followers_url": "https://api.github.com/users/peterdettman/followers",
          "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
          "organizations_url": "https://api.github.com/users/peterdettman/orgs",
          "repos_url": "https://api.github.com/users/peterdettman/repos",
          "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/peterdettman/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/peterdettman/secp256k1",
        "description": "Optimized C library for EC operations on curve secp256k1",
        "fork": true,
        "url": "https://api.github.com/repos/peterdettman/secp256k1",
        "archive_url": "https://api.github.com/repos/peterdettman/secp256k1/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/peterdettman/secp256k1/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/peterdettman/secp256k1/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/peterdettman/secp256k1/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/peterdettman/secp256k1/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/peterdettman/secp256k1/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/peterdettman/secp256k1/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/peterdettman/secp256k1/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/peterdettman/secp256k1/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/peterdettman/secp256k1/contributors",
        "deployments_url": "https://api.github.com/repos/peterdettman/secp256k1/deployments",
        "downloads_url": "https://api.github.com/repos/peterdettman/secp256k1/downloads",
        "events_url": "https://api.github.com/repos/peterdettman/secp256k1/events",
        "forks_url": "https://api.github.com/repos/peterdettman/secp256k1/forks",
        "git_commits_url": "https://api.github.com/repos/peterdettman/secp256k1/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/peterdettman/secp256k1/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/peterdettman/secp256k1/git/tags%7B/sha%7D",
        "git_url": "git://github.com/peterdettman/secp256k1.git",
        "issue_comment_url": "https://api.github.com/repos/peterdettman/secp256k1/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/peterdettman/secp256k1/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/peterdettman/secp256k1/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/peterdettman/secp256k1/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/peterdettman/secp256k1/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/peterdettman/secp256k1/languages",
        "merges_url": "https://api.github.com/repos/peterdettman/secp256k1/merges",
        "milestones_url": "https://api.github.com/repos/peterdettman/secp256k1/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/peterdettman/secp256k1/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/peterdettman/secp256k1/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/peterdettman/secp256k1/releases%7B/id%7D",
        "ssh_url": "git@github.com:peterdettman/secp256k1.git",
        "stargazers_url": "https://api.github.com/repos/peterdettman/secp256k1/stargazers",
        "statuses_url": "https://api.github.com/repos/peterdettman/secp256k1/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/peterdettman/secp256k1/subscribers",
        "subscription_url": "https://api.github.com/repos/peterdettman/secp256k1/subscription",
        "tags_url": "https://api.github.com/repos/peterdettman/secp256k1/tags",
        "teams_url": "https://api.github.com/repos/peterdettman/secp256k1/teams",
        "trees_url": "https://api.github.com/repos/peterdettman/secp256k1/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/peterdettman/secp256k1.git",
        "hooks_url": "https://api.github.com/repos/peterdettman/secp256k1/hooks",
        "svn_url": "https://github.com/peterdettman/secp256k1",
        "language": "C",
        "forks_count": 0,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 9530,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2022-04-20T06:00:57Z",
        "created_at": "2014-05-19T04:58:16Z",
        "updated_at": "2022-01-01T06:09:08Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin-core:master",
      "ref": "master",
      "sha": "485f608fa9e28f132f127df97136617645effe81",
      "user": {
        "login": "bitcoin-core",
        "id": 13464320,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjEzNDY0MzIw",
        "avatar_url": "https://avatars.githubusercontent.com/u/13464320?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin-core",
        "html_url": "https://github.com/bitcoin-core",
        "followers_url": "https://api.github.com/users/bitcoin-core/followers",
        "following_url": "https://api.github.com/users/bitcoin-core/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin-core/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin-core/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin-core/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin-core/orgs",
        "repos_url": "https://api.github.com/users/bitcoin-core/repos",
        "events_url": "https://api.github.com/users/bitcoin-core/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin-core/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 16648618,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNjY0ODYxOA==",
        "name": "secp256k1",
        "full_name": "bitcoin-core/secp256k1",
        "owner": {
          "login": "bitcoin-core",
          "id": 13464320,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjEzNDY0MzIw",
          "avatar_url": "https://avatars.githubusercontent.com/u/13464320?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin-core",
          "html_url": "https://github.com/bitcoin-core",
          "followers_url": "https://api.github.com/users/bitcoin-core/followers",
          "following_url": "https://api.github.com/users/bitcoin-core/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin-core/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin-core/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin-core/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin-core/orgs",
          "repos_url": "https://api.github.com/users/bitcoin-core/repos",
          "events_url": "https://api.github.com/users/bitcoin-core/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin-core/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin-core/secp256k1",
        "description": "Optimized C library for EC operations on curve secp256k1",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1",
        "archive_url": "https://api.github.com/repos/bitcoin-core/secp256k1/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin-core/secp256k1/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin-core/secp256k1/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin-core/secp256k1/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin-core/secp256k1/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin-core/secp256k1/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin-core/secp256k1/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin-core/secp256k1/downloads",
        "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/events",
        "forks_url": "https://api.github.com/repos/bitcoin-core/secp256k1/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin-core/secp256k1.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin-core/secp256k1/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin-core/secp256k1/languages",
        "merges_url": "https://api.github.com/repos/bitcoin-core/secp256k1/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin-core/secp256k1/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin-core/secp256k1/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin-core/secp256k1/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin-core/secp256k1.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin-core/secp256k1/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin-core/secp256k1/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin-core/secp256k1/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin-core/secp256k1/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin-core/secp256k1/tags",
        "teams_url": "https://api.github.com/repos/bitcoin-core/secp256k1/teams",
        "trees_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin-core/secp256k1.git",
        "hooks_url": "https://api.github.com/repos/bitcoin-core/secp256k1/hooks",
        "svn_url": "https://github.com/bitcoin-core/secp256k1",
        "language": "C",
        "forks_count": 962,
        "stargazers_count": 1802,
        "watchers_count": 1802,
        "size": 10374,
        "default_branch": "master",
        "open_issues_count": 145,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-08-01T01:00:35Z",
        "created_at": "2014-02-08T17:30:06Z",
        "updated_at": "2023-08-01T08:52:35Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 68,
    "deletions": 72,
    "changed_files": 2,
    "commits": 1,
    "review_comments": 2,
    "comments": 0
  },
  "events": [
    {
      "event": "reviewed",
      "id": 823383001,
      "node_id": "PRR_kwDOAP4Jqs4xE9PZ",
      "url": null,
      "actor": null,
      "commit_id": "4bbb6612dc0581ded87d911039729c4ec1a143c8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "This is a really nice idea! I just had one inline question.\r\n\r\n---\r\n\r\nThe updated versions of `fe_normalize` and `fe_normalizes_to_zero` indeed look faster, and a local benchmark run seems to agree:\r\n\r\n#### Benchmarks before\r\n```\r\nBenchmark                     ,    Min(us)    ,    Avg(us)    ,    Max(us)\r\n\r\nfield_normalize               ,     0.00968   ,     0.00973   ,     0.00983\r\ngroup_add_affine              ,     0.189     ,     0.196     ,     0.205\r\necdsa_sign                    ,    22.3       ,    22.7       ,    23.9\r\n```\r\n\r\n#### Benchmarks after\r\n```\r\nBenchmark                     ,    Min(us)    ,    Avg(us)    ,    Max(us)\r\n\r\nfield_normalize               ,     0.00752   ,     0.00756   ,     0.00763\r\ngroup_add_affine              ,     0.189     ,     0.189     ,     0.191\r\necdsa_sign                    ,    22.3       ,    22.4       ,    22.5\r\n```\r\n\r\n---\r\n\r\nI also wrote down some notes as I was trying to understand the change, and I'll post them here in case they're useful for future reference.\r\n\r\n#### Why it's not possible for the result to be in [P, 2^256)\r\n\r\nIf there's no final carry bit, then the second pass will subtract 2^256 - P from a value that's at most 2^256 - 1, resulting in a value that's at most P - 1.\r\n\r\nIf there *was* a carry, the largest possible value (not including the carry bit) is 65536 * 0x1000003D1 - 1 for 5x52 and 1024 * 0x1000003D1 - 1 for 10x26, both of which are well below P.\r\n\r\n(If there *was* a carry bit, clearing it is equivalent (mod P) to decrementing by 2^256 - P, which cancels out the increment before the first pass.)\r\n\r\n#### Where the 63-bit shift (in the 5x52 version) came from\r\n\r\nThe 64th bit is nonzero if and only if there was underflow after subtraction (2^256 - P is only a 33-bit value, so after subtracting it it's not possible to underflow so much that the 64th bit is still cleared afterwards).\r\n\r\nThus subtracting t >> 63 is the same logic as \"if subtraction on the previous limb caused an underflow then subtract 1, otherwise subtract 0\".\r\n\r\nIf we store a 52-bit value in a 64-bit word, underflowing it and then keeping the bottom 52 bits is equivalent to underflowing the same value stored in a 52-bit word.\r\n\r\n(An analogous explanation works for where the 31-bit shift came from in the 10x26 case.)",
      "user": {
        "login": "robot-dreams",
        "id": 4276679,
        "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/robot-dreams",
        "html_url": "https://github.com/robot-dreams",
        "followers_url": "https://api.github.com/users/robot-dreams/followers",
        "following_url": "https://api.github.com/users/robot-dreams/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/robot-dreams/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/robot-dreams/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
        "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
        "repos_url": "https://api.github.com/users/robot-dreams/repos",
        "events_url": "https://api.github.com/users/robot-dreams/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1028#pullrequestreview-823383001",
      "submitted_at": "2021-12-05T16:43:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028"
    },
    {
      "event": "reviewed",
      "id": 824249417,
      "node_id": "PRR_kwDOAP4Jqs4xIQxJ",
      "url": null,
      "actor": null,
      "commit_id": "4bbb6612dc0581ded87d911039729c4ec1a143c8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK 4bbb6612dc0581ded87d911039729c4ec1a143c8\r\n\r\nMy only concern from before was magnitude / overflow. I agree it'd be a good idea to enforce some exact magnitude limit and/or more carefully audit maximum possible magnitudes. But I don't think it should block this PR—especially since I also tried running tests with `VERIFY_CHECK(r->magnitude <= 16)` at the top of `fe_normalize` and it passed.",
      "user": {
        "login": "robot-dreams",
        "id": 4276679,
        "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/robot-dreams",
        "html_url": "https://github.com/robot-dreams",
        "followers_url": "https://api.github.com/users/robot-dreams/followers",
        "following_url": "https://api.github.com/users/robot-dreams/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/robot-dreams/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/robot-dreams/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
        "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
        "repos_url": "https://api.github.com/users/robot-dreams/repos",
        "events_url": "https://api.github.com/users/robot-dreams/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1028#pullrequestreview-824249417",
      "submitted_at": "2021-12-06T17:28:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5798733816,
      "node_id": "HRFPE_lADOAP4Jqs4_0Fr9zwAAAAFZoaf4",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5798733816",
      "actor": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T12:47:15Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5809864479,
      "node_id": "HRFPE_lADOAP4Jqs4_0Fr9zwAAAAFaS38f",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5809864479",
      "actor": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-23T13:11:31Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-31T22:25:22Z",
      "updated_at": "2021-12-31T22:25:22Z",
      "source": {
        "issue": {
          "id": 1087816645,
          "node_id": "I_kwDOAP4Jqs5A1sPF",
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1051",
          "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
          "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1051/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1051/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1051/events",
          "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1051",
          "number": 1051,
          "state": "open",
          "state_reason": null,
          "title": "Try a non-uniform group law (e.g., for ecmult_gen)?",
          "body": "The group law in `secp256k1_gej_add_ge` is uniform, i.e., it works for P + Q no matter if P != Q or P = Q. (It still needs to handle infinity and has another special case.) \r\n\r\nIt needs 7 fe mul and 5 fe sqr, the best non-uniform group law in EFD needs one fewer sqr (https://www.hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#addition-madd-2007-bl). Mabye it's faster also in practice. We could simply implement it and benchmark it.\r\n\r\nDepending on the specifics of our ecmult_gen algorithm, it may be the case that this algorithm never adds P + Q with P = Q (for example, the ecmult algorithm within the MuSig-DN circuit has a similar property)). Then, we could get away with the non-uniform law in ecmult_gen.\r\n\r\nI think we shouldn't really think about this before https://github.com/bitcoin-core/secp256k1/pull/693 has been done.",
          "user": {
            "login": "real-or-random",
            "id": 1071625,
            "node_id": "MDQ6VXNlcjEwNzE2MjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/real-or-random",
            "html_url": "https://github.com/real-or-random",
            "followers_url": "https://api.github.com/users/real-or-random/followers",
            "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
            "organizations_url": "https://api.github.com/users/real-or-random/orgs",
            "repos_url": "https://api.github.com/users/real-or-random/repos",
            "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/real-or-random/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 30,
          "created_at": "2021-12-23T15:38:09Z",
          "updated_at": "2022-12-03T16:44:05Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5831404540,
      "node_id": "HRFPE_lADOAP4Jqs4_0Fr9zwAAAAFblCv8",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5831404540",
      "actor": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-01T06:14:12Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-04T10:17:26Z",
      "updated_at": "2022-01-04T10:17:26Z",
      "source": {
        "issue": {
          "id": 1092749774,
          "node_id": "I_kwDOAP4Jqs5BIgnO",
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1060",
          "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
          "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1060/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1060/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1060/events",
          "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1060",
          "number": 1060,
          "state": "closed",
          "state_reason": "completed",
          "title": "Separate magnitude/normalization/... checking/propagation from implementations",
          "body": "Right now, it is not exactly clear where the definition of magnitude/normalization rules belongs:\r\n* On the one hand, both implementations individually track these values separately (and have their own rules)\r\n* On the other hand, callers of the field code are expected to simultaneously satisfy all of them.\r\n\r\nWith #967 things may become even more complicated as it adds a \"precomputed\" dimension (=reduced to 4 64-bit limbs instead of 5), but lacks the need for magnitudes as a concern.\r\n\r\nSo I think that we should make these rules part of the generic field interface, rather than part of the implementations. To avoid duplication, there could be a field_debug.h that implements these by \"wrapping\" the underlying field. It could be done by giving all field types/functions a suffix, and if debug is in use, have the real field functions forward to those, and if not, just `#define fn fn_suffix` for all.\r\n\r\nOne reason for not doing this would be if we want to make group logic dependent on what the used field is (e.g. a field with laxer magnitude requirements could result in the group code emitting fewer normalization calls).",
          "user": {
            "login": "sipa",
            "id": 548488,
            "node_id": "MDQ6VXNlcjU0ODQ4OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sipa",
            "html_url": "https://github.com/sipa",
            "followers_url": "https://api.github.com/users/sipa/followers",
            "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
            "organizations_url": "https://api.github.com/users/sipa/orgs",
            "repos_url": "https://api.github.com/users/sipa/repos",
            "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sipa/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 5,
          "closed_at": "2023-05-11T12:24:10Z",
          "created_at": "2022-01-03T19:10:48Z",
          "updated_at": "2023-05-11T12:24:10Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDg5MzI5NTZmZTU1MzIzNWQ0YjA3ODllN2JkODJmZjBiZWU1OTMzNWQ",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8932956fe553235d4b0789e7bd82ff0bee59335d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8932956fe553235d4b0789e7bd82ff0bee59335d",
      "tree": {
        "sha": "baa6de73bc64e98ec7c0131a0b19ffe9d1526fad",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/baa6de73bc64e98ec7c0131a0b19ffe9d1526fad"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/485f608fa9e28f132f127df97136617645effe81",
          "sha": "485f608fa9e28f132f127df97136617645effe81",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/485f608fa9e28f132f127df97136617645effe81"
        }
      ],
      "message": "Faster const-time normalization",
      "committer": {
        "name": "Peter Dettman",
        "email": "peter.dettman@gmail.com",
        "date": "2022-04-20T05:39:43Z"
      },
      "author": {
        "name": "Peter Dettman",
        "email": "peter.dettman@gmail.com",
        "date": "2021-12-03T13:44:06Z"
      },
      "sha": "8932956fe553235d4b0789e7bd82ff0bee59335d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6460206246,
      "node_id": "HRFPE_lADOAP4Jqs4_0Fr9zwAAAAGBDuym",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/6460206246",
      "actor": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-20T05:42:12Z"
    },
    {
      "event": "labeled",
      "id": 9225198339,
      "node_id": "LE_lADOAP4Jqs4_0Fr9zwAAAAIl3VsD",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/9225198339",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T17:46:46Z",
      "label": {
        "name": "performance",
        "color": "DE3CCC"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments/762552329",
      "pull_request_review_id": 823383001,
      "id": 762552329,
      "node_id": "PRRC_kwDOAP4Jqs4tc6AJ",
      "diff_hunk": "@@ -54,36 +54,31 @@ static void secp256k1_fe_verify(const secp256k1_fe *a) {\n static void secp256k1_fe_normalize(secp256k1_fe *r) {\n     uint64_t t0 = r->n[0], t1 = r->n[1], t2 = r->n[2], t3 = r->n[3], t4 = r->n[4];\n \n-    /* Reduce t4 at the start so there will be at most a single carry from the first pass */\n-    uint64_t m;\n-    uint64_t x = t4 >> 48; t4 &= 0x0FFFFFFFFFFFFULL;\n+    /* Reduce t4 at the start so there will be at most a single carry from the first pass.\n+     * x is incremented before the first pass and then decremented before the second pass\n+     * to ensure that the result doesn't fall into the range [P, 2^256). */\n+    uint64_t x = (t4 >> 48) + 1; t4 &= 0x0FFFFFFFFFFFFULL;\n \n     /* The first pass ensures the magnitude is 1, ... */\n     t0 += x * 0x1000003D1ULL;",
      "path": "src/field_5x52_impl.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "8932956fe553235d4b0789e7bd82ff0bee59335d",
      "original_commit_id": "4bbb6612dc0581ded87d911039729c4ec1a143c8",
      "in_reply_to_id": null,
      "user": {
        "login": "robot-dreams",
        "id": 4276679,
        "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/robot-dreams",
        "html_url": "https://github.com/robot-dreams",
        "followers_url": "https://api.github.com/users/robot-dreams/followers",
        "following_url": "https://api.github.com/users/robot-dreams/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/robot-dreams/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/robot-dreams/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
        "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
        "repos_url": "https://api.github.com/users/robot-dreams/repos",
        "events_url": "https://api.github.com/users/robot-dreams/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Given that `x` is bigger than before, how we know that `t0 += x * 0x1000003D1ULL` won't overflow the `uint64_t`?",
      "created_at": "2021-12-05T12:03:59Z",
      "updated_at": "2021-12-05T16:43:11Z",
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1028#discussion_r762552329",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments/762552329"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 85,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments/762599882",
      "pull_request_review_id": 823421101,
      "id": 762599882,
      "node_id": "PRRC_kwDOAP4Jqs4tdFnK",
      "diff_hunk": "@@ -54,36 +54,31 @@ static void secp256k1_fe_verify(const secp256k1_fe *a) {\n static void secp256k1_fe_normalize(secp256k1_fe *r) {\n     uint64_t t0 = r->n[0], t1 = r->n[1], t2 = r->n[2], t3 = r->n[3], t4 = r->n[4];\n \n-    /* Reduce t4 at the start so there will be at most a single carry from the first pass */\n-    uint64_t m;\n-    uint64_t x = t4 >> 48; t4 &= 0x0FFFFFFFFFFFFULL;\n+    /* Reduce t4 at the start so there will be at most a single carry from the first pass.\n+     * x is incremented before the first pass and then decremented before the second pass\n+     * to ensure that the result doesn't fall into the range [P, 2^256). */\n+    uint64_t x = (t4 >> 48) + 1; t4 &= 0x0FFFFFFFFFFFFULL;\n \n     /* The first pass ensures the magnitude is 1, ... */\n     t0 += x * 0x1000003D1ULL;",
      "path": "src/field_5x52_impl.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "8932956fe553235d4b0789e7bd82ff0bee59335d",
      "original_commit_id": "4bbb6612dc0581ded87d911039729c4ec1a143c8",
      "in_reply_to_id": 762552329,
      "user": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Most, if not all, callers use field elements with a maximum magnitude of 8, so there's plenty of room. The practical limit is actually around 31 (because field_10x26 can only represent magnitude 32 and several methods assume there's a free bit available for carries on entry). I think it would be a good idea to actually enforce some exact magnitude limit on input to field methods though (probably 16).",
      "created_at": "2021-12-05T18:42:35Z",
      "updated_at": "2021-12-05T18:42:35Z",
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1028#discussion_r762599882",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments/762599882"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1028"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 85,
      "original_line": 85,
      "side": "RIGHT"
    }
  ]
}