{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765",
    "id": 2966544424,
    "node_id": "PR_kwDOAP4Jqs6w0eAo",
    "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765",
    "diff_url": "https://github.com/bitcoin-core/secp256k1/pull/1765.diff",
    "patch_url": "https://github.com/bitcoin-core/secp256k1/pull/1765.patch",
    "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765",
    "commits_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin-core/secp256k1/statuses/f96f41f24f8a43384e57a04d1cb73798c579b59a",
    "number": 1765,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Add \"silentpayments\" module implementing BIP352 (take 4, limited to full-node scanning)",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Description\r\n\r\nThis PR implements [BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki) with scanning limited to full-nodes. Light-client scanning is planned to be added in a separate PR in the future. The following 5 API functions are currently introduced:\r\n\r\nSender side [[BIP description](https://github.com/bitcoin/bips/blob/c9a6ca6297eb8de850f6b64dafb8e60ee9b64d66/bip-0352.mediawiki?plain=1#L297-L312)]: \r\n* `secp256k1_silentpayments_sender_create_outputs`: given a list of $n$ secret keys $a_1 ... a_n$, a serialized outpoint, and a list of recipients (each consisting of silent payments scan pubkey and spend pubkey), create the corresponding transaction outputs (x-only public keys) for the sending transaction \r\n\r\nReceiver side, label creation [[BIP description](https://github.com/bitcoin/bips/blob/c9a6ca6297eb8de850f6b64dafb8e60ee9b64d66/bip-0352.mediawiki?plain=1#L200)]:\r\n* `secp256k1_recipient_create_label`: given a scan secret key and label integer, calculate the corresponding label_tweak and label public key\r\n* `secp256k1_recipient_create_labeled_spend_pubkey`: given a spend public key and a label public key, create the corresponding labeled spend public key\r\n\r\nReceiver side, scanning [[BIP description](https://github.com/bitcoin/bips/blob/c9a6ca6297eb8de850f6b64dafb8e60ee9b64d66/bip-0352.mediawiki?plain=1#L334)]: \r\n* `secp256k1_recipient_prevouts_summary_create`: given a list of $n$ public keys $A_1 ... A_n$ and a serialized outpoint, create a `prevouts_summary` object needed for scanning\r\n* `secp256k1_recipient_scan_outputs`: given a `prevouts_summary` object, a recipients scan secret key and spend public key, and the relevant transaction outputs (x-only public keys), scan for outputs belonging to the recipients and and return the tweak(s) needed for spending the output(s). Optionally, a label_lookup callback function can be provided to also scan for labels.\r\n\r\nFor a higher-level overview on what these functions exactly do, it's suggested to look at a corresponding [Python implementation](https://github.com/theStack/secp256k1lab/blob/add_bip352_module_review_helper/src/secp256k1lab/bip352.py) that was created based on the secp256k1lab project (it passes the test vectors, so this \"executable pseudo-code\" should be correct).\r\n\r\n### Changes to the previous take\r\n\r\nBased on the latest state of the previous PR #1698 (take 3), the following changes have been made:\r\n* rebased on master (adapting to the new unit test framework added in #1734; thanks to furszy for his [mini-guide](https://github.com/bitcoin-core/secp256k1/pull/1698#pullrequestreview-3340808550))\r\n* removed functionality that is only relevant for light clients (`_prevout_summary_{parse,serialize}`, `__recipient_create_output_pubkeys`), adapted tests and benchmark accordingly\r\n* adapted examples to have both Bob and Carol do full-node scanning, with a TODO to switch the latter to light-client scanning once available in the future\r\n* addressed various review comments, if still relevant (https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2433803533, https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2433808769, https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2433811927, https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2433817223)\r\n\r\nThe scope reduction isn't immediately visible in commit count (only one commit was _only_ introducing light-client relevant functionality and could be completely removed), but the review burden compared #1698 is still significantly lower in terms of LOC, especially in the receiving commit.\r\n\r\n### Open questions / TODOs\r\n* ~~Recent proposals of reducing the worst-case scanning time (see posts by w0xlt and jonasnick, https://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3448610022 ff.) are not taken into account yet.~~ :arrow_right: solved by marking already-found outputs, see https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3577161237 :heavy_check_mark: \r\n* ~~Not providing `prevouts_summary` (de)serialization functionality yet in the API poses the risk that users try to do it anyway by treating the opaque object as \"serialized\". How to cope with that? Is adding a \"don't do this\" comment in API header sufficient?~~ :arrow_right: solved by mentioning a \"don't do this\" comment in the API header (same phrasing as in other modules), see https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3533591506 :heavy_check_mark: ",
    "labels": [
      {
        "id": 4975353639,
        "node_id": "LA_kwDOAP4Jqs8AAAABKI3fJw",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/labels/feature",
        "name": "feature",
        "description": "",
        "color": "731E95",
        "default": false
      }
    ],
    "created_at": "2025-10-31T12:06:04Z",
    "updated_at": "2025-12-02T17:03:54Z",
    "mergeable": true,
    "mergeable_state": "unstable",
    "merged": false,
    "merge_commit_sha": "7839f8dbade13e10a16dddb0008ab87083747f9a",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "theStack:silentpayments_module_fullnode_only",
      "ref": "silentpayments_module_fullnode_only",
      "sha": "f96f41f24f8a43384e57a04d1cb73798c579b59a",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 452762907,
        "node_id": "R_kgDOGvydGw",
        "name": "secp256k1",
        "full_name": "theStack/secp256k1",
        "owner": {
          "login": "theStack",
          "id": 91535,
          "node_id": "MDQ6VXNlcjkxNTM1",
          "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/theStack",
          "html_url": "https://github.com/theStack",
          "followers_url": "https://api.github.com/users/theStack/followers",
          "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
          "organizations_url": "https://api.github.com/users/theStack/orgs",
          "repos_url": "https://api.github.com/users/theStack/repos",
          "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/theStack/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/theStack/secp256k1",
        "description": "Optimized C library for EC operations on curve secp256k1",
        "fork": true,
        "url": "https://api.github.com/repos/theStack/secp256k1",
        "archive_url": "https://api.github.com/repos/theStack/secp256k1/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/theStack/secp256k1/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/theStack/secp256k1/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/theStack/secp256k1/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/theStack/secp256k1/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/theStack/secp256k1/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/theStack/secp256k1/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/theStack/secp256k1/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/theStack/secp256k1/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/theStack/secp256k1/contributors",
        "deployments_url": "https://api.github.com/repos/theStack/secp256k1/deployments",
        "downloads_url": "https://api.github.com/repos/theStack/secp256k1/downloads",
        "events_url": "https://api.github.com/repos/theStack/secp256k1/events",
        "forks_url": "https://api.github.com/repos/theStack/secp256k1/forks",
        "git_commits_url": "https://api.github.com/repos/theStack/secp256k1/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/theStack/secp256k1/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/theStack/secp256k1/git/tags%7B/sha%7D",
        "git_url": "git://github.com/theStack/secp256k1.git",
        "issue_comment_url": "https://api.github.com/repos/theStack/secp256k1/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/theStack/secp256k1/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/theStack/secp256k1/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/theStack/secp256k1/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/theStack/secp256k1/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/theStack/secp256k1/languages",
        "merges_url": "https://api.github.com/repos/theStack/secp256k1/merges",
        "milestones_url": "https://api.github.com/repos/theStack/secp256k1/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/theStack/secp256k1/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/theStack/secp256k1/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/theStack/secp256k1/releases%7B/id%7D",
        "ssh_url": "git@github.com:theStack/secp256k1.git",
        "stargazers_url": "https://api.github.com/repos/theStack/secp256k1/stargazers",
        "statuses_url": "https://api.github.com/repos/theStack/secp256k1/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/theStack/secp256k1/subscribers",
        "subscription_url": "https://api.github.com/repos/theStack/secp256k1/subscription",
        "tags_url": "https://api.github.com/repos/theStack/secp256k1/tags",
        "teams_url": "https://api.github.com/repos/theStack/secp256k1/teams",
        "trees_url": "https://api.github.com/repos/theStack/secp256k1/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/theStack/secp256k1.git",
        "hooks_url": "https://api.github.com/repos/theStack/secp256k1/hooks",
        "svn_url": "https://github.com/theStack/secp256k1",
        "language": "C",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 13015,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-02T14:24:29Z",
        "created_at": "2022-01-27T16:42:12Z",
        "updated_at": "2025-09-14T19:27:22Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin-core:master",
      "ref": "master",
      "sha": "e7f7083b530a55c83ce9089a7244d2d9d67ac8b2",
      "user": {
        "login": "bitcoin-core",
        "id": 13464320,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjEzNDY0MzIw",
        "avatar_url": "https://avatars.githubusercontent.com/u/13464320?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin-core",
        "html_url": "https://github.com/bitcoin-core",
        "followers_url": "https://api.github.com/users/bitcoin-core/followers",
        "following_url": "https://api.github.com/users/bitcoin-core/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin-core/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin-core/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin-core/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin-core/orgs",
        "repos_url": "https://api.github.com/users/bitcoin-core/repos",
        "events_url": "https://api.github.com/users/bitcoin-core/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin-core/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 16648618,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNjY0ODYxOA==",
        "name": "secp256k1",
        "full_name": "bitcoin-core/secp256k1",
        "owner": {
          "login": "bitcoin-core",
          "id": 13464320,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjEzNDY0MzIw",
          "avatar_url": "https://avatars.githubusercontent.com/u/13464320?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin-core",
          "html_url": "https://github.com/bitcoin-core",
          "followers_url": "https://api.github.com/users/bitcoin-core/followers",
          "following_url": "https://api.github.com/users/bitcoin-core/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin-core/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin-core/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin-core/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin-core/orgs",
          "repos_url": "https://api.github.com/users/bitcoin-core/repos",
          "events_url": "https://api.github.com/users/bitcoin-core/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin-core/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin-core/secp256k1",
        "description": "Optimized C library for EC operations on curve secp256k1",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1",
        "archive_url": "https://api.github.com/repos/bitcoin-core/secp256k1/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin-core/secp256k1/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin-core/secp256k1/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin-core/secp256k1/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin-core/secp256k1/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin-core/secp256k1/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin-core/secp256k1/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin-core/secp256k1/downloads",
        "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/events",
        "forks_url": "https://api.github.com/repos/bitcoin-core/secp256k1/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin-core/secp256k1.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin-core/secp256k1/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin-core/secp256k1/languages",
        "merges_url": "https://api.github.com/repos/bitcoin-core/secp256k1/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin-core/secp256k1/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin-core/secp256k1/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin-core/secp256k1/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin-core/secp256k1.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin-core/secp256k1/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin-core/secp256k1/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin-core/secp256k1/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin-core/secp256k1/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin-core/secp256k1/tags",
        "teams_url": "https://api.github.com/repos/bitcoin-core/secp256k1/teams",
        "trees_url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin-core/secp256k1.git",
        "hooks_url": "https://api.github.com/repos/bitcoin-core/secp256k1/hooks",
        "svn_url": "https://github.com/bitcoin-core/secp256k1",
        "language": "C",
        "forks_count": 1103,
        "stargazers_count": 2353,
        "watchers_count": 2353,
        "size": 13986,
        "default_branch": "master",
        "open_issues_count": 158,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-11-27T16:27:17Z",
        "created_at": "2014-02-08T17:30:06Z",
        "updated_at": "2025-12-02T11:57:24Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 7927,
    "deletions": 35,
    "changed_files": 23,
    "commits": 11,
    "review_comments": 1,
    "comments": 22
  },
  "events": [
    {
      "event": "labeled",
      "id": 20764376070,
      "node_id": "LE_lADOAP4Jqs7VEWwNzwAAAATVpzwG",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20764376070",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-06T16:09:29Z",
      "label": {
        "name": "feature",
        "color": "731E95"
      }
    },
    {
      "event": "commented",
      "id": 3499455867,
      "node_id": "IC_kwDOAP4Jqs7QlXV7",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3499455867",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-06T21:27:50Z",
      "updated_at": "2025-11-06T21:27:50Z",
      "author_association": "NONE",
      "body": "Added the optimized version on top of this PR:\r\nhttps://github.com/w0xlt/secp256k1/commit/8d16914cad57ba07da09d104f0c605ae6284462f\r\n\r\nFor more context:\r\nhttps://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3462891318",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3499455867",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "commented",
      "id": 3500144381,
      "node_id": "IC_kwDOAP4Jqs7Qn_b9",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3500144381",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-07T01:58:22Z",
      "updated_at": "2025-11-07T01:58:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Small supplementary update: I've created a corresponding Python implementation of the provided API functions based on secp256k1lab (https://github.com/theStack/secp256k1lab/blob/add_bip352_module_review_helper/src/secp256k1lab/bip352.py) (also linked in the PR description). The hope is that this makes reviewing this PR a bit easier by having a less noisy, \"executable pseudo-code\"-like description on what happens under the hood. The code passes the BIP352 test vectors and hence should be correct.\r\n\r\n> Added the optimized version on top of this PR: [w0xlt@8d16914](https://github.com/w0xlt/secp256k1/commit/8d16914cad57ba07da09d104f0c605ae6284462f)\r\n> \r\n> For more context: [#1698 (comment)](https://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3462891318)\r\n\r\nThanks for rebasing on top of this PR, much appreciated! I will take a closer look within the next days.\r\n",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3500144381",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "subscribed",
      "id": 20780027146,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATWlg0K",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20780027146",
      "actor": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-07T07:32:48Z"
    },
    {
      "event": "reviewed",
      "id": 3462461331,
      "node_id": "PRR_kwDOAP4Jqs7OYPeT",
      "url": null,
      "actor": null,
      "commit_id": "c11d30c25f75776920797b017a568ea0cfc28882",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-14T02:04:05Z",
      "author_association": "NONE",
      "body": "Nit: Not related to optimization, but the diff below removes some redundant public-key serialization code:\r\n\r\n```diff\r\ndiff --git a/src/modules/silentpayments/main_impl.h b/src/modules/silentpayments/main_impl.h\r\nindex 106da20..922433d 100644\r\n--- a/src/modules/silentpayments/main_impl.h\r\n+++ b/src/modules/silentpayments/main_impl.h\r\n@@ -21,6 +21,19 @@\r\n /** magic bytes for ensuring prevouts_summary objects were initialized correctly. */\r\n static const unsigned char secp256k1_silentpayments_prevouts_summary_magic[4] = { 0xa7, 0x1c, 0xd3, 0x5e };\r\n \r\n+/* Serialize a ge to compressed 33 bytes. Keeps eckey_pubkey_serialize usage uniform\r\n+ * (expects non-const ge*), and centralizes the VERIFY_CHECK. */\r\n+static SECP256K1_INLINE void secp256k1_sp_ge_serialize33(const secp256k1_ge* in, unsigned char out33[33]) {\r\n+    size_t len = 33;\r\n+    secp256k1_ge tmp = *in;\r\n+    int ok = secp256k1_eckey_pubkey_serialize(&tmp, out33, &len, 1);\r\n+#ifdef VERIFY\r\n+    VERIFY_CHECK(ok && len == 33);\r\n+#else\r\n+    (void)ok;\r\n+#endif\r\n+}\r\n+\r\n /** Sort an array of silent payment recipients. This is used to group recipients by scan pubkey to\r\n  *  ensure the correct values of k are used when creating multiple outputs for a recipient.\r\n  *\r\n@@ -68,13 +81,11 @@ static int secp256k1_silentpayments_calculate_input_hash_scalar(secp256k1_scalar\r\n     secp256k1_sha256 hash;\r\n     unsigned char pubkey_sum_ser[33];\r\n     unsigned char input_hash[32];\r\n-    size_t len;\r\n     int ret, overflow;\r\n \r\n     secp256k1_silentpayments_sha256_init_inputs(&hash);\r\n     secp256k1_sha256_write(&hash, outpoint_smallest36, 36);\r\n-    ret = secp256k1_eckey_pubkey_serialize(pubkey_sum, pubkey_sum_ser, &len, 1);\r\n-    VERIFY_CHECK(ret && len == sizeof(pubkey_sum_ser));\r\n+    secp256k1_sp_ge_serialize33(pubkey_sum, pubkey_sum_ser);\r\n     secp256k1_sha256_write(&hash, pubkey_sum_ser, sizeof(pubkey_sum_ser));\r\n     secp256k1_sha256_finalize(&hash, input_hash);\r\n     /* Convert input_hash to a scalar.\r\n@@ -85,15 +96,13 @@ static int secp256k1_silentpayments_calculate_input_hash_scalar(secp256k1_scalar\r\n      * an error to ensure strict compliance with BIP0352.\r\n      */\r\n     secp256k1_scalar_set_b32(input_hash_scalar, input_hash, &overflow);\r\n-    ret &= !secp256k1_scalar_is_zero(input_hash_scalar);\r\n+    ret = !secp256k1_scalar_is_zero(input_hash_scalar);\r\n     return ret & !overflow;\r\n }\r\n \r\n static void secp256k1_silentpayments_create_shared_secret(const secp256k1_context *ctx, unsigned char *shared_secret33, const secp256k1_ge *public_component, const secp256k1_scalar *secret_component) {\r\n     secp256k1_gej ss_j;\r\n     secp256k1_ge ss;\r\n-    size_t len;\r\n-    int ret;\r\n \r\n     secp256k1_ecmult_const(&ss_j, public_component, secret_component);\r\n     secp256k1_ge_set_gej(&ss, &ss_j);\r\n@@ -103,12 +112,7 @@ static void secp256k1_silentpayments_create_shared_secret(const secp256k1_contex\r\n      * impossible at this point considering we have already validated the public key and\r\n      * the secret key.\r\n      */\r\n-    ret = secp256k1_eckey_pubkey_serialize(&ss, shared_secret33, &len, 1);\r\n-#ifdef VERIFY\r\n-    VERIFY_CHECK(ret && len == 33);\r\n-#else\r\n-    (void)ret;\r\n-#endif\r\n+    secp256k1_sp_ge_serialize33(&ss, shared_secret33);\r\n \r\n     /* Leaking these values would break indistinguishability of the transaction, so clear them. */\r\n     secp256k1_ge_clear(&ss);\r\n@@ -585,7 +589,6 @@ int secp256k1_silentpayments_recipient_scan_outputs(\r\n                 secp256k1_ge output_negated_ge, tx_output_ge;\r\n                 secp256k1_gej tx_output_gej, label_gej;\r\n                 unsigned char label33[33];\r\n-                size_t len;\r\n \r\n                 secp256k1_xonly_pubkey_load(ctx, &tx_output_ge, tx_outputs[j]);\r\n                 secp256k1_gej_set_ge(&tx_output_gej, &tx_output_ge);\r\n@@ -595,7 +598,6 @@ int secp256k1_silentpayments_recipient_scan_outputs(\r\n                 secp256k1_ge_neg(&output_negated_ge, &output_ge);\r\n                 secp256k1_gej_add_ge_var(&label_gej, &tx_output_gej, &output_negated_ge, NULL);\r\n                 secp256k1_ge_set_gej_var(&label_ge, &label_gej);\r\n-                ret = secp256k1_eckey_pubkey_serialize(&label_ge, label33, &len, 1);\r\n                 /* Serialize must succeed because the point was just loaded.\r\n                  *\r\n                  * Note: serialize will also fail if label_ge is the point at infinity, but we know\r\n@@ -603,7 +605,7 @@ int secp256k1_silentpayments_recipient_scan_outputs(\r\n                  * Thus, we know that label_ge = tx_output_gej + output_negated_ge cannot be the\r\n                  * point at infinity.\r\n                  */\r\n-                VERIFY_CHECK(ret && len == 33);\r\n+                secp256k1_sp_ge_serialize33(&label_ge, label33);\r\n                 label_tweak = label_lookup(label33, label_context);\r\n                 if (label_tweak != NULL) {\r\n                     found = 1;\r\n@@ -617,7 +619,6 @@ int secp256k1_silentpayments_recipient_scan_outputs(\r\n                 secp256k1_gej_neg(&label_gej, &tx_output_gej);\r\n                 secp256k1_gej_add_ge_var(&label_gej, &label_gej, &output_negated_ge, NULL);\r\n                 secp256k1_ge_set_gej_var(&label_ge, &label_gej);\r\n-                ret = secp256k1_eckey_pubkey_serialize(&label_ge, label33, &len, 1);\r\n                 /* Serialize must succeed because the point was just loaded.\r\n                  *\r\n                  * Note: serialize will also fail if label_ge is the point at infinity, but we know\r\n@@ -625,7 +626,7 @@ int secp256k1_silentpayments_recipient_scan_outputs(\r\n                  * Thus, we know that label_ge = tx_output_gej + output_negated_ge cannot be the\r\n                  * point at infinity.\r\n                  */\r\n-                VERIFY_CHECK(ret && len == 33);\r\n+                secp256k1_sp_ge_serialize33(&label_ge, label33);\r\n                 label_tweak = label_lookup(label33, label_context);\r\n                 if (label_tweak != NULL) {\r\n                     found = 1;\r\n``` ",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#pullrequestreview-3462461331",
      "submitted_at": "2025-11-14T02:04:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765"
    },
    {
      "event": "reviewed",
      "id": 3462502369,
      "node_id": "PRR_kwDOAP4Jqs7OYZfh",
      "url": null,
      "actor": null,
      "commit_id": "c11d30c25f75776920797b017a568ea0cfc28882",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-14T02:25:07Z",
      "author_association": "NONE",
      "body": "nit: The following diff removes the implicit cast and clarifies that k is 4 bytes\r\n\r\n```diff\r\ndiff --git a/src/modules/silentpayments/main_impl.h b/src/modules/silentpayments/main_impl.h\r\nindex 922433d..d94aed6 100644\r\n--- a/src/modules/silentpayments/main_impl.h\r\n+++ b/src/modules/silentpayments/main_impl.h\r\n@@ -512,7 +512,8 @@ int secp256k1_silentpayments_recipient_scan_outputs(\r\n     secp256k1_xonly_pubkey output_xonly;\r\n     unsigned char shared_secret[33];\r\n     const unsigned char *label_tweak = NULL;\r\n-    size_t j, k, found_idx;\r\n+    size_t j, found_idx;\r\n+    uint32_t k;\r\n     int found, combined, valid_scan_key, ret;\r\n \r\n     /* Sanity check inputs */\r\n```",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#pullrequestreview-3462502369",
      "submitted_at": "2025-11-14T02:25:07Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765"
    },
    {
      "event": "reviewed",
      "id": 3465700051,
      "node_id": "PRR_kwDOAP4Jqs7OkmLT",
      "url": null,
      "actor": null,
      "commit_id": "c11d30c25f75776920797b017a568ea0cfc28882",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-14T16:25:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks @theStack for the new PR. I can confirm that this PR is a rebased version of #1698, with the light client functionality removed and comments addressed, except for:\r\n\r\n- https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2414315034\r\n- https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2414294498\r\n- https://github.com/bitcoin-core/secp256k1/pull/1698#pullrequestreview-3313483669 (only the last one, \"elemement\")\r\n",
      "user": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#pullrequestreview-3465700051",
      "submitted_at": "2025-11-14T16:25:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765"
    },
    {
      "event": "commented",
      "id": 3533591506,
      "node_id": "IC_kwDOAP4Jqs7SnlPS",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3533591506",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-14T16:33:07Z",
      "updated_at": "2025-11-14T16:33:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Not providing prevouts_summary (de)serialization functionality yet in the API poses the risk that users try to do it anyway by treating the opaque object as \"serialized\". How to cope with that? Is adding a \"don't do this\" comment in API header sufficient?\r\n\r\nIs there a reason for serializing prevouts_summary without light client functionality? If not, I think the don't do this comment is sufficient. Right now, in contrast to the docs of all other opaque objects, this is missing, however:\r\n\r\n> The exact representation of data inside the opaque data structures is implementation defined and not guaranteed to be portable between different platforms or versions.  ",
      "user": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3533591506",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20956101523,
      "node_id": "HRFPE_lADOAP4Jqs7VEWwNzwAAAAThFLuT",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20956101523",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "445f2e835fdd81a23784d5b398f1180453a74c55",
      "commit_url": "https://api.github.com/repos/theStack/secp256k1/commits/445f2e835fdd81a23784d5b398f1180453a74c55",
      "created_at": "2025-11-15T00:46:39Z"
    },
    {
      "event": "commented",
      "id": 3535206990,
      "node_id": "IC_kwDOAP4Jqs7StvpO",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3535206990",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-15T00:48:14Z",
      "updated_at": "2025-11-15T00:48:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "@w0xlt, @jonasnick: Thanks for the reviews! I've addressed the suggested changes:\r\n* in `_recpient_scan_outputs`: changed the type of `k`  to uint32_t ([comment above](https://github.com/bitcoin-core/secp256k1/pull/1765#pullrequestreview-3462502369))\r\n* in `_recipient_create_label`: added a scan key validity check (+added a test for that) ([#1698 - comment](https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2414315034))\r\n* unified all mentions of \"Silent Payments\" to [title case](https://en.wikipedia.org/wiki/Title_case) in the header API and example ([#1698 - comment](https://github.com/bitcoin-core/secp256k1/pull/1698#discussion_r2414294498))\r\n* fixed typo s/elemement/element/ ([#1698 - review](https://github.com/bitcoin-core/secp256k1/pull/1698#pullrequestreview-3313483669))\r\n* in `_recipient_scan_outputs`: fixed comment in second label candidate ([review above](https://github.com/bitcoin-core/secp256k1/pull/1765#discussion_r2528111908))\r\n* extended the API header comment for the `_prevouts_summary` opaque data structure, to point out that the data structure is implementation defined (like docs of all other opaque structs) ([comment above](https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3533591506))\r\n\r\n> Nit: Not related to optimization, but the diff below removes some redundant public-key serialization code:\r\n\r\nGiven that this compressed-pubkey-serialization pattern shows up repeatedly also in other modules (ellswift, musig), I think it would make the most sense to add a general helper (e.g. in eckey{,_impl}.h), which could be done in an independent PR. I've opened issue https://github.com/bitcoin-core/secp256k1/issues/1773 to see if there is conceptual support for doing this.\r\n\r\n> > Not providing prevouts_summary (de)serialization functionality yet in the API poses the risk that users try to do it anyway by treating the opaque object as \"serialized\". How to cope with that? Is adding a \"don't do this\" comment in API header sufficient?\r\n> \r\n> Is there a reason for serializing prevouts_summary without light client functionality? If not, I think the don't do this comment is sufficient.\r\n\r\nGood point, I can't think of a good reason for full nodes wanting to serialize prevouts_summary. ",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3535206990",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 20956120856,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAAThFQcY",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20956120856",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-15T00:48:15Z"
    },
    {
      "event": "subscribed",
      "id": 20956120868,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAAThFQck",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20956120868",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-15T00:48:15Z"
    },
    {
      "event": "mentioned",
      "id": 20956120878,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAAThFQcu",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20956120878",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-15T00:48:15Z"
    },
    {
      "event": "subscribed",
      "id": 20956120885,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAAThFQc1",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20956120885",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-15T00:48:15Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20956305029,
      "node_id": "HRFPE_lADOAP4Jqs7VEWwNzwAAAAThF9aF",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/20956305029",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9103229d27d85fa8b199705f29bd7dada54ebaa7",
      "commit_url": "https://api.github.com/repos/theStack/secp256k1/commits/9103229d27d85fa8b199705f29bd7dada54ebaa7",
      "created_at": "2025-11-15T01:01:15Z"
    },
    {
      "event": "commented",
      "id": 3560474486,
      "node_id": "IC_kwDOAP4Jqs7UOId2",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3560474486",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T22:52:16Z",
      "updated_at": "2025-11-20T22:55:40Z",
      "author_association": "NONE",
      "body": "To address the open questions, Ive reviewed the proposed changes by @w0xlt on 8d16914cad57ba07da09d104f0c605ae6284462f.\r\n\r\nI'm going to focus more on the key aspects I extracted from the review and the merits of each change, rather on the big O improvement claims, because I didn't get that far.\r\n\r\nThese are multiple different changes rather than a single one, so to make the review easier I suggest to brake it in multiple commits. I would state on each of them the purpose and the real case scenario where the change would be relevant.\r\n\r\nAlso, I would use clearer names for the variables or at least document their purpose.\r\n\r\nThe changes I've identified so far are the following:\r\n\r\n- Improve label lookup using hash table: I think this is implementation dependent and should be improved by the user rather than by the library itself.\r\nExamples, as part of the documentation, are a usage demonstration, although can point the user the best practices, I prefer clarity rather than performance on them. For example, on the `rust-secp256k1` bindings, I used a [`HashMap` for the example](https://github.com/rust-bitcoin/rust-secp256k1/pull/876/commits/776653d9db064c8a5a422dca2311eaf669d96921#diff-120e5d0e47cef65c1da3e8220332b2fd878324ea96b204955dc7efc39b7d6fe8R84) because it is a familiar standard structure for Rust users. If they would like to gain more performance there, they have other [tools](https://nnethercote.github.io/perf-book/hashing.html) available to replace that structure by themselves.\r\n- On `secp256k1_silentpayments_recipient_sort_cmp`, I understood the change: `(r1->index < r2->index) ? -1 : (r1->index > r2->index) ? 1 : 0` is to make the unstable `secp256k1_hsort` implementation stable. Considering it only affects `secp256k1_silentpayments_sender_create_outputs`, which didn't receive more changes than a variable removal, what are the performance improvements there?\r\n- `SECP256K1_SP_SCAN_BATCH`: I [just learned about it (ge_set_gej_all)](https://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3460261306) during this review, but seems that affine to jacobian conversion is needed for the comparison against labels, and is faster to do it in batches. I think the impact of this improvement will only affect the small subset of transaction with large amount of outputs. A good benchmark for this would be coinjoin transactions, although is not supported by BIP 352, a test case is doable.\r\n- Double `head`: I'm not sure of the target of this change, I guess is to skip already found or scanned inputs, but couldn't figure out what is tracking each head.\r\n- Binary tree search for x-only lookups: I think it explain itself, faster lookups on the not labeled case. This may have its merits, but I need to remove the other changes to have a clear answer.\r\n\r\nIn general I agree with @jonasnick that we should define a [clear target to benchmark and improve](https://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3460261306). [As I've said before](https://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3461362873), the base case should be a wallet with a single label for change.\r\nFor other improvements, I would try to match up plausible real world scenarios before making complex changes in the code base of the PR.\r\nFinally, by looking at `bench_silentpayments_full_tx_scan`, the `use_labels` case is very simple. If we want to test performance improvements on the label lookup, I would start there.\r\n\r\nIn conclusion, from the proposed commit and the discussion around it, the only changes I've found clear enough to consider are:\r\n- [Tracking of found outputs](https://github.com/jonasnick/secp256k1/commit/311b4ebb2bf6612c46cefd80a8812d9c9b5dc6c4): simple enough, small performance improvement for the usual case, better for larger transactions.\r\n",
      "user": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3560474486",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21083667735,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATorz0X",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21083667735",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T22:52:18Z"
    },
    {
      "event": "subscribed",
      "id": 21083667746,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATorz0i",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21083667746",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T22:52:18Z"
    },
    {
      "event": "mentioned",
      "id": 21083667760,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATorz0w",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21083667760",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T22:52:18Z"
    },
    {
      "event": "subscribed",
      "id": 21083667781,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATorz1F",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21083667781",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T22:52:18Z"
    },
    {
      "event": "commented",
      "id": 3560646024,
      "node_id": "IC_kwDOAP4Jqs7UOyWI",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3560646024",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T23:34:35Z",
      "updated_at": "2025-11-20T23:34:35Z",
      "author_association": "NONE",
      "body": "Thanks @nymius for reviewing the changes, addressing the main points, and proposing a simplification.\r\n\r\nIm currently splitting the optimization commit into smaller pieces to make it easier to review. \r\nIll also take a closer look at your commit and run it against the benchmark files.\r\n\r\nThe only part of the discussion that still feels a bit ambiguous is the base or usual case. \r\nFrom my understanding of https://github.com/bitcoin-core/secp256k1/pull/1698#pullrequestreview-3341766084, the concern is not about typical usage, but rather about an attacker crafting malicious transactions with many outputs, causing the scanning process to take hours.\r\n\r\nSo the goal of this optimization would be to mitigate that scenario, not the collaborative one.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3560646024",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21084329452,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATouVXs",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21084329452",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T23:34:36Z"
    },
    {
      "event": "subscribed",
      "id": 21084329487,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATouVYP",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21084329487",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T23:34:37Z"
    },
    {
      "event": "commented",
      "id": 3561510143,
      "node_id": "IC_kwDOAP4Jqs7USFT_",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3561510143",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T05:55:27Z",
      "updated_at": "2025-11-21T05:55:27Z",
      "author_association": "NONE",
      "body": "I ran the `examples/silentpayments_mixed_1.c` file with simplified the version suggested by @nymius  https://github.com/jonasnick/secp256k1/commit/311b4ebb2bf6612c46cefd80a8812d9c9b5dc6c4 . It shows slightly worse performance (see below), but the simpler approach may still be worth it\r\n\r\nWithout the `secp256k1_silentpayments_recipient_sort_cmp` stabilization, I got **82s** for the complex version vs. **114s** for the simpler one. Whether the **30s** difference justifies the additional complexity is up for discussion  I dont have a strong opinion.\r\n\r\nAnswering the questions: `secp256k1_silentpayments_recipient_sort_cmp stabilization` + `heads` speed up the non-adversarial case. The stable sort ensures that the transaction outputs are ordered sequentially by the index $k$.\r\n\r\nThe optimized receiver implementation relies on a heuristic (the `head` pointers) that assumes the next output it is looking for ($k+1$) is located immediately after the previous one ($k$).\r\n\r\n* **With Stable Sort:** The scanner complexity is roughly **O(N)** (Linear).\r\n* **Without Stable Sort:** The scanner complexity degrades to **O(N)** (Quadratic).",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3561510143",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21089045331,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATpAUtT",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21089045331",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T05:55:28Z"
    },
    {
      "event": "subscribed",
      "id": 21089045351,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATpAUtn",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21089045351",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T05:55:28Z"
    },
    {
      "event": "commented",
      "id": 3563588992,
      "node_id": "IC_kwDOAP4Jqs7UaA2A",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3563588992",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:38Z",
      "updated_at": "2025-11-21T15:46:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "@w0xlt, @nymius: Thanks for investigating this deeper. I've now also had a chance to look at the suggested optimizations and came to similar conclusions as stated in https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3560474486. I particularly agree with the stated points that the changes should not increase complexity significantly and that the most important optimization candidate to consider for mitigating the worst-case scanning attack is \"skip outputs that we have already found\" (as previously stated by @jonasnick, see https://github.com/bitcoin-core/secp256k1/pull/1698#issuecomment-3460261306 and  https://github.com/jonasnick/secp256k1/commit/311b4ebb2bf6612c46cefd80a8812d9c9b5dc6c4). I don't think stabilizing the sorting helps at all, since this is something that happens at the sender side, and we can't rely on the attacker using a specific implementation (even if they did, it's trivial for them to shuffle the outputs after creation).\r\n\r\nFor the proposed target to benchmark, I'm proposing the following modified example that exhibits the worst-case scanning time based on a labels cache with one entry (for change outputs), by creating a tx with 23255 outputs [1] all targeted for Bob: https://github.com/bitcoin-core/secp256k1/commit/1df4287eb8daa34a07888300e0b18ba1c97a3432\r\n\r\nShower-thought from this morning: what if we treat the `tx_outputs` input as _actual_ list that we modify, and remove an entry if it is found? This would have a similar effect as the \"track found outputs\" idea, but without the need of dynamic memory allocation. It's a ~10-lines diff and seems to work fine: https://github.com/theStack/secp256k1/commit/9aba4709b937eb44507494b3bd5e80871193671c\r\nIt reduces the run-time of the proposed example above from ~10 minutes to roughly ~2 seconds on my machine.\r\n\r\nAny thoughts on this? Maybe I'm still missing something.\r\n\r\n[1] that's an upper bound of maximum outputs per block: floor(1000000/43) = 23255",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3563588992",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21100019914,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATpqMDK",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21100019914",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:39Z"
    },
    {
      "event": "subscribed",
      "id": 21100019955,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATpqMDz",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21100019955",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:39Z"
    },
    {
      "event": "mentioned",
      "id": 21100019976,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATpqMEI",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21100019976",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:39Z"
    },
    {
      "event": "subscribed",
      "id": 21100019996,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATpqMEc",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21100019996",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:39Z"
    },
    {
      "event": "mentioned",
      "id": 21100020018,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATpqMEy",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21100020018",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:39Z"
    },
    {
      "event": "subscribed",
      "id": 21100020048,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATpqMFQ",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21100020048",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T15:46:40Z"
    },
    {
      "event": "commented",
      "id": 3564351976,
      "node_id": "IC_kwDOAP4Jqs7Uc7Ho",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3564351976",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T19:34:35Z",
      "updated_at": "2025-11-21T20:03:46Z",
      "author_association": "NONE",
      "body": "> Shower-thought from this morning: what if we treat the `tx_outputs` input as _actual_ list that we modify, and remove an entry if it is found? This would have a similar effect as the \"track found outputs\" idea, but without the need of dynamic memory allocation. It's a ~10-lines diff and seems to work fine: [theStack@9aba470](https://github.com/theStack/secp256k1/commit/9aba4709b937eb44507494b3bd5e80871193671c) It reduces the run-time of the proposed example above from ~10 minutes to roughly ~2 seconds on my machine.\r\n> \r\n> Any thoughts on this? Maybe I'm still missing something.\r\n\r\n1df4287eb8daa34a07888300e0b18ba1c97a3432 is a good target.\r\nThese are the runtime times I've obtained testing against this target:\r\n| Branch         | Runtime         |\r\n| :----------- | :--------------: | \r\n|theStack@9aba470| ~1.41s |\r\n| theStack@9103229d27d85fa8b199705f29bd7dada54ebaa7 (baseline) | ~9m |\r\n| jonasnick@311b4eb| ~1.49s |\r\n\r\nI had to increase stack size to be able to fit all N_OUTPUT size allocations in the example.\r\n\r\nInitially I preferred the `is_found` allocation rather than the element shifts. But your solution seems to be more performant.",
      "user": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3564351976",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "commented",
      "id": 3566408583,
      "node_id": "IC_kwDOAP4Jqs7UkxOH",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3566408583",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T10:14:22Z",
      "updated_at": "2025-11-22T10:14:22Z",
      "author_association": "NONE",
      "body": "@theStack Yes  if we want to keep only the adversarial-scenario optimizations, we can drop sort stabilization and the extra heads.\r\n\r\nI like your idea of avoiding dynamic memory allocation. Thats a very interesting direction. On my machine, the scan completes in about **0.4s**, which feels like a good balance between simplicity and the optimization needed for the labeled case.\r\n\r\nBelow are the changes I had to make for your example to run on my machine and to record the scan time.\r\n\r\n```diff\r\ndiff --git a/examples/silentpayments.c b/examples/silentpayments.c\r\nindex 5e71e73..d43332f 100644\r\n--- a/examples/silentpayments.c\r\n+++ b/examples/silentpayments.c\r\n@@ -10,6 +10,7 @@\r\n #include <stdio.h>\r\n #include <stdlib.h>\r\n #include <string.h>\r\n+#include <time.h>\r\n \r\n #include <secp256k1_extrakeys.h>\r\n #include <secp256k1_silentpayments.h>\r\n@@ -112,15 +113,21 @@ const unsigned char* label_lookup(\r\n     return NULL;\r\n }\r\n \r\n+static secp256k1_xonly_pubkey tx_inputs[N_INPUTS];\r\n+static const secp256k1_xonly_pubkey *tx_input_ptrs[N_INPUTS];\r\n+static secp256k1_xonly_pubkey tx_outputs[N_OUTPUTS];\r\n+static secp256k1_xonly_pubkey *tx_output_ptrs[N_OUTPUTS];\r\n+static secp256k1_silentpayments_found_output found_outputs[N_OUTPUTS];\r\n+static secp256k1_silentpayments_found_output *found_output_ptrs[N_OUTPUTS];\r\n+static secp256k1_silentpayments_recipient recipients[N_OUTPUTS];\r\n+static const secp256k1_silentpayments_recipient *recipient_ptrs[N_OUTPUTS];\r\n+/* 2D array for holding multiple public key pairs. The second index, i.e., [2],\r\n+ * is to represent the spend and scan public keys. */\r\n+static unsigned char (*sp_addresses[N_OUTPUTS])[2][33];\r\n+\r\n int main(void) {\r\n     unsigned char randomize[32];\r\n     unsigned char serialized_xonly[32];\r\n-    secp256k1_xonly_pubkey tx_inputs[N_INPUTS];\r\n-    const secp256k1_xonly_pubkey *tx_input_ptrs[N_INPUTS];\r\n-    secp256k1_xonly_pubkey tx_outputs[N_OUTPUTS];\r\n-    secp256k1_xonly_pubkey *tx_output_ptrs[N_OUTPUTS];\r\n-    secp256k1_silentpayments_found_output found_outputs[N_OUTPUTS];\r\n-    secp256k1_silentpayments_found_output *found_output_ptrs[N_OUTPUTS];\r\n     secp256k1_silentpayments_prevouts_summary prevouts_summary;\r\n     secp256k1_pubkey unlabeled_spend_pubkey;\r\n     struct labels_cache bob_labels_cache;\r\n@@ -209,11 +216,6 @@ int main(void) {\r\n     {\r\n         secp256k1_keypair sender_keypairs[N_INPUTS];\r\n         const secp256k1_keypair *sender_keypair_ptrs[N_INPUTS];\r\n-        secp256k1_silentpayments_recipient recipients[N_OUTPUTS];\r\n-        const secp256k1_silentpayments_recipient *recipient_ptrs[N_OUTPUTS];\r\n-        /* 2D array for holding multiple public key pairs. The second index, i.e., [2],\r\n-         * is to represent the spend and scan public keys. */\r\n-        unsigned char (*sp_addresses[N_OUTPUTS])[2][33];\r\n         unsigned char seckey[32];\r\n \r\n         printf(\"Sending...\\n\");\r\n@@ -340,6 +342,9 @@ int main(void) {\r\n              *        `secp256k1_silentpayments_recipient_prevouts_summary_create`\r\n              *     2. Call `secp256k1_silentpayments_recipient_scan_outputs`\r\n              */\r\n+            clock_t start, end;\r\n+            double cpu_time_used;\r\n+\r\n             ret = secp256k1_silentpayments_recipient_prevouts_summary_create(ctx,\r\n                 &prevouts_summary,\r\n                 smallest_outpoint,\r\n@@ -356,14 +361,20 @@ int main(void) {\r\n \r\n             /* Scan the transaction */\r\n             n_found_outputs = 0;\r\n+            \r\n+            start = clock();\r\n             ret = secp256k1_silentpayments_recipient_scan_outputs(ctx,\r\n                 found_output_ptrs, &n_found_outputs,\r\n-                (const secp256k1_xonly_pubkey * const *)tx_output_ptrs, N_OUTPUTS,\r\n+                (const secp256k1_xonly_pubkey **)tx_output_ptrs, N_OUTPUTS,\r\n                 bob_scan_key,\r\n                 &prevouts_summary,\r\n                 &unlabeled_spend_pubkey,\r\n                 label_lookup, &bob_labels_cache /* NULL, NULL for no labels */\r\n             );\r\n+            end = clock();\r\n+            cpu_time_used = ((double) (end - start)) / CLOCKS_PER_SEC;\r\n+            printf(\"Bob's scan took %f seconds\\n\", cpu_time_used);\r\n+            \r\n             if (!ret) {\r\n                 printf(\"This transaction is not valid for Silent Payments, skipping.\\n\");\r\n                 return EXIT_SUCCESS;\r\n@@ -435,7 +446,7 @@ int main(void) {\r\n             n_found_outputs = 0;\r\n             ret = secp256k1_silentpayments_recipient_scan_outputs(ctx,\r\n                 found_output_ptrs, &n_found_outputs,\r\n-                (const secp256k1_xonly_pubkey * const *)tx_output_ptrs, 1, /* dummy scan with one output (we only care about Bob) */\r\n+                (const secp256k1_xonly_pubkey **)tx_output_ptrs, 1, /* dummy scan with one output (we only care about Bob) */\r\n                 carol_scan_key,\r\n                 &prevouts_summary,\r\n                 &unlabeled_spend_pubkey,\r\n```",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3566408583",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21113780100,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATqereE",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21113780100",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T10:14:23Z"
    },
    {
      "event": "subscribed",
      "id": 21113780115,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATqereT",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21113780115",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T10:14:23Z"
    },
    {
      "event": "commented",
      "id": 3566870041,
      "node_id": "IC_kwDOAP4Jqs7Umh4Z",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3566870041",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:38Z",
      "updated_at": "2025-11-22T16:39:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "@nymius, @w0xlt: Thanks once again for the quick feedback and for benchmarking! Shortly after my previous comment, I've been notified about yet another approach to tackle the worst-case scanning time attack (kudos to @furszy for bringing up the idea!), that I think is even more elegant: we can use the pointers in the `tx_outputs` list directly to track outputs by setting them to `NULL` if one has been found, and accordingly only treat them if they are non-NULL. With this, it's an only four lines of code change: https://github.com/theStack/secp256k1/commit/2087f9209df35764745dd744051e3d125d3c6b43. It kind of combines the previous two approaches of https://github.com/jonasnick/secp256k1/commit/311b4ebb2bf6612c46cefd80a8812d9c9b5dc6c4 and https://github.com/theStack/secp256k1/commit/9aba470 (-> mark spent outputs, but not in a newly allocated array, but by modifying the `tx_outputs` input list, in order to avoid dynamic memory allocation), with very similar run-time results.\r\n\r\nThe only tiny drawback about these non-malloc approaches might be that something that is conceptually an \"in\" parameter is modified, which might be a bit unsound in a strict API design sense. On the other hand, it shouldn't matter for the user (I doubt that these lists passed in would ever be reused for anything else after by the callers), and we already do the same in the sending API for the recipients, so it's probably fine.\r\n\r\n> @theStack Yes  if we want to keep only the adversarial-scenario optimizations, we can drop sort stabilization and the extra heads.\r\n\r\nThe way I see it currently, code paths for non-adversarial scenarios with increasing k values would be hit so rarely in practice, that I'm sceptical that it's worth it put much effort into those optimizations. When scanning, the vast majority of transactions won't have any matches in the first place. Out of those few that _do have a match_, the vast majority will very likely again not contain any repeated recipient (IMHO it doesn't make that much sense to do that, unless the recipient explicitly asks \"I want to receive my payment split up in multiple UTXOs, but still in a single tx\"?), so in the bigger picture those optimizations wouldn't matter all that much, and I'd assume that the dominant factor should be by far all the (unavoidable) ECDH computations per transaction. But that's still more of a guess and it's still good to already have optimization ideas at hand if we need them in the future.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3566870041",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21115996548,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATqnImE",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996548",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:39Z"
    },
    {
      "event": "subscribed",
      "id": 21115996556,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATqnImM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996556",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "mentioned",
      "id": 21115996562,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATqnImS",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996562",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "subscribed",
      "id": 21115996571,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATqnImb",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996571",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "mentioned",
      "id": 21115996577,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATqnImh",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996577",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "subscribed",
      "id": 21115996581,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATqnIml",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996581",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "mentioned",
      "id": 21115996585,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATqnImp",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996585",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "subscribed",
      "id": 21115996592,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATqnImw",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21115996592",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:39:40Z"
    },
    {
      "event": "commented",
      "id": 3567528551,
      "node_id": "IC_kwDOAP4Jqs7UpCpn",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3567528551",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-23T06:06:05Z",
      "updated_at": "2025-11-23T06:06:05Z",
      "author_association": "NONE",
      "body": "@theStack Thanks for continuing to refine the optimization. The deletion approach performs slightly better (0.40 s vs. 0.45 s), likely because deleting items shrinks the array and cuts the number of loop iterations by about 50% compared to nullifying them.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3567528551",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21119855419,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATq12s7",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21119855419",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-23T06:06:06Z"
    },
    {
      "event": "subscribed",
      "id": 21119855423,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATq12s_",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21119855423",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-23T06:06:06Z"
    },
    {
      "event": "referenced",
      "id": 21151923870,
      "node_id": "REFE_lADOAP4Jqs7VEWwNzwAAAATswL6e",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21151923870",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "1c8233acf208a6f935fc11161feda6c0775945e6",
      "commit_url": "https://api.github.com/repos/theStack/secp256k1/commits/1c8233acf208a6f935fc11161feda6c0775945e6",
      "created_at": "2025-11-25T00:31:12Z"
    },
    {
      "event": "referenced",
      "id": 21170249357,
      "node_id": "REFE_lADOAP4Jqs7VEWwNzwAAAATt2F6N",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21170249357",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c16252ddccdeaefdc6c4ec4425ddda91ee813320",
      "commit_url": "https://api.github.com/repos/theStack/secp256k1/commits/c16252ddccdeaefdc6c4ec4425ddda91ee813320",
      "created_at": "2025-11-25T17:28:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21172132445,
      "node_id": "HRFPE_lADOAP4Jqs7VEWwNzwAAAATt9Rpd",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21172132445",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "650b2fb6256a8df06e4193003deb4879f52bf72c",
      "commit_url": "https://api.github.com/repos/theStack/secp256k1/commits/650b2fb6256a8df06e4193003deb4879f52bf72c",
      "created_at": "2025-11-25T19:07:56Z"
    },
    {
      "event": "commented",
      "id": 3577161237,
      "node_id": "IC_kwDOAP4Jqs7VNyYV",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3577161237",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-25T19:08:27Z",
      "updated_at": "2025-12-01T23:42:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "To summarize, the following table shows the proposed mitigations for the worst-case scanning attack so far, with benchmark results from my machine. The [previous baseline commit](https://github.com/bitcoin-core/secp256k1/commit/1df4287eb8daa34a07888300e0b18ba1c97a3432) with the worst-case example has been updated to include [@w0xlt's changes](https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3566408583), in order to work without stack size limit changes.\r\n(EDIT: **These benchmark results are based on a baseline that doesn't represent the worst-case and are thus not representative, as [noticed by w0xlt below](https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3592403663).**)\r\n| Branch                                                | Approach                                                 | Runtime |\r\n|-------------------------------------------------------|----------------------------------------------------------|------------------------------------------------|\r\n| https://github.com/theStack/secp256k1/commit/c16252ddccdeaefdc6c4ec4425ddda91ee813320 (Branch [baseline](https://github.com/theStack/secp256k1/tree/pr1765_worstcase_scan_baseline))                    | modified example to exercise worst-case scanning, no fix                                                 | 641.391838s                                    |\r\n| https://github.com/theStack/secp256k1/commit/ec2797715ac51ebe9d57e396d1cb46d4fd474eab (Branch [fix1_...](https://github.com/theStack/secp256k1/tree/pr1765_worstcase_scan_fix1_mark-found-outputs-calloc))  | mark found outputs in `calloc`ed array                   | 0.543969s                                      |\r\n| https://github.com/theStack/secp256k1/commit/135ca0a194f871f5be9fa78d47c4aad8e13a06e0 (Branch [fix2_...](https://github.com/theStack/secp256k1/tree/pr1765_worstcase_scan_fix2_remove-found-outputs))       | remove matched outputs by shifting remaining entries                                   | 0.514952s                                      |\r\n| https://github.com/theStack/secp256k1/commit/8360150954facf9887ebdc687dada781ddcfec9a (Branch [fix3_...](https://github.com/theStack/secp256k1/tree/pr1765_worstcase_scan_fix3_mark-found-outputs-NULLify))| mark found outputs by `NULL` in `tx_outputs` input array | 0.544740s                                      |\r\n\r\nThe run-times of the fixes vary slightly (the removal approach \"fix2\" being the fastest, confirming https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3567528551 above), but are all in the same ballpark. I don't think exact performance results matter much here, as the goal of the mitigation should be to IMHO roughly cut the run-time down from \"minutes\" to \"seconds\" (and remember, this is already for the absolute worst-case, one giant non-standard transaction filling out a whole block, and it can only slow down _one_ specific SP recipient). Thus, I decided to pick the the simplest approach that avoids dynamic memory allocation, i.e. fix number 3 using `NULL` as marker in `tx_outputs`.\r\n\r\nWith that tackled, I believe that all of the open questions and TODOs are addressed now (updated the PR description accordingly). The latest force-push also includes a rebase on master (to include the CI fix #1771).",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3577161237",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "referenced",
      "id": 21224718533,
      "node_id": "REFE_lADOAP4Jqs7VEWwNzwAAAATxF4DF",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21224718533",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e7f7083b530a55c83ce9089a7244d2d9d67ac8b2",
      "commit_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits/e7f7083b530a55c83ce9089a7244d2d9d67ac8b2",
      "created_at": "2025-11-27T16:27:18Z"
    },
    {
      "event": "commented",
      "id": 3586704922,
      "node_id": "IC_kwDOAP4Jqs7VyMYa",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3586704922",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-27T16:30:54Z",
      "updated_at": "2025-11-27T16:30:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "I assume you want to rebase on master now that #1774 has been merged. ",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3586704922",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDgyNTZmYjNmNDFiYzdmM2Y3MDI2NzJkZWEzMTAyMjE2YTljYmNjNWM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8256fb3f41bc7f3f702672dea3102216a9cbcc5c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8256fb3f41bc7f3f702672dea3102216a9cbcc5c",
      "tree": {
        "sha": "af4832b131ea6cb129c53c3075c7572a9ae4f2a6",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/af4832b131ea6cb129c53c3075c7572a9ae4f2a6"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/e7f7083b530a55c83ce9089a7244d2d9d67ac8b2",
          "sha": "e7f7083b530a55c83ce9089a7244d2d9d67ac8b2",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/e7f7083b530a55c83ce9089a7244d2d9d67ac8b2"
        }
      ],
      "message": "build: add skeleton for new silentpayments (BIP352) module",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:36:01Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2023-09-27T15:22:14Z"
      },
      "sha": "8256fb3f41bc7f3f702672dea3102216a9cbcc5c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKGZmZmZkN2ZmOTgzNjhiMjk3NTljZDNkOTkzMzg5NmZiOWZhNjliMWY",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/ffffd7ff98368b29759cd3d9933896fb9fa69b1f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/ffffd7ff98368b29759cd3d9933896fb9fa69b1f",
      "tree": {
        "sha": "f99079f540f748dc47f5badab40d015fe6657e09",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/f99079f540f748dc47f5badab40d015fe6657e09"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8256fb3f41bc7f3f702672dea3102216a9cbcc5c",
          "sha": "8256fb3f41bc7f3f702672dea3102216a9cbcc5c",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8256fb3f41bc7f3f702672dea3102216a9cbcc5c"
        }
      ],
      "message": "silentpayments: sending\n\nAdd a routine for the entire sending flow which takes a set of private keys,\nthe smallest outpoint, and list of recipients and returns a list of\nx-only public keys by performing the following steps:\n\n1. Sum up the private keys\n2. Calculate the input_hash\n3. For each recipient group:\n    3a. Calculate a shared secret\n    3b. Create the requested number of outputs\n\nThis function assumes a single sender context in that it requires the\nsender to have access to all of the private keys. In the future, this\nAPI may be expanded to allow for a multiple senders or for a single\nsender who does not have access to all private keys at any given time,\nbut for now these modes are considered out of scope / unsafe.\n\nInternal to the library, add:\n\n1. A function for creating shared secrets (i.e., a*B or b*A)\n2. A function for generating the \"SharedSecret\" tagged hash\n3. A function for creating a single output public key",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:41:32Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2024-03-25T16:23:37Z"
      },
      "sha": "ffffd7ff98368b29759cd3d9933896fb9fa69b1f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDkxM2ZkZWU3ZTE3YjBmNjlhOGU3MGI5ODc2YmU0N2M2YTg4N2ZmMzI",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/913fdee7e17b0f69a8e70b9876be47c6a887ff32",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/913fdee7e17b0f69a8e70b9876be47c6a887ff32",
      "tree": {
        "sha": "1202e48c14ee8276dd728a6e0fe851bd50eb5152",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/1202e48c14ee8276dd728a6e0fe851bd50eb5152"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/ffffd7ff98368b29759cd3d9933896fb9fa69b1f",
          "sha": "ffffd7ff98368b29759cd3d9933896fb9fa69b1f",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/ffffd7ff98368b29759cd3d9933896fb9fa69b1f"
        }
      ],
      "message": "silentpayments: recipient label support\n\nAdd function for creating a label tweak. This requires a tagged hash\nfunction for labels. This function is used by the receiver for creating\nlabels to be used for a) creating labeled addresses and b) to populate\na labels cache when scanning.\n\nAdd function for creating a labeled spend pubkey. This involves taking\na label tweak, turning it into a public key and adding it to the spend\npublic key. This function is used by the receiver to create a labeled\nsilent payment address.\n\nAdd tests for the label API.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:41:35Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2024-01-22T17:56:05Z"
      },
      "sha": "913fdee7e17b0f69a8e70b9876be47c6a887ff32"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDhjYWYxOWMzYWNkZjA2ZWQ1NDdlNTk4MGZiMzM5OTkwZGY0NzBiZWQ",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8caf19c3acdf06ed547e5980fb339990df470bed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8caf19c3acdf06ed547e5980fb339990df470bed",
      "tree": {
        "sha": "f923418e363df9667dbf9c2e7e8c02809c1a827a",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/f923418e363df9667dbf9c2e7e8c02809c1a827a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/913fdee7e17b0f69a8e70b9876be47c6a887ff32",
          "sha": "913fdee7e17b0f69a8e70b9876be47c6a887ff32",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/913fdee7e17b0f69a8e70b9876be47c6a887ff32"
        }
      ],
      "message": "silentpayments: receiving\n\nAdd routine for scanning a transaction and returning the necessary\nspending data for any found outputs. This function works with labels via\na lookup callback and requires access to the transaction outputs.\nRequiring access to the transaction outputs is not suitable for light\nclients, but light client support is enabled in the next commit.\n\nAdd an opaque data type for passing around the prevout public key sum\nand the input hash tweak (input_hash). This data is passed to the scanner\nbefore the ECDH step as two separate elements so that the scanner can\nmultiply the scan_key * input_hash before doing ECDH.\n\nFinally, add test coverage for the receiving API.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:29Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2025-10-02T14:18:13Z"
      },
      "sha": "8caf19c3acdf06ed547e5980fb339990df470bed"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDhlZGIwNGRkMjNmOTQyZGQwYjQ5Y2NhZTNiMDk0NTcyYTUxMzJkYTM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8edb04dd23f942dd0b49ccae3b094572a5132da3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8edb04dd23f942dd0b49ccae3b094572a5132da3",
      "tree": {
        "sha": "468a5785722ae7c8d8af7f81bb6e9a5db3eb6203",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/468a5785722ae7c8d8af7f81bb6e9a5db3eb6203"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8caf19c3acdf06ed547e5980fb339990df470bed",
          "sha": "8caf19c3acdf06ed547e5980fb339990df470bed",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8caf19c3acdf06ed547e5980fb339990df470bed"
        }
      ],
      "message": "silentpayments: add examples/silentpayments.c\n\nDemonstrate sending and scanning on full nodes.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:32Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2024-04-15T17:36:29Z"
      },
      "sha": "8edb04dd23f942dd0b49ccae3b094572a5132da3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKGQ1ZjkzNTc0Yjg1OTViZGY0MDQwMGNmYWVhNzNjMDkzOTk4MjQ1ZWM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/d5f93574b8595bdf40400cfaea73c093998245ec",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/d5f93574b8595bdf40400cfaea73c093998245ec",
      "tree": {
        "sha": "2e400af8ae7987319d11e942caa2709c0a9ad042",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/2e400af8ae7987319d11e942caa2709c0a9ad042"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8edb04dd23f942dd0b49ccae3b094572a5132da3",
          "sha": "8edb04dd23f942dd0b49ccae3b094572a5132da3",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8edb04dd23f942dd0b49ccae3b094572a5132da3"
        }
      ],
      "message": "silentpayments: add benchmarks for scanning\n\nAdd a benchmark for a full transaction scan.\nOnly benchmarks for scanning are added as this is the most\nperformance critical portion of the protocol.\n\nCo-authored-by: Sebastian Falbesoner <91535+thestack@users.noreply.github.com>",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:32Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2024-04-25T17:33:35Z"
      },
      "sha": "d5f93574b8595bdf40400cfaea73c093998245ec"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDBkMDg1Yjg2MTZhM2FlNDAyNjAyYTYzMjFmMzkwMmU0NWMxMDVlNTE",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/0d085b8616a3ae402602a6321f3902e45c105e51",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/0d085b8616a3ae402602a6321f3902e45c105e51",
      "tree": {
        "sha": "fe7a8b1ac020ca19936dfd86e2243cf99f1b11c1",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/fe7a8b1ac020ca19936dfd86e2243cf99f1b11c1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/d5f93574b8595bdf40400cfaea73c093998245ec",
          "sha": "d5f93574b8595bdf40400cfaea73c093998245ec",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/d5f93574b8595bdf40400cfaea73c093998245ec"
        }
      ],
      "message": "tests: add BIP-352 test vectors\n\nAdd the BIP-352 test vectors. The vectors are generated with a Python script\nthat converts the .json file from the BIP to C code:\n\n$ ./tools/tests_silentpayments_generate.py test_vectors.json > ./src/modules/silentpayments/vectors.h\n\nCo-authored-by: Ron <4712150+macgyver13@users.noreply.github.com>\nCo-authored-by: Sebastian Falbesoner <91535+thestack@users.noreply.github.com>\nCo-authored-by: Tim Ruffing <1071625+real-or-random@users.noreply.github.com>",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:33Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2024-07-02T17:45:43Z"
      },
      "sha": "0d085b8616a3ae402602a6321f3902e45c105e51"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKGEwNTU5ZjU1YWFmMmUyMjM1ZjIwZmFmNmNlZmZjOWE5MmY3NjljMjE",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/a0559f55aaf2e2235f20faf6ceffc9a92f769c21",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/a0559f55aaf2e2235f20faf6ceffc9a92f769c21",
      "tree": {
        "sha": "0d3cb53dc8e623d2ec20c838c172538dc05487e4",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/0d3cb53dc8e623d2ec20c838c172538dc05487e4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/0d085b8616a3ae402602a6321f3902e45c105e51",
          "sha": "0d085b8616a3ae402602a6321f3902e45c105e51",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/0d085b8616a3ae402602a6321f3902e45c105e51"
        }
      ],
      "message": "tests: add constant time tests\n\nCo-authored-by: Jonas Nick <2582071+jonasnick@users.noreply.github.com>\nCo-authored-by: Sebastian Falbesoner <91535+thestack@users.noreply.github.com>",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:33Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2024-11-07T12:18:59Z"
      },
      "sha": "a0559f55aaf2e2235f20faf6ceffc9a92f769c21"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKDg0NTRhNDRhNjllMTc4MmQxMjEwMTI4OTY5ZTg3NGJjZmU2NzAwMDg",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8454a44a69e1782d1210128969e874bcfe670008",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8454a44a69e1782d1210128969e874bcfe670008",
      "tree": {
        "sha": "211a648ea8e90714d6e85196db93d47e4f9bb198",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/211a648ea8e90714d6e85196db93d47e4f9bb198"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/a0559f55aaf2e2235f20faf6ceffc9a92f769c21",
          "sha": "a0559f55aaf2e2235f20faf6ceffc9a92f769c21",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/a0559f55aaf2e2235f20faf6ceffc9a92f769c21"
        }
      ],
      "message": "tests: add sha256 tag test\n\nTest midstate tags used in silent payments.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:33Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2025-08-15T08:46:46Z"
      },
      "sha": "8454a44a69e1782d1210128969e874bcfe670008"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKGM4NmVmN2IyMWJhMjhlNzcyNjcxYzEyMWJhOWUwMmQ1ODA2NTgwYjk",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/c86ef7b21ba28e772671c121ba9e02d5806580b9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/c86ef7b21ba28e772671c121ba9e02d5806580b9",
      "tree": {
        "sha": "ca6ccb214b867574a24717a2163bdce7d2cd5e46",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/ca6ccb214b867574a24717a2163bdce7d2cd5e46"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/8454a44a69e1782d1210128969e874bcfe670008",
          "sha": "8454a44a69e1782d1210128969e874bcfe670008",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/8454a44a69e1782d1210128969e874bcfe670008"
        }
      ],
      "message": "ci: enable silentpayments module",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:33Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2024-02-22T23:25:41Z"
      },
      "sha": "c86ef7b21ba28e772671c121ba9e02d5806580b9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOAP4JqtoAKGY5NmY0MWYyNGY4YTQzMzg0ZTU3YTA0ZDFjYjczNzk4YzU3OWI1OWE",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/f96f41f24f8a43384e57a04d1cb73798c579b59a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin-core/secp256k1/commit/f96f41f24f8a43384e57a04d1cb73798c579b59a",
      "tree": {
        "sha": "06a020a8ca0a26cfefed47e9a0e103905b631adb",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/trees/06a020a8ca0a26cfefed47e9a0e103905b631adb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/git/commits/c86ef7b21ba28e772671c121ba9e02d5806580b9",
          "sha": "c86ef7b21ba28e772671c121ba9e02d5806580b9",
          "html_url": "https://github.com/bitcoin-core/secp256k1/commit/c86ef7b21ba28e772671c121ba9e02d5806580b9"
        }
      ],
      "message": "docs: update README",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2025-11-27T17:45:33Z"
      },
      "author": {
        "name": "josibake",
        "email": "josibake@protonmail.com",
        "date": "2024-07-12T12:57:54Z"
      },
      "sha": "f96f41f24f8a43384e57a04d1cb73798c579b59a"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21232877891,
      "node_id": "HRFPE_lADOAP4Jqs7VEWwNzwAAAATxlAFD",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21232877891",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "f96f41f24f8a43384e57a04d1cb73798c579b59a",
      "commit_url": "https://api.github.com/repos/theStack/secp256k1/commits/f96f41f24f8a43384e57a04d1cb73798c579b59a",
      "created_at": "2025-11-27T23:45:39Z"
    },
    {
      "event": "commented",
      "id": 3587553645,
      "node_id": "IC_kwDOAP4Jqs7V1blt",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3587553645",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-28T00:12:55Z",
      "updated_at": "2025-11-28T00:12:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I assume you want to rebase on master now that #1774 has been merged.\r\n\r\nYes, done. Using the new `secp256k1_eckey_pubkey_serialize33` function, the [sending](https://github.com/bitcoin-core/secp256k1/pull/1765/commits/ffffd7ff98368b29759cd3d9933896fb9fa69b1f) and [receiving](https://github.com/bitcoin-core/secp256k1/pull/1765/commits/8caf19c3acdf06ed547e5980fb339990df470bed) commit diffs got a bit smaller (as outlined in https://github.com/bitcoin-core/secp256k1/pull/1765#pullrequestreview-3462461331), -13 LOC in total.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3587553645",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "commented",
      "id": 3591015668,
      "node_id": "IC_kwDOAP4Jqs7WCoz0",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3591015668",
      "actor": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-29T05:39:00Z",
      "updated_at": "2025-11-29T05:39:00Z",
      "author_association": "NONE",
      "body": "Thanks for the summary, I've checked the results. I agree with `fix3_*` branch as the final solution, is elegant and trade-offs are clear.",
      "user": {
        "login": "nymius",
        "id": 155548262,
        "node_id": "U_kgDOCUV6Zg",
        "avatar_url": "https://avatars.githubusercontent.com/u/155548262?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nymius",
        "html_url": "https://github.com/nymius",
        "followers_url": "https://api.github.com/users/nymius/followers",
        "following_url": "https://api.github.com/users/nymius/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nymius/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nymius/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nymius/subscriptions",
        "organizations_url": "https://api.github.com/users/nymius/orgs",
        "repos_url": "https://api.github.com/users/nymius/repos",
        "events_url": "https://api.github.com/users/nymius/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nymius/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3591015668",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "commented",
      "id": 3592403663,
      "node_id": "IC_kwDOAP4Jqs7WH7rP",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3592403663",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-30T09:47:14Z",
      "updated_at": "2025-11-30T09:47:14Z",
      "author_association": "NONE",
      "body": "Hi @theStack . That's not actually the worst case. The worst case is when the attacker shuffles the outputs randomly (or in any adversarial order). I modified your benchmark to randomly shuffle outputs, and scanning takes several minutes to hours with the current optimization proposal.\r\n\r\nhttps://github.com/w0xlt/secp256k1/commit/435cb96c2dc3c9d4a0fa967fb84432d8dd77783d\r\n\r\nThe issue is that the scanning function receives a label lookup callback, which makes it harder to build a sorted index upfront. Instead, for each output tweak index k, it linearly scans all transaction outputs  resulting in O(n) complexity. An attacker creating ~23,000 unordered outputs can make scanning take hours.\r\n\r\nIf we slightly change the API to replace the label lookup callback with a label entry set, we can sort once and search fast:\r\n1. Build a sorted index of outputs by serialized x-only pubkey  O(n log n) upfront\r\n2. Binary search for each candidate  O(log n) per lookup\r\n\r\nThat way, scanning 23,255 adversarially-ordered outputs drops from hours to ~0.3s. The optimization is purely receiver-side, requires no protocol changes, and works regardless of output ordering. This reduces architectural flexibility, though.\r\n\r\nBefore: for each k, scan all n outputs   O(k  n)  O(n)\r\nAfter:  sort outputs, binary search      O(n log n + k log n)\r\n\r\nThe following commit implements this proposal:\r\nhttps://github.com/w0xlt/secp256k1/commit/2305d7361ad4a2ead9e335ea76ea4fc047e275cf\r\n\r\nYou can verify by running `./build/bin/silentpayments_example` (ordered) and `./build/bin/silentpayments_shuffled_example` (shuffled).",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3592403663",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21255618065,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATy7v4R",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21255618065",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-30T09:47:15Z"
    },
    {
      "event": "subscribed",
      "id": 21255618072,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATy7v4Y",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21255618072",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-30T09:47:15Z"
    },
    {
      "event": "commented",
      "id": 3594230411,
      "node_id": "IC_kwDOAP4Jqs7WO5qL",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3594230411",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T02:12:07Z",
      "updated_at": "2025-12-01T02:12:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Hi @theStack . That's not actually the worst case. The worst case is when the attacker shuffles the outputs randomly (or in any adversarial order). \r\n\r\n@w0xlt: Good catch, I indeed missed involving the output order for the worst-case scenario, so https://github.com/theStack/secp256k1/commit/c16252ddccdeaefdc6c4ec4425ddda91ee813320 is not a useful target (in hindsight, the benchmark results look too good to be true, and my previous words of \"we can't rely on the attacker using a specific implementation\" strike back very hard). Thanks for the updated benchmark and the new worst-case fix proposal!\r\n\r\n> I modified your benchmark to randomly shuffle outputs, and scanning takes several minutes to hours with the current optimization proposal.\r\n\r\nAre you sure it could take up \"to hours\"? That would be significantly worse than the previous baseline commit (~10 minutes on my machine), which seems implausible to me. In the unoptimized scanning implementation, the run-time should be very much independent on the order of outputs, as the total number of inner loop iterations is constant ($1+2+3...+N = (N*(N+1))/2 = 270409140$ for our worst-case scenario of $N = 23255$), and it'd be very surprising if any of the three proposed optimizations perform _worse_ than the baseline for shuffled outputs.\r\n\r\nI only did two runs so far with your shuffle-patch added, and got runtimes of ~10 minutes (unoptimized) and ~5 minutes (NULL-ify patch, \"fix3\"). Will do some more thorough benchmarks tomorrow, including your proposed solution.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3594230411",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21263573644,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATzaGKM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21263573644",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T02:12:09Z"
    },
    {
      "event": "subscribed",
      "id": 21263573661,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATzaGKd",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21263573661",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T02:12:09Z"
    },
    {
      "event": "mentioned",
      "id": 21263573675,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATzaGKr",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21263573675",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T02:12:09Z"
    },
    {
      "event": "subscribed",
      "id": 21263573682,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATzaGKy",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21263573682",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T02:12:09Z"
    },
    {
      "event": "commented",
      "id": 3594425270,
      "node_id": "IC_kwDOAP4Jqs7WPpO2",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3594425270",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T03:57:25Z",
      "updated_at": "2025-12-01T03:57:25Z",
      "author_association": "NONE",
      "body": "@theStack Thanks for looking into this.\r\nSorry if I wasnt clear earlier. The shuffled benchmark does perform better in the optimized version than in the baseline, but it loses the sub-second scan times.\r\nThe new proposed approach (assuming it works as expected) should keep those sub-second times even on the shuffled benchmark.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3594425270",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21264784903,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAATzet4H",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21264784903",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T03:57:26Z"
    },
    {
      "event": "subscribed",
      "id": 21264784931,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAATzet4j",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21264784931",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T03:57:26Z"
    },
    {
      "event": "commented",
      "id": 3598367471,
      "node_id": "IC_kwDOAP4Jqs7Werrv",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3598367471",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T18:55:36Z",
      "updated_at": "2025-12-02T00:54:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "@w0xlt: I've looked at your proposed scanning implementation https://github.com/w0xlt/secp256k1/commit/2305d7361ad4a2ead9e335ea76ea4fc047e275cf and can confirm that it fixes the worst-case scanning attack, as the run-time of the modified example with shuffled outputs is reduced to <1s. What makes this different approach potentially interesting is that it could also to speed up the common case (i.e. no matches), as the number of point additions needed for labels scanning seems to be significantly smaller for the small-scale user (where N_LABELS < 2 * N_OUTPUTS for the average transaction; if N_LABELS=1 and we assume the average transaction to scan for has N_OUTPUTS=2, your approach is 4x faster w.r.t. needed point additions). To verify that I understood it correctly and make the idea digestible to other interested reviewers, I've tried to summarize the current PR's scanning approach (as proposed in BIP-352) vs. your approach on the following gist, written in a somewhat hand-wavy way, I hope the pseudo-code is understandable: https://gist.github.com/theStack/25c77747838610931e8bbeb9d76faf78. Please let me know if I got that right, I _think_ the approach leads to the same result, but I'm still trying to wrap my head around it.\r\n// EDIT: I've been told by @setavenger that this approach is also used by [Frigate Electrum Server](https://github.com/sparrowwallet/frigate) and the [BlindBit wallet](https://github.com/setavenger/blindbit-desktop).\r\n\r\nOn the other hand, I'm still uncertain on whether adding the additional code complexity and the involvement of dynamic memory allocation at all in a secp256k1 module is worth all this, considering that we are talking about an attack that costs an adversary money (at least the fees for the whole block space) and can only slow down one specific SP recipient. It seems a very unusual kind of attack. Changing the scanning API at this point seems also questionable, as I think it went already through several iterations and refinements over the years, and I think the \"pass labels directly\" approach is slower for users with a higher number of labels involved. Also, the mental load for reviewers is significantly higher if the approach doesn't follow the algorithm as specified in BIP-352, as they have to convince themselves that the result is equivalent.\r\n\r\nI'm hence debating on whether one solution could be to keep the PR simply as-is and accept the fact that an adversary can slow down a single entity for a few minutes (for non-standard transactions), to a few seconds (for standard transactions, i.e. tx size <= 100kvB). I don't have a good final answer to this question myself, but want to discuss is at least and come to a decision that both maintainers and users are on board with before taking any further action.\r\n\r\nMy (in retrospect somewhat naive) hope was that there could be a simple few-lines fix for reducing the worst-case scanning attack down to seconds without the need of dynamic memory allocation, but such an easy fix doesn't seem to be in sight.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3598367471",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21285055146,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAAT0sCqq",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21285055146",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T18:55:37Z"
    },
    {
      "event": "subscribed",
      "id": 21285055200,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAAT0sCrg",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21285055200",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T18:55:37Z"
    },
    {
      "event": "mentioned",
      "id": 21291762483,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAAT1FoMz",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21291762483",
      "actor": {
        "login": "setavenger",
        "id": 34041358,
        "node_id": "MDQ6VXNlcjM0MDQxMzU4",
        "avatar_url": "https://avatars.githubusercontent.com/u/34041358?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/setavenger",
        "html_url": "https://github.com/setavenger",
        "followers_url": "https://api.github.com/users/setavenger/followers",
        "following_url": "https://api.github.com/users/setavenger/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/setavenger/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/setavenger/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/setavenger/subscriptions",
        "organizations_url": "https://api.github.com/users/setavenger/orgs",
        "repos_url": "https://api.github.com/users/setavenger/repos",
        "events_url": "https://api.github.com/users/setavenger/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/setavenger/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T00:54:55Z"
    },
    {
      "event": "subscribed",
      "id": 21291762492,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAAT1FoM8",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21291762492",
      "actor": {
        "login": "setavenger",
        "id": 34041358,
        "node_id": "MDQ6VXNlcjM0MDQxMzU4",
        "avatar_url": "https://avatars.githubusercontent.com/u/34041358?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/setavenger",
        "html_url": "https://github.com/setavenger",
        "followers_url": "https://api.github.com/users/setavenger/followers",
        "following_url": "https://api.github.com/users/setavenger/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/setavenger/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/setavenger/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/setavenger/subscriptions",
        "organizations_url": "https://api.github.com/users/setavenger/orgs",
        "repos_url": "https://api.github.com/users/setavenger/repos",
        "events_url": "https://api.github.com/users/setavenger/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/setavenger/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T00:54:55Z"
    },
    {
      "event": "commented",
      "id": 3600182512,
      "node_id": "IC_kwDOAP4Jqs7Wlmzw",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3600182512",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T04:51:53Z",
      "updated_at": "2025-12-02T04:51:53Z",
      "author_association": "NONE",
      "body": "Hi @theStack thanks a lot for taking the time to review the proposal and write up the comparison.\r\n\r\nMy view is that we should aim for the most efficient and resilient solution, even if the attack scenario is somewhat unusual. The spec can be updated as needed to reflect improvements. Independently of adversarial cases, reducing scanning time from several minutes to under a second is a major win for user experience.\r\n\r\nRegarding complexity: although this approach adds some moving parts, the underlying idea (e.g., using binary search) is conceptually straightforward, so I dont think it should pose a significant burden by itself.\r\n\r\nAs for the dynamic memory concern, the allocation doesnt necessarily have to happen inside the secp256k1 module. We could let the caller provide the required workspace. For example, could we leverage `secp256k1_scratch_space` here?",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3600182512",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21295040889,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAAT1SIl5",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21295040889",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T04:51:54Z"
    },
    {
      "event": "subscribed",
      "id": 21295040919,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAAT1SImX",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21295040919",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T04:51:54Z"
    },
    {
      "event": "commented",
      "id": 3603093854,
      "node_id": "IC_kwDOAP4Jqs7Wwtle",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3603093854",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T17:03:54Z",
      "updated_at": "2025-12-02T17:03:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "@w0xlt: After tinkering a bit with your proposed implementation https://github.com/w0xlt/secp256k1/commit/2305d7361ad4a2ead9e335ea76ea4fc047e275cf, I found that it could be significantly simplified, and it turned out we don't even need dynamic memory allocation:\r\n* instead of building an explicit index, we can simply sort the user-supplied `tx_outputs` array of x-only pubkeys in place and perform binary search directly on that (using the existing `secp256k1_pubkey_xonly_pubkey_cmp`)\r\n* the preparation of the label set group elements array is not needed as well; `_pubkey_load` is a very cheap operation, so it doesn't hurt to call it repeatedly in each k loop iteration (remember that the common case is not having a match, i.e. k doesn't exceed 0 for most scanned transactions)\r\n\r\nDoing this in https://github.com/theStack/secp256k1/commit/1a40e14d31089960d4113b49eeffd287b81cd2a1 still keeps the worst-case scanning benchmark time down at ~450ms on my machine.\r\nAdmittedly, there is a tiny bit of run-time overhead introduced with the simplification (repeated x-only pubkey serialization for the common case), but I don't think that matters much, considering that the involved elliptic curve operations are likely orders of magnitude more expensive than that. With these new insights, I can retract my doubts about code complexity and dynamic memory allocation of your proposed approach, and it's good to have two potential scanning implementations. :+1: \r\n\r\nIt should be pointed out that the \"label set\" approach doesn't come for free though: one major drawback is that for users with a larger label set, the typical scanning scenario (assuming most txs don't have more than just a few outputs) can be slower at some point, as the number of point additions is higher than with the \"BIP\" approach. So if we follow your approach, it's better for small-case users and to eliminate the worst-case scanning attack, but users with a lot of labels are likely not happy with it and would very much prefer the \"BIP\" scanning approach. Not really sure how to deal with that and what to prioritize. (Provide two scanning implementations and let the user pick? :grimacing: )\r\n\r\nI'll anyways try to come up with another \"modified example\" benchmark to better verify the claims about typical scanning scenarios, depending on the number of labels involved and transaction output count. We have spent a good time on the worst-scanning scenario now, but it would be wrong to solely optimize for that and get the typical scanning scenario out of sight.\r\n\r\n> Independently of adversarial cases, reducing scanning time from several minutes to under a second is a major win for user experience.\r\n\r\nI don't agree with that statement, as I can't think of a legit _non_-adversarial case that would lead to scanning times of several minutes, in particular as this would at the minimum involve creating a large non-standard transaction. When considering user experience, by far the most relevant case I'd consider is the \"no match\" scenario (one k loop iteration), as it is the most frequent one, followed by the \"single match\" (two k loop iterations) scenario. Everything above that should be already quite rare in practice.\r\n\r\n> As for the dynamic memory concern, the allocation doesnt necessarily have to happen inside the secp256k1 module. We could let the caller provide the required workspace. For example, could we leverage secp256k1_scratch_space here?\r\n\r\nGood question. Right now, the scratch space API is not even exposed to the user. Btw I don't think dynamic memory allocation is a strict no-go in general, it just seems that there are still some open questions around that area, and waiting until they are all tackled would probably delay the PR for an unforeseeable time. It seems that as of now we can easily avoid dynamic memory allocation anyways though, in both of the proposed implementations.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#issuecomment-3603093854",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1765"
    },
    {
      "event": "mentioned",
      "id": 21311825129,
      "node_id": "MEE_lADOAP4Jqs7VEWwNzwAAAAT2SKTp",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21311825129",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T17:03:56Z"
    },
    {
      "event": "subscribed",
      "id": 21311825171,
      "node_id": "SE_lADOAP4Jqs7VEWwNzwAAAAT2SKUT",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/21311825171",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-02T17:03:56Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments/2528111908",
      "pull_request_review_id": 3465700051,
      "id": 2528111908,
      "node_id": "PRRC_kwDOAP4Jqs6Wr-0k",
      "diff_hunk": "@@ -0,0 +1,685 @@\n+/***********************************************************************\n+ * Distributed under the MIT software license, see the accompanying    *\n+ * file COPYING or https://www.opensource.org/licenses/mit-license.php.*\n+ ***********************************************************************/\n+\n+#ifndef SECP256K1_MODULE_SILENTPAYMENTS_MAIN_H\n+#define SECP256K1_MODULE_SILENTPAYMENTS_MAIN_H\n+\n+#include \"../../../include/secp256k1.h\"\n+#include \"../../../include/secp256k1_extrakeys.h\"\n+#include \"../../../include/secp256k1_silentpayments.h\"\n+\n+#include \"../../eckey.h\"\n+#include \"../../ecmult.h\"\n+#include \"../../ecmult_const.h\"\n+#include \"../../ecmult_gen.h\"\n+#include \"../../group.h\"\n+#include \"../../hash.h\"\n+#include \"../../hsort.h\"\n+\n+/** magic bytes for ensuring prevouts_summary objects were initialized correctly. */\n+static const unsigned char secp256k1_silentpayments_prevouts_summary_magic[4] = { 0xa7, 0x1c, 0xd3, 0x5e };\n+\n+/** Sort an array of silent payment recipients. This is used to group recipients by scan pubkey to\n+ *  ensure the correct values of k are used when creating multiple outputs for a recipient.\n+ *\n+ *  Note: secp256k1_silentpayments_recipient_sort uses heap sort, which is unstable.\n+ *  Developers cannot and should not rely on deterministic sorting of _recipient objects.\n+ */\n+static int secp256k1_silentpayments_recipient_sort_cmp(const void* pk1, const void* pk2, void *ctx) {\n+    return secp256k1_ec_pubkey_cmp((secp256k1_context *)ctx,\n+        &(*(const secp256k1_silentpayments_recipient **)pk1)->scan_pubkey,\n+        &(*(const secp256k1_silentpayments_recipient **)pk2)->scan_pubkey\n+    );\n+}\n+\n+static void secp256k1_silentpayments_recipient_sort(const secp256k1_context* ctx, const secp256k1_silentpayments_recipient **recipients, size_t n_recipients) {\n+    /* Suppress wrong warning (fixed in MSVC 19.33) */\n+    #if defined(_MSC_VER) && (_MSC_VER < 1933)\n+    #pragma warning(push)\n+    #pragma warning(disable: 4090)\n+    #endif\n+\n+    secp256k1_hsort(recipients, n_recipients, sizeof(*recipients), secp256k1_silentpayments_recipient_sort_cmp, (void *)ctx);\n+\n+    #if defined(_MSC_VER) && (_MSC_VER < 1933)\n+    #pragma warning(pop)\n+    #endif\n+}\n+\n+/** Set hash state to the BIP340 tagged hash midstate for \"BIP0352/Inputs\". */\n+static void secp256k1_silentpayments_sha256_init_inputs(secp256k1_sha256* hash) {\n+    secp256k1_sha256_initialize(hash);\n+    hash->s[0] = 0xd4143ffcul;\n+    hash->s[1] = 0x012ea4b5ul;\n+    hash->s[2] = 0x36e21c8ful;\n+    hash->s[3] = 0xf7ec7b54ul;\n+    hash->s[4] = 0x4dd4e2acul;\n+    hash->s[5] = 0x9bcaa0a4ul;\n+    hash->s[6] = 0xe244899bul;\n+    hash->s[7] = 0xcd06903eul;\n+\n+    hash->bytes = 64;\n+}\n+\n+/** Callers must ensure that pubkey_sum is not the point at infinity before calling this function. */\n+static int secp256k1_silentpayments_calculate_input_hash_scalar(secp256k1_scalar *input_hash_scalar, const unsigned char *outpoint_smallest36, secp256k1_ge *pubkey_sum) {\n+    secp256k1_sha256 hash;\n+    unsigned char pubkey_sum_ser[33];\n+    unsigned char input_hash[32];\n+    size_t len;\n+    int ret, overflow;\n+\n+    secp256k1_silentpayments_sha256_init_inputs(&hash);\n+    secp256k1_sha256_write(&hash, outpoint_smallest36, 36);\n+    ret = secp256k1_eckey_pubkey_serialize(pubkey_sum, pubkey_sum_ser, &len, 1);\n+    VERIFY_CHECK(ret && len == sizeof(pubkey_sum_ser));\n+    secp256k1_sha256_write(&hash, pubkey_sum_ser, sizeof(pubkey_sum_ser));\n+    secp256k1_sha256_finalize(&hash, input_hash);\n+    /* Convert input_hash to a scalar.\n+     *\n+     * This can only fail if the output of the hash function is zero or greater than or equal to the curve order, which\n+     * happens with negligible probability. Normally, we would use VERIFY_CHECK as opposed to returning an error\n+     * since returning an error here would result in an untestable branch in the code. But in this case, we return\n+     * an error to ensure strict compliance with BIP0352.\n+     */\n+    secp256k1_scalar_set_b32(input_hash_scalar, input_hash, &overflow);\n+    ret &= !secp256k1_scalar_is_zero(input_hash_scalar);\n+    return ret & !overflow;\n+}\n+\n+static void secp256k1_silentpayments_create_shared_secret(const secp256k1_context *ctx, unsigned char *shared_secret33, const secp256k1_ge *public_component, const secp256k1_scalar *secret_component) {\n+    secp256k1_gej ss_j;\n+    secp256k1_ge ss;\n+    size_t len;\n+    int ret;\n+\n+    secp256k1_ecmult_const(&ss_j, public_component, secret_component);\n+    secp256k1_ge_set_gej(&ss, &ss_j);\n+    /* We declassify the shared secret group elemement because serializing a group element is a non-constant time operation. */\n+    secp256k1_declassify(ctx, &ss, sizeof(ss));\n+    /* This can only fail if the shared secret is the point at infinity, which should be\n+     * impossible at this point considering we have already validated the public key and\n+     * the secret key.\n+     */\n+    ret = secp256k1_eckey_pubkey_serialize(&ss, shared_secret33, &len, 1);\n+#ifdef VERIFY\n+    VERIFY_CHECK(ret && len == 33);\n+#else\n+    (void)ret;\n+#endif\n+\n+    /* Leaking these values would break indistinguishability of the transaction, so clear them. */\n+    secp256k1_ge_clear(&ss);\n+    secp256k1_gej_clear(&ss_j);\n+}\n+\n+/** Set hash state to the BIP340 tagged hash midstate for \"BIP0352/SharedSecret\". */\n+static void secp256k1_silentpayments_sha256_init_sharedsecret(secp256k1_sha256* hash) {\n+    secp256k1_sha256_initialize(hash);\n+    hash->s[0] = 0x88831537ul;\n+    hash->s[1] = 0x5127079bul;\n+    hash->s[2] = 0x69c2137bul;\n+    hash->s[3] = 0xab0303e6ul;\n+    hash->s[4] = 0x98fa21faul;\n+    hash->s[5] = 0x4a888523ul;\n+    hash->s[6] = 0xbd99daabul;\n+    hash->s[7] = 0xf25e5e0aul;\n+\n+    hash->bytes = 64;\n+}\n+\n+static int secp256k1_silentpayments_create_output_tweak(secp256k1_scalar *output_tweak_scalar, const unsigned char *shared_secret33, uint32_t k) {\n+    secp256k1_sha256 hash;\n+    unsigned char hash_ser[32];\n+    unsigned char k_serialized[4];\n+    int ret, overflow;\n+\n+    /* Compute hash(shared_secret || ser_32(k))  [sha256 with tag \"BIP0352/SharedSecret\"] */\n+    secp256k1_silentpayments_sha256_init_sharedsecret(&hash);\n+    secp256k1_sha256_write(&hash, shared_secret33, 33);\n+    secp256k1_write_be32(k_serialized, k);\n+    secp256k1_sha256_write(&hash, k_serialized, sizeof(k_serialized));\n+    secp256k1_sha256_finalize(&hash, hash_ser);\n+    /* Convert output_tweak to a scalar.\n+     *\n+     * This can only fail if the output of the hash function is zero greater than or equal to the curve order, which\n+     * happens with negligible probability. Normally, we would use VERIFY_CHECK as opposed to returning an error\n+     * since returning an error here would result in an untestable branch in the code. But in this case, we return\n+     * an error to ensure strict compliance with BIP0352.\n+     */\n+    secp256k1_scalar_set_b32(output_tweak_scalar, hash_ser, &overflow);\n+    ret = !secp256k1_scalar_is_zero(output_tweak_scalar);\n+    /* Leaking this value would break indistinguishability of the transaction, so clear it. */\n+    secp256k1_memclear_explicit(hash_ser, sizeof(hash_ser));\n+    secp256k1_sha256_clear(&hash);\n+    return ret & !overflow;\n+}\n+\n+static int secp256k1_silentpayments_create_output_pubkey(const secp256k1_context *ctx, secp256k1_xonly_pubkey *output_xonly, const unsigned char *shared_secret33, const secp256k1_pubkey *spend_pubkey, uint32_t k) {\n+    secp256k1_ge output_ge;\n+    secp256k1_scalar output_tweak_scalar;\n+    /* Calculate the output_tweak and convert it to a scalar.\n+     *\n+     * Note: _create_output_tweak can only fail if the output of the hash function is greater than or equal to the curve order, which is statistically improbable.\n+     * Returning an error here results in an untestable branch in the code, but we do this anyways to ensure strict compliance with BIP0352.\n+     */\n+    if (!secp256k1_silentpayments_create_output_tweak(&output_tweak_scalar, shared_secret33, k)) {\n+        return 0;\n+    }\n+    if (!secp256k1_pubkey_load(ctx, &output_ge, spend_pubkey)) {\n+        secp256k1_scalar_clear(&output_tweak_scalar);\n+        return 0;\n+    }\n+    /* `tweak_add` only fails if output_tweak_scalar*G = -spend_pubkey. Considering output_tweak is the output of a hash function,\n+     * this will happen only with negligible probability for honestly created spend_pubkey, but we handle this\n+     * error anyway to protect against this function being called with a malicious inputs, i.e., spend_pubkey = -(_create_output_tweak(shared_secret33, k))*G\n+     */\n+    if (!secp256k1_eckey_pubkey_tweak_add(&output_ge, &output_tweak_scalar)) {\n+        secp256k1_scalar_clear(&output_tweak_scalar);\n+        return 0;\n+    };\n+    secp256k1_xonly_pubkey_save(output_xonly, &output_ge);\n+\n+    /* Leaking this value would break indistinguishability of the transaction, so clear it. */\n+    secp256k1_scalar_clear(&output_tweak_scalar);\n+    return 1;\n+}\n+\n+int secp256k1_silentpayments_sender_create_outputs(\n+    const secp256k1_context *ctx,\n+    secp256k1_xonly_pubkey **generated_outputs,\n+    const secp256k1_silentpayments_recipient **recipients,\n+    size_t n_recipients,\n+    const unsigned char *outpoint_smallest36,\n+    const secp256k1_keypair * const *taproot_seckeys,\n+    size_t n_taproot_seckeys,\n+    const unsigned char * const *plain_seckeys,\n+    size_t n_plain_seckeys\n+) {\n+    size_t i, k;\n+    secp256k1_scalar seckey_sum_scalar, addend, input_hash_scalar;\n+    secp256k1_ge prevouts_pubkey_sum_ge;\n+    secp256k1_gej prevouts_pubkey_sum_gej;\n+    unsigned char shared_secret[33];\n+    secp256k1_pubkey current_scan_pubkey;\n+    int ret, sum_is_zero;\n+\n+    /* Sanity check inputs. */\n+    VERIFY_CHECK(ctx != NULL);\n+    ARG_CHECK(secp256k1_ecmult_gen_context_is_built(&ctx->ecmult_gen_ctx));\n+    ARG_CHECK(generated_outputs != NULL);\n+    ARG_CHECK(recipients != NULL);\n+    ARG_CHECK(n_recipients > 0);\n+    ARG_CHECK(outpoint_smallest36 != NULL);\n+    ARG_CHECK((plain_seckeys != NULL) || (taproot_seckeys != NULL));\n+    if (taproot_seckeys != NULL) {\n+        ARG_CHECK(n_taproot_seckeys > 0);\n+    } else {\n+        ARG_CHECK(n_taproot_seckeys == 0);\n+    }\n+    if (plain_seckeys != NULL) {\n+        ARG_CHECK(n_plain_seckeys > 0);\n+    } else {\n+        ARG_CHECK(n_plain_seckeys == 0);\n+    }\n+    for (i = 0; i < n_recipients; i++) {\n+        ARG_CHECK(recipients[i]->index == i);\n+    }\n+\n+    seckey_sum_scalar = secp256k1_scalar_zero;\n+    for (i = 0; i < n_plain_seckeys; i++) {\n+        ret = secp256k1_scalar_set_b32_seckey(&addend, plain_seckeys[i]);\n+        secp256k1_declassify(ctx, &ret, sizeof(ret));\n+        if (!ret) {\n+            secp256k1_scalar_clear(&addend);\n+            secp256k1_scalar_clear(&seckey_sum_scalar);\n+            return 0;\n+        }\n+        secp256k1_scalar_add(&seckey_sum_scalar, &seckey_sum_scalar, &addend);\n+    }\n+    /* Secret keys used for taproot outputs have to be negated if they result in an odd point. This is to ensure\n+     * the sender and recipient can arrive at the same shared secret when using x-only public keys. */\n+    for (i = 0; i < n_taproot_seckeys; i++) {\n+        secp256k1_ge addend_point;\n+        ret = secp256k1_keypair_load(ctx, &addend, &addend_point, taproot_seckeys[i]);\n+        secp256k1_declassify(ctx, &ret, sizeof(ret));\n+        if (!ret) {\n+            secp256k1_scalar_clear(&addend);\n+            secp256k1_scalar_clear(&seckey_sum_scalar);\n+            return 0;\n+        }\n+        if (secp256k1_fe_is_odd(&addend_point.y)) {\n+            secp256k1_scalar_negate(&addend, &addend);\n+        }\n+        secp256k1_scalar_add(&seckey_sum_scalar, &seckey_sum_scalar, &addend);\n+    }\n+    /* If there are any failures in loading/summing up the secret keys, fail early. */\n+    sum_is_zero = secp256k1_scalar_is_zero(&seckey_sum_scalar);\n+    secp256k1_declassify(ctx, &sum_is_zero, sizeof(sum_is_zero));\n+    secp256k1_scalar_clear(&addend);\n+    if (sum_is_zero) {\n+        secp256k1_scalar_clear(&seckey_sum_scalar);\n+        return 0;\n+    }\n+    secp256k1_ecmult_gen(&ctx->ecmult_gen_ctx, &prevouts_pubkey_sum_gej, &seckey_sum_scalar);\n+    secp256k1_ge_set_gej(&prevouts_pubkey_sum_ge, &prevouts_pubkey_sum_gej);\n+    /* We declassify the pubkey sum because serializing a group element (done in the\n+     * `_calculate_input_hash_scalar` call following) is not a constant-time operation.\n+     */\n+    secp256k1_declassify(ctx, &prevouts_pubkey_sum_ge, sizeof(prevouts_pubkey_sum_ge));\n+\n+    /* Calculate the input_hash and convert it to a scalar so that it can be multiplied with the summed up private keys, i.e., a_sum = a_sum * input_hash.\n+     * By multiplying the scalars together first, we can save an elliptic curve multiplication.\n+     *\n+     * Note: _input_hash_scalar can only fail if the output of the hash function is greater than or equal to the curve order, which is statistically improbable.\n+     * Returning an error here results in an untestable branch in the code, but we do this anyways to ensure strict compliance with BIP0352.\n+     */\n+    if (!secp256k1_silentpayments_calculate_input_hash_scalar(&input_hash_scalar, outpoint_smallest36, &prevouts_pubkey_sum_ge)) {\n+        secp256k1_scalar_clear(&seckey_sum_scalar);\n+        return 0;\n+    }\n+    secp256k1_scalar_mul(&seckey_sum_scalar, &seckey_sum_scalar, &input_hash_scalar);\n+    /* _recipient_sort sorts the array of recipients in place by their scan public keys (lexicographically).\n+     * This ensures that all recipients with the same scan public key are grouped together, as specified in BIP0352.\n+     *\n+     * More specifically, this ensures `k` is incremented from 0 to the number of requested outputs for each recipient group,\n+     * where a recipient group is all addresses with the same scan public key.\n+     */\n+    secp256k1_silentpayments_recipient_sort(ctx, recipients, n_recipients);\n+    current_scan_pubkey = recipients[0]->scan_pubkey;\n+    k = 0;  /* This is a dead store but clang will emit a false positive warning if we omit it. */\n+    for (i = 0; i < n_recipients; i++) {\n+        if ((i == 0) || (secp256k1_ec_pubkey_cmp(ctx, &current_scan_pubkey, &recipients[i]->scan_pubkey) != 0)) {\n+            /* If we are on a different scan pubkey, its time to recreate the shared secret and reset k to 0.\n+             * It's very unlikely the scan public key is invalid by this point, since this means the caller would\n+             * have created the _silentpayments_recipient object incorrectly, but just to be sure we still check that\n+             * the public key is valid.\n+             */\n+            secp256k1_ge pk;\n+            if (!secp256k1_pubkey_load(ctx, &pk, &recipients[i]->scan_pubkey)) {\n+                secp256k1_scalar_clear(&seckey_sum_scalar);\n+                /* Leaking this value would break indistinguishability of the transaction, so clear it. */\n+                secp256k1_memclear_explicit(&shared_secret, sizeof(shared_secret));\n+                return 0;\n+            }\n+            secp256k1_silentpayments_create_shared_secret(ctx, shared_secret, &pk, &seckey_sum_scalar);\n+            k = 0;\n+        }\n+        if (!secp256k1_silentpayments_create_output_pubkey(ctx, generated_outputs[recipients[i]->index], shared_secret, &recipients[i]->spend_pubkey, k)) {\n+            secp256k1_scalar_clear(&seckey_sum_scalar);\n+            secp256k1_memclear_explicit(&shared_secret, sizeof(shared_secret));\n+            return 0;\n+        }\n+        /* BIP0352 specifies that k is serialized as a 4 byte (32 bit) value, so we check to make\n+         * sure we are not exceeding the max value for a uint32 before incrementing k.\n+         * In practice, this should never happen as it would be impossible to create a transaction\n+         * with this many outputs.\n+         */\n+        if (k < UINT32_MAX) {\n+            k++;\n+        } else {\n+            return 0;\n+        }\n+        current_scan_pubkey = recipients[i]->scan_pubkey;\n+    }\n+    secp256k1_scalar_clear(&seckey_sum_scalar);\n+    secp256k1_memclear_explicit(&shared_secret, sizeof(shared_secret));\n+    return 1;\n+}\n+\n+/** Set hash state to the BIP340 tagged hash midstate for \"BIP0352/Label\". */\n+static void secp256k1_silentpayments_sha256_init_label(secp256k1_sha256* hash) {\n+    secp256k1_sha256_initialize(hash);\n+    hash->s[0] = 0x26b95d63ul;\n+    hash->s[1] = 0x8bf1b740ul;\n+    hash->s[2] = 0x10a5986ful;\n+    hash->s[3] = 0x06a387a5ul;\n+    hash->s[4] = 0x2d1c1c30ul;\n+    hash->s[5] = 0xd035951aul;\n+    hash->s[6] = 0x2d7f0f96ul;\n+    hash->s[7] = 0x29e3e0dbul;\n+\n+    hash->bytes = 64;\n+}\n+\n+int secp256k1_silentpayments_recipient_create_label(const secp256k1_context *ctx, secp256k1_pubkey *label, unsigned char *label_tweak32, const unsigned char *scan_key32, uint32_t m) {\n+    secp256k1_sha256 hash;\n+    unsigned char m_serialized[4];\n+\n+    /* Sanity check inputs. */\n+    VERIFY_CHECK(ctx != NULL);\n+    ARG_CHECK(label != NULL);\n+    ARG_CHECK(label_tweak32 != NULL);\n+    ARG_CHECK(scan_key32 != NULL);\n+\n+    /* Compute hash(ser_256(b_scan) || ser_32(m))  [sha256 with tag \"BIP0352/Label\"] */\n+    secp256k1_silentpayments_sha256_init_label(&hash);\n+    secp256k1_sha256_write(&hash, scan_key32, 32);\n+    secp256k1_write_be32(m_serialized, m);\n+    secp256k1_sha256_write(&hash, m_serialized, sizeof(m_serialized));\n+    secp256k1_sha256_finalize(&hash, label_tweak32);\n+\n+    secp256k1_memclear_explicit(m_serialized, sizeof(m_serialized));\n+    secp256k1_sha256_clear(&hash);\n+    return secp256k1_ec_pubkey_create(ctx, label, label_tweak32);\n+}\n+\n+int secp256k1_silentpayments_recipient_create_labeled_spend_pubkey(const secp256k1_context *ctx, secp256k1_pubkey *labeled_spend_pubkey, const secp256k1_pubkey *unlabeled_spend_pubkey, const secp256k1_pubkey *label) {\n+    secp256k1_ge labeled_spend_pubkey_ge, label_addend;\n+    secp256k1_gej result_gej;\n+    secp256k1_ge result_ge;\n+    int ret;\n+\n+    /* Sanity check inputs. */\n+    VERIFY_CHECK(ctx != NULL);\n+    ARG_CHECK(labeled_spend_pubkey != NULL);\n+    ARG_CHECK(unlabeled_spend_pubkey != NULL);\n+    ARG_CHECK(label != NULL);\n+\n+    /* Calculate labeled_spend_pubkey = spend_pubkey + label.\n+     * If either the label or spend public key is an invalid public key,\n+     * return early\n+     */\n+    ret = secp256k1_pubkey_load(ctx, &labeled_spend_pubkey_ge, unlabeled_spend_pubkey);\n+    ret &= secp256k1_pubkey_load(ctx, &label_addend, label);\n+    if (!ret) {\n+        return 0;\n+    }\n+    secp256k1_gej_set_ge(&result_gej, &labeled_spend_pubkey_ge);\n+    secp256k1_gej_add_ge_var(&result_gej, &result_gej, &label_addend, NULL);\n+    if (secp256k1_gej_is_infinity(&result_gej)) {\n+        return 0;\n+    }\n+\n+    secp256k1_ge_set_gej_var(&result_ge, &result_gej);\n+    secp256k1_pubkey_save(labeled_spend_pubkey, &result_ge);\n+\n+    return 1;\n+}\n+\n+/** An explanation of the prevouts_summary object and its usage:\n+ *\n+ *  The prevouts_summary object contains:\n+ *\n+ *  [magic: 4 bytes][boolean: 1 byte][prevouts_pubkey_sum: 64 bytes][input_hash: 32 bytes]\n+ *\n+ *  The magic bytes are checked by functions using the prevouts_summary object to\n+ *  check that the prevouts_summary object was initialized correctly.\n+ *\n+ *  The boolean (combined) indicates whether or not the summed prevout public keys and the\n+ *  input_hash scalar have already been combined or are both included. The reason\n+ *  for keeping input_hash and the summed prevout public keys separate is so that an elliptic\n+ *  curve multiplication can be avoided when creating the shared secret, i.e.,\n+ *  (recipient_scan_key * input_hash) * prevouts_pubkey_sum.\n+ *\n+ *  But when storing the prevouts_summary object (not supported yet), either to send to\n+ *  light clients or for wallet rescans, we can save 32-bytes by combining the input_hash\n+ *  and prevouts_pubkey_sum and saving the resulting point serialized as a compressed\n+ *  public key, i.e., input_hash * prevouts_pubkey_sum.\n+ *\n+ *  For each function:\n+ *\n+ *  - `_recipient_prevouts_summary_create` always creates a prevouts_summary object with combined = false\n+ */\n+\n+int secp256k1_silentpayments_recipient_prevouts_summary_create(\n+    const secp256k1_context *ctx,\n+    secp256k1_silentpayments_prevouts_summary *prevouts_summary,\n+    const unsigned char *outpoint_smallest36,\n+    const secp256k1_xonly_pubkey * const *xonly_pubkeys,\n+    size_t n_xonly_pubkeys,\n+    const secp256k1_pubkey * const *plain_pubkeys,\n+    size_t n_plain_pubkeys\n+) {\n+    size_t i;\n+    secp256k1_ge prevouts_pubkey_sum_ge, addend;\n+    secp256k1_gej prevouts_pubkey_sum_gej;\n+    secp256k1_scalar input_hash_scalar;\n+\n+    /* Sanity check inputs */\n+    VERIFY_CHECK(ctx != NULL);\n+    ARG_CHECK(prevouts_summary != NULL);\n+    ARG_CHECK(outpoint_smallest36 != NULL);\n+    ARG_CHECK((plain_pubkeys != NULL) || (xonly_pubkeys != NULL));\n+    if (xonly_pubkeys != NULL) {\n+        ARG_CHECK(n_xonly_pubkeys > 0);\n+    } else {\n+        ARG_CHECK(n_xonly_pubkeys == 0);\n+    }\n+    if (plain_pubkeys != NULL) {\n+        ARG_CHECK(n_plain_pubkeys > 0);\n+    } else {\n+        ARG_CHECK(n_plain_pubkeys == 0);\n+    }\n+\n+    /* Compute prevouts_pubkey_sum = A_1 + A_2 + ... + A_n.\n+     *\n+     * Since an attacker can maliciously craft transactions where the public keys sum to zero, fail early here\n+     * to avoid making the caller do extra work, e.g., when building an index or scanning a malicious transaction.\n+     *\n+     * This will also fail if any of the provided prevout public keys are malformed.\n+     */\n+    secp256k1_gej_set_infinity(&prevouts_pubkey_sum_gej);\n+    for (i = 0; i < n_plain_pubkeys; i++) {\n+        if (!secp256k1_pubkey_load(ctx, &addend, plain_pubkeys[i])) {\n+            return 0;\n+        }\n+        secp256k1_gej_add_ge_var(&prevouts_pubkey_sum_gej, &prevouts_pubkey_sum_gej, &addend, NULL);\n+    }\n+    for (i = 0; i < n_xonly_pubkeys; i++) {\n+        if (!secp256k1_xonly_pubkey_load(ctx, &addend, xonly_pubkeys[i])) {\n+            return 0;\n+        }\n+        secp256k1_gej_add_ge_var(&prevouts_pubkey_sum_gej, &prevouts_pubkey_sum_gej, &addend, NULL);\n+    }\n+    if (secp256k1_gej_is_infinity(&prevouts_pubkey_sum_gej)) {\n+        return 0;\n+    }\n+    secp256k1_ge_set_gej_var(&prevouts_pubkey_sum_ge, &prevouts_pubkey_sum_gej);\n+    /* Calculate the input_hash and convert it to a scalar.\n+     *\n+     * Note: _input_hash_scalar can only fail if the output of the hash function is greater than or equal to the curve order, which is statistically improbable.\n+     * Returning an error here results in an untestable branch in the code, but we do this anyways to ensure strict compliance with BIP0352.\n+     */\n+    if (!secp256k1_silentpayments_calculate_input_hash_scalar(&input_hash_scalar, outpoint_smallest36, &prevouts_pubkey_sum_ge)) {\n+        return 0;\n+    }\n+    memcpy(&prevouts_summary->data[0], secp256k1_silentpayments_prevouts_summary_magic, 4);\n+    prevouts_summary->data[4] = 0;\n+    secp256k1_ge_to_bytes(&prevouts_summary->data[5], &prevouts_pubkey_sum_ge);\n+    secp256k1_scalar_get_b32(&prevouts_summary->data[5 + 64], &input_hash_scalar);\n+    return 1;\n+}\n+\n+int secp256k1_silentpayments_recipient_scan_outputs(\n+    const secp256k1_context *ctx,\n+    secp256k1_silentpayments_found_output **found_outputs, size_t *n_found_outputs,\n+    const secp256k1_xonly_pubkey * const *tx_outputs, size_t n_tx_outputs,\n+    const unsigned char *scan_key32,\n+    const secp256k1_silentpayments_prevouts_summary *prevouts_summary,\n+    const secp256k1_pubkey *spend_pubkey,\n+    const secp256k1_silentpayments_label_lookup label_lookup,\n+    const void *label_context\n+) {\n+    secp256k1_scalar output_tweak_scalar, scan_key_scalar;\n+    secp256k1_ge label_ge, spend_pubkey_ge, prevouts_pubkey_sum_ge;\n+    secp256k1_xonly_pubkey output_xonly;\n+    unsigned char shared_secret[33];\n+    const unsigned char *label_tweak = NULL;\n+    size_t j, k, found_idx;\n+    int found, combined, valid_scan_key, ret;\n+\n+    /* Sanity check inputs */\n+    VERIFY_CHECK(ctx != NULL);\n+    ARG_CHECK(found_outputs != NULL);\n+    ARG_CHECK(n_found_outputs != NULL);\n+    ARG_CHECK(tx_outputs != NULL);\n+    ARG_CHECK(n_tx_outputs > 0);\n+    ARG_CHECK(scan_key32 != NULL);\n+    ARG_CHECK(prevouts_summary != NULL);\n+    ARG_CHECK(secp256k1_memcmp_var(&prevouts_summary->data[0], secp256k1_silentpayments_prevouts_summary_magic, 4) == 0);\n+    ARG_CHECK(spend_pubkey != NULL);\n+    /* Passing a context without a lookup function is non-sensical */\n+    if (label_context != NULL) {\n+        ARG_CHECK(label_lookup != NULL);\n+    }\n+    valid_scan_key = secp256k1_scalar_set_b32_seckey(&scan_key_scalar, scan_key32);\n+    secp256k1_declassify(ctx, &valid_scan_key, sizeof(valid_scan_key));\n+    if (!valid_scan_key) {\n+        secp256k1_scalar_clear(&scan_key_scalar);\n+        return 0;\n+    }\n+    secp256k1_ge_from_bytes(&prevouts_pubkey_sum_ge, &prevouts_summary->data[5]);\n+    combined = (int)prevouts_summary->data[4];\n+    if (!combined) {\n+        secp256k1_scalar input_hash_scalar;\n+        secp256k1_scalar_set_b32(&input_hash_scalar, &prevouts_summary->data[5 + 64], NULL);\n+        secp256k1_scalar_mul(&scan_key_scalar, &scan_key_scalar, &input_hash_scalar);\n+    }\n+    ret = secp256k1_pubkey_load(ctx, &spend_pubkey_ge, spend_pubkey);\n+    if (!ret) {\n+        secp256k1_scalar_clear(&scan_key_scalar);\n+        return 0;\n+    }\n+    secp256k1_silentpayments_create_shared_secret(ctx, shared_secret, &prevouts_pubkey_sum_ge, &scan_key_scalar);\n+    /* Clear the scan_key_scalar since we no longer need it and leaking this value would break indistinguishability of the transaction. */\n+    secp256k1_scalar_clear(&scan_key_scalar);\n+\n+    found_idx = 0;\n+    for (k = 0; k < n_tx_outputs; k++) {\n+        secp256k1_ge output_ge = spend_pubkey_ge;\n+        /* Calculate the output_tweak and convert it to a scalar.\n+         *\n+         * Note: _create_output_tweak can only fail if the output of the hash function is greater than or equal to the curve order, which is statistically improbable.\n+         * Returning an error here results in an untestable branch in the code, but we do this anyways to ensure strict compliance with BIP0352.\n+         */\n+        if (!secp256k1_silentpayments_create_output_tweak(&output_tweak_scalar, shared_secret, k)) {\n+            secp256k1_scalar_clear(&output_tweak_scalar);\n+            secp256k1_memclear_explicit(&shared_secret, sizeof(shared_secret));\n+            return 0;\n+        }\n+\n+        /* Calculate output = spend_pubkey + output_tweak * G.\n+         * This can fail if output_tweak * G is the negation of spend_pubkey, but this happens only\n+         * with negligible probability for honestly created spend_pubkey as output_tweak is the output of a hash function. */\n+        if (!secp256k1_eckey_pubkey_tweak_add(&output_ge, &output_tweak_scalar)) {\n+            /* Leaking these values would break indistinguishability of the transaction, so clear them. */\n+            secp256k1_scalar_clear(&output_tweak_scalar);\n+            secp256k1_memclear_explicit(&shared_secret, sizeof(shared_secret));\n+            return 0;\n+        }\n+        found = 0;\n+        secp256k1_xonly_pubkey_save(&output_xonly, &output_ge);\n+        for (j = 0; j < n_tx_outputs; j++) {\n+            if (secp256k1_xonly_pubkey_cmp(ctx, &output_xonly, tx_outputs[j]) == 0) {\n+                label_tweak = NULL;\n+                found = 1;\n+                found_idx = j;\n+                break;\n+            }\n+\n+            /* If not found, proceed to check for labels (if a label lookup function is provided). */\n+            if (label_lookup != NULL) {\n+                secp256k1_ge output_negated_ge, tx_output_ge;\n+                secp256k1_gej tx_output_gej, label_gej;\n+                unsigned char label33[33];\n+                size_t len;\n+\n+                secp256k1_xonly_pubkey_load(ctx, &tx_output_ge, tx_outputs[j]);\n+                secp256k1_gej_set_ge(&tx_output_gej, &tx_output_ge);\n+                /* Negate the generated output and calculate first scan label candidate:\n+                 *     label1 = tx_output - generated_output\n+                 */\n+                secp256k1_ge_neg(&output_negated_ge, &output_ge);\n+                secp256k1_gej_add_ge_var(&label_gej, &tx_output_gej, &output_negated_ge, NULL);\n+                secp256k1_ge_set_gej_var(&label_ge, &label_gej);\n+                ret = secp256k1_eckey_pubkey_serialize(&label_ge, label33, &len, 1);\n+                /* Serialize must succeed because the point was just loaded.\n+                 *\n+                 * Note: serialize will also fail if label_ge is the point at infinity, but we know\n+                 * this cannot happen since we only hit this branch if tx_output != output_xonly.\n+                 * Thus, we know that label_ge = tx_output_gej + output_negated_ge cannot be the\n+                 * point at infinity.\n+                 */\n+                VERIFY_CHECK(ret && len == 33);\n+                label_tweak = label_lookup(label33, label_context);\n+                if (label_tweak != NULL) {\n+                    found = 1;\n+                    found_idx = j;\n+                    break;\n+                }\n+\n+                /* If not found, negate the tx_output and calculate second scan label candidate:\n+                 *     label2 = -tx_output - generated_output\n+                 */\n+                secp256k1_gej_neg(&label_gej, &tx_output_gej);\n+                secp256k1_gej_add_ge_var(&label_gej, &label_gej, &output_negated_ge, NULL);\n+                secp256k1_ge_set_gej_var(&label_ge, &label_gej);\n+                ret = secp256k1_eckey_pubkey_serialize(&label_ge, label33, &len, 1);\n+                /* Serialize must succeed because the point was just loaded.\n+                 *\n+                 * Note: serialize will also fail if label_ge is the point at infinity, but we know\n+                 * this cannot happen since we only hit this branch if tx_output != output_xonly.\n+                 * Thus, we know that label_ge = tx_output_gej + output_negated_ge cannot be the",
      "path": "src/modules/silentpayments/main_impl.h",
      "position": 1,
      "original_position": 625,
      "commit_id": "c11d30c25f75776920797b017a568ea0cfc28882",
      "original_commit_id": "c11d30c25f75776920797b017a568ea0cfc28882",
      "in_reply_to_id": null,
      "user": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Should be `- tx_output_gej`?",
      "created_at": "2025-11-14T16:21:51Z",
      "updated_at": "2025-11-14T16:25:30Z",
      "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1765#discussion_r2528111908",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/comments/2528111908"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1765"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 625,
      "side": "RIGHT"
    }
  ]
}