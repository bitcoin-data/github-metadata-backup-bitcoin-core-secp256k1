{
  "type": "issue",
  "issue": {
    "id": 312963352,
    "node_id": "MDU6SXNzdWUzMTI5NjMzNTI=",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/528",
    "number": 528,
    "state": "closed",
    "state_reason": "completed",
    "title": "Test with count == 0 and optimization disabled trip a verify",
    "body": "The repro process is a bit involved, but it seems like there is a possible problem somewhere in the ecmult_multi logic (or in gcc itself).\r\n\r\nRepro:\r\nEdit ./configure.ac to remove `CFLAGS=\"$CFLAGS -O3\"`\r\nThen:\r\n```\r\n$ CFLAGS='-g -O0' ../configure --with-asm=no\r\n$ make tests && ./tests 0\r\n[compiling...]\r\ntest count = 0\r\nrandom seed = 6a777122d5fd053929192734d4913476\r\n../src/field_5x52_impl.h:421: test condition failed: b->magnitude <= 8\r\nAborted\r\n```\r\n\r\nIt's unclear why this problem doesn't show up when the optimization are turned on. The compiler used is gcc 7.3.0 .",
    "user": {
      "login": "deadalnix",
      "id": 854121,
      "node_id": "MDQ6VXNlcjg1NDEyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deadalnix",
      "html_url": "https://github.com/deadalnix",
      "followers_url": "https://api.github.com/users/deadalnix/followers",
      "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
      "organizations_url": "https://api.github.com/users/deadalnix/orgs",
      "repos_url": "https://api.github.com/users/deadalnix/repos",
      "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/deadalnix/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 4,
    "closed_at": "2018-05-31T19:01:04Z",
    "created_at": "2018-04-10T15:00:57Z",
    "updated_at": "2018-05-31T19:01:04Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 380152171,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDE1MjE3MQ==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/380152171",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-04-10T15:53:39Z",
      "updated_at": "2018-04-10T15:53:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "Neat! I can confirm that something funny happens in valgrind with ./tests 0. To be honest I had no idea this command was permissible -- my base case has always been ./tests 1.\r\n\r\nI'll look into it. Solution may just be to require count â‰¥ 1.",
      "user": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/528#issuecomment-380152171",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528"
    },
    {
      "event": "commented",
      "id": 380183486,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDE4MzQ4Ng==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/380183486",
      "actor": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-04-10T17:30:17Z",
      "updated_at": "2018-04-10T17:30:17Z",
      "author_association": "NONE",
      "body": "I ended up having failures because of some test system that would run with zero because of some bug in the testing system.\r\n\r\nMy concern here isn't really that 0 is a very useful thing to test for, but that it put the system is some weird state that reveal a bug either in libsecp256k1 or possibly in gcc's optimizer. I'm not really up to speed with the `ecmult_multi` part of the code, so I'm unable to really help drill down further at this time.",
      "user": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/528#issuecomment-380183486",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528"
    },
    {
      "event": "commented",
      "id": 380208192,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDIwODE5Mg==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/380208192",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-04-10T18:49:29Z",
      "updated_at": "2018-04-10T18:49:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "No, it is purely that this line of code https://github.com/bitcoin-core/secp256k1/blob/master/src/tests.c#L2714 in the test jig is not run in the count==0 case, so a couple scalars are uninitialized, so the tests fail randomly. It has nothing to do with the library or with gcc.",
      "user": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/528#issuecomment-380208192",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528"
    },
    {
      "event": "commented",
      "id": 380241389,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDI0MTM4OQ==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/380241389",
      "actor": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-04-10T20:47:35Z",
      "updated_at": "2018-04-10T20:47:35Z",
      "author_association": "NONE",
      "body": "I see. Thanks for getting to the bottom of this.",
      "user": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/528#issuecomment-380241389",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/528"
    },
    {
      "event": "closed",
      "id": 1656736002,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTY1NjczNjAwMg==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/1656736002",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-05-31T19:01:04Z"
    },
    {
      "event": "referenced",
      "id": 1656736020,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDE2NTY3MzYwMjA=",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/1656736020",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1e6f1f5ad5e7f1e3ef79313ec02023902bf8175c",
      "commit_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits/1e6f1f5ad5e7f1e3ef79313ec02023902bf8175c",
      "created_at": "2018-05-31T19:01:05Z"
    }
  ]
}