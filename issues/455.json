{
  "type": "issue",
  "issue": {
    "id": 226051157,
    "node_id": "MDU6SXNzdWUyMjYwNTExNTc=",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/455",
    "number": 455,
    "state": "closed",
    "state_reason": "completed",
    "title": "Segmentation fault when using secp256k1_ecdsa_verify with NULL context",
    "body": "I am running on debian stretch:\r\n\r\n    $ uname -a\r\n    Linux <hostname> 4.8.0-1-amd64 #1 SMP Debian 4.8.5-1 (2016-10-28) x86_64 GNU/Linux\r\n    $ gcc --version\r\n    gcc (Debian 6.3.0-14) 6.3.0 20170415\r\n\r\nI attach a C code snippet which explains and replicates the behavior:\r\n\r\n    #include \"secp256k1.h\"\r\n    #include <assert.h>\r\n\r\n    int main(){\r\n\r\n      // valid key\r\n      const unsigned char *pubkey_bytes = \"\\x03\"\r\n        \"\\xf0\\x28\\x89\\x2b\\xad\\x7e\\xd5\\x7d\\x2f\\xb5\\x7b\\xf3\\x30\\x81\\xd5\\xcf\"\r\n        \"\\xcf\\x6f\\x9e\\xd3\\xd3\\xd7\\xf1\\x59\\xc2\\xe2\\xff\\xf5\\x79\\xdc\\x34\\x1a\";\r\n\r\n      // valid signature\r\n      const unsigned char *sig_bytes = \r\n        \"\\x98\\x62\\x10\\xb9\\xdc\\x0a\\x2f\\x21\\xbc\\xae\\xc0\\x96\\xf4\\xf5\\x5f\\xf4\"\r\n        \"\\x48\\x6f\\xcc\\x4e\\x3a\\xaf\\xe7\\xe0\\xcb\\xf6\\x46\\x92\\x59\\x6e\\x99\\x4a\"\r\n        \"\\x0e\\x5c\\x6e\\xc6\\x54\\x08\\xd6\\x5a\\xae\\x9e\\x1c\\xe8\\xe9\\x53\\xc3\\x1e\"\r\n        \"\\xd0\\x3f\\x41\\x79\\x09\\x1d\\x20\\xd1\\x59\\xda\\xe4\\x19\\xe9\\x0c\\xa3\\x63\";\r\n\r\n      const unsigned char *hash_bytes = \r\n        \"\\x7f\\x83\\xb1\\x65\\x7f\\xf1\\xfc\\x53\\xb9\\x2d\\xc1\\x81\\x48\\xa1\\xd6\\x5d\"\r\n        \"\\xfc\\x2d\\x4b\\x1f\\xa3\\xd6\\x77\\x28\\x4a\\xdd\\xd2\\x00\\x12\\x6d\\x90\\x69\";\r\n\r\n      int value;\r\n      secp256k1_context *ctx;\r\n      secp256k1_pubkey pub;\r\n      secp256k1_ecdsa_signature sig;\r\n\r\n\r\n      ctx = secp256k1_context_create\r\n          ( SECP256K1_CONTEXT_VERIFY \r\n          | SECP256K1_CONTEXT_SIGN\r\n          );\r\n\r\n      // parsing public key\r\n      value = secp256k1_ec_pubkey_parse(ctx, &pub, pubkey_bytes, 33);\r\n      assert(value == 1);\r\n\r\n      // parsing signature\r\n      value = secp256k1_ecdsa_signature_parse_compact(ctx, &sig, sig_bytes);\r\n      assert(value == 1);\r\n\r\n      // verifying signature \r\n      value = secp256k1_ecdsa_verify(ctx, &sig, hash_bytes, &pub);\r\n      assert(value == 1);\r\n\r\n      // passing NULL context (SEGMENTATION FAULT)\r\n      value = secp256k1_ecdsa_verify(NULL, &sig, hash_bytes, &pub);\r\n\r\n\r\n      secp256k1_context_destroy(ctx);  // code does not reach this point\r\n\r\n      return 0;\r\n\r\n    }\r\n",
    "user": {
      "login": "possientis",
      "id": 12125789,
      "node_id": "MDQ6VXNlcjEyMTI1Nzg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/12125789?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/possientis",
      "html_url": "https://github.com/possientis",
      "followers_url": "https://api.github.com/users/possientis/followers",
      "following_url": "https://api.github.com/users/possientis/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/possientis/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/possientis/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/possientis/subscriptions",
      "organizations_url": "https://api.github.com/users/possientis/orgs",
      "repos_url": "https://api.github.com/users/possientis/repos",
      "events_url": "https://api.github.com/users/possientis/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/possientis/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 4,
    "closed_at": "2017-05-10T05:20:18Z",
    "created_at": "2017-05-03T16:58:23Z",
    "updated_at": "2017-05-10T05:20:18Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 299713376,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTcxMzM3Ng==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/299713376",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-07T15:23:22Z",
      "updated_at": "2017-05-07T15:23:22Z",
      "author_association": "MEMBER",
      "body": "All of the secp256k1 functions do argument check on their other arguments, but only a `VERIFY_CHECK` on ctx, which does nothing except when compiled with `VERIFY`.\r\n```c\r\n    VERIFY_CHECK(ctx != NULL);\r\n    ARG_CHECK(sig != NULL);\r\n    ARG_CHECK(input != NULL);\r\n```\r\nNot what is the reason, but it is not a bug specific to a function.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/455#issuecomment-299713376",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455"
    },
    {
      "event": "commented",
      "id": 299858727,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTg1ODcyNw==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/299858727",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-08T12:54:57Z",
      "updated_at": "2017-05-08T12:54:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "The reason we can't use `ARG_CHECK` is because the argument check uses the context object itself (to call into the callback functions).\r\n",
      "user": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/455#issuecomment-299858727",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455"
    },
    {
      "event": "commented",
      "id": 300122022,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDEyMjAyMg==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/300122022",
      "actor": {
        "login": "possientis",
        "id": 12125789,
        "node_id": "MDQ6VXNlcjEyMTI1Nzg5",
        "avatar_url": "https://avatars.githubusercontent.com/u/12125789?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/possientis",
        "html_url": "https://github.com/possientis",
        "followers_url": "https://api.github.com/users/possientis/followers",
        "following_url": "https://api.github.com/users/possientis/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/possientis/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/possientis/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/possientis/subscriptions",
        "organizations_url": "https://api.github.com/users/possientis/orgs",
        "repos_url": "https://api.github.com/users/possientis/repos",
        "events_url": "https://api.github.com/users/possientis/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/possientis/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-09T10:15:30Z",
      "updated_at": "2017-05-09T10:15:30Z",
      "author_association": "NONE",
      "body": "I wasn't sure whether this should be deemed a bug. Should I close the issue then? ",
      "user": {
        "login": "possientis",
        "id": 12125789,
        "node_id": "MDQ6VXNlcjEyMTI1Nzg5",
        "avatar_url": "https://avatars.githubusercontent.com/u/12125789?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/possientis",
        "html_url": "https://github.com/possientis",
        "followers_url": "https://api.github.com/users/possientis/followers",
        "following_url": "https://api.github.com/users/possientis/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/possientis/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/possientis/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/possientis/subscriptions",
        "organizations_url": "https://api.github.com/users/possientis/orgs",
        "repos_url": "https://api.github.com/users/possientis/repos",
        "events_url": "https://api.github.com/users/possientis/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/possientis/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/455#issuecomment-300122022",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455"
    },
    {
      "event": "commented",
      "id": 300122567,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDEyMjU2Nw==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/300122567",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-09T10:18:13Z",
      "updated_at": "2017-05-09T10:18:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think it should be closed.. the only thing we can do in general is to `assert` on this, and `VERIFY_CHECK` is our assert macro.",
      "user": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/455#issuecomment-300122567",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/455"
    },
    {
      "event": "closed",
      "id": 1075778064,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTA3NTc3ODA2NA==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/1075778064",
      "actor": {
        "login": "possientis",
        "id": 12125789,
        "node_id": "MDQ6VXNlcjEyMTI1Nzg5",
        "avatar_url": "https://avatars.githubusercontent.com/u/12125789?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/possientis",
        "html_url": "https://github.com/possientis",
        "followers_url": "https://api.github.com/users/possientis/followers",
        "following_url": "https://api.github.com/users/possientis/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/possientis/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/possientis/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/possientis/subscriptions",
        "organizations_url": "https://api.github.com/users/possientis/orgs",
        "repos_url": "https://api.github.com/users/possientis/repos",
        "events_url": "https://api.github.com/users/possientis/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/possientis/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-10T05:20:18Z"
    }
  ]
}