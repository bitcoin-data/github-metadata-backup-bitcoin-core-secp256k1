{
  "type": "issue",
  "issue": {
    "id": 1076718442,
    "node_id": "I_kwDOAP4Jqs5ALWtq",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039",
    "number": 1039,
    "state": "open",
    "state_reason": null,
    "title": "Make all source and header files self-contained",
    "body": "This week I noticed that the includes in this project are a mess. Actually, each file should be self-contained, i.e., include the stuff that it needs (and ideally only the stuff that it needs) but at the moment neither of these are true for a lot of files in the repo. Just try compiling a random `.h` or `_impl.h` file.\r\n\r\nThis is not per se a problem for our \"single translation unit\" compilation (I learned that the cool kids call this [\"unity builds\"](https://en.wikipedia.org/wiki/Unity_build)) that we use in order to leverage the full potential of compiler optimizations without the need for LTO. The more important point (at least for me personally--though I may be the only regular contributor suffering here), it prevents the use of advanced tooling/IDE, e.g., my editor supports language servers such as ccls or clangd which \"compile\" the open file internally and provide a ton of features, e.g., completion, display of compile errors etc. But [none of this works properly](https://github.com/clangd/clangd/issues/45) if you can't compile individual files. You can say that's the fault of these tools but [self-contained files are also just good style and good engineering practice](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#sf11-header-files-should-be-self-contained).\r\n\r\nPR #924 was an attempt to clean up the includes but even the `include-what-you-use` tool there used there (or at least the way it has been used there) fixes includes only for the `.c` files.\r\n  \r\nHere are some things we'd need to do:\r\n- [ ] Introduce header files for modules: Currently each `_impl.h` file in `src` has a corresponding `.h` file for other files to include. But we don't do this properly in `src/modules`. For example, the schnorrsig module uses function from the extrakeys module but there are only `_impl.h` files in  `src/modules/extrakeys` and no `.h` file for schnorrsig to include. \r\n- [ ] The same is true for some internal functions declared in `secp256k1.c`. There's no just header for other files to include.\r\n- [ ] Then make sure that each file includes at least all the stuff it uses, i.e., compiles on its own. Maybe with the help of a tool like [clang-include-fixer](https://clang.llvm.org/extra/clang-include-fixer.html).\r\n- [ ] ...and maybe enforce this on CI.\r\n- [ ] Maybe make sure that each file includes at most the stuff it uses, e.g., with the help of a tool like [include-what-you-use](https://include-what-you-use.org/).\r\n\r\nAgain, I understand that I may the only one suffering, so fixing this may be on me but I still wanted to document my findings here. I don't except anyone disagreeing with the changes the mentioned here but please raise your hand if you do. \r\n\r\n",
    "user": {
      "login": "real-or-random",
      "id": 1071625,
      "node_id": "MDQ6VXNlcjEwNzE2MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/real-or-random",
      "html_url": "https://github.com/real-or-random",
      "followers_url": "https://api.github.com/users/real-or-random/followers",
      "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
      "organizations_url": "https://api.github.com/users/real-or-random/orgs",
      "repos_url": "https://api.github.com/users/real-or-random/repos",
      "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/real-or-random/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 8,
    "created_at": "2021-12-10T10:58:44Z",
    "updated_at": "2025-06-30T09:43:45Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 992656285,
      "node_id": "IC_kwDOAP4Jqs47Krud",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/992656285",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-13T16:33:05Z",
      "updated_at": "2021-12-13T16:33:05Z",
      "author_association": "CONTRIBUTOR",
      "body": "It's complicated.\r\n\r\nThe _impl.h files in modules/* aren't really standalone pieces of code, as they are included by secp256k1.c / tests.c / bench.c respectively. I tend to think of them not as separate things, but as \"parts\" of those respective .c files that have been moved elsewhere for organization purposes.\r\n\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-992656285",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "commented",
      "id": 992692922,
      "node_id": "IC_kwDOAP4Jqs47K0q6",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/992692922",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-13T17:14:12Z",
      "updated_at": "2021-12-13T17:14:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "> The _impl.h files in modules/* aren't really standalone pieces of code, as they are included by secp256k1.c / tests.c / bench.c respectively. I tend to think of them not as separate things, but as \"parts\" of those respective .c files that have been moved elsewhere for organization purposes.\r\n\r\nIndeed but I don't see the point. What you say is true also for the _impl.h files not in src/modules/*, they're also included by the .c files.\r\n\r\nSo I think the rules should roughly be: \r\n -  The .c files should include all the _impl.h files or at least those it needs  (maybe we can have a single \"include-them-all\" header to avoid that we need to add a new _impl.h to all .c files).\r\n -  _impl.h and other .h files should just include the .h files that declare the stuff they need\r\n",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-992692922",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "commented",
      "id": 998989275,
      "node_id": "IC_kwDOAP4Jqs47i13b",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/998989275",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:09:18Z",
      "updated_at": "2021-12-21T18:09:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "What if we renamed the `_impl.h` files to `.c` and compiled them as independent units in CI? So both forms of compilation would be supported.",
      "user": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-998989275",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "commented",
      "id": 999006108,
      "node_id": "IC_kwDOAP4Jqs47i5-c",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/999006108",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:36:51Z",
      "updated_at": "2021-12-21T18:36:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "> What if we renamed the `_impl.h` files to `.c` and compiled them as independent units in CI? So both forms of compilation would be supported.\r\n\r\nYeah, I think that will be a very related goal. What I propose is to ensure that every file (incl. `_impl.h`) compiles on its own. Whether you call them `.c` or `_impl.h` is then more a matter of taste in the end and is then orthogonal.\r\n\r\nHowever, I don't know if it's worth supporting that as an official compilation method. The reason why we have unity builds is the (former) lack of LTO. I think it was a good idea to separate the precomputed stuff (https://github.com/bitcoin-core/secp256k1/pull/1042) because it rarely changes and nothing is lost without LTO. But for the \"normal\" (not precomputed) files, I don't know: we wouldn't want to drop support for unity builds for people that still use compilers without LTO. And compilation times are still very manageable with the existing code base.",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-999006108",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "commented",
      "id": 999006220,
      "node_id": "IC_kwDOAP4Jqs47i6AM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/999006220",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:37:05Z",
      "updated_at": "2021-12-21T18:37:05Z",
      "author_association": "CONTRIBUTOR",
      "body": "@real-or-random Hmm, perhaps my point is more philosophical than practical.\r\n\r\nThe way I like to think about source code organization is that the .h and .c file (or in our case, .h and _impl.h file) are one \"unit\". And to think about dependencies in the code, you think about \"which unit cannot be used without which other unit\". When you have units that depend in that way on each other, you have a \"semantic\" cyclic dependency between those units, which is a sign that those two units should really be one unit, or organized differently.\r\n\r\nSo specifically, if you have a situation where a.c includes b.h, and b.c includes a.h, while not being a cyclic dependency between the actual files, it is a cyclic dependency between the units. And in that sense, e.g. the modules/*/tests_impl.h files aren't proper separate units: modules/*/tests_impl.h depend on functions in tests.c, and simultaneously tests.c includes modules/*/tests_impl.h. In that sense, they're really better thought of as \"part of tests.c, but moved elsewhere to make conditional compilation easy\" than as separate units. Just adding non-impl .h files, without disentangling things, wouldn't change that.\r\n\r\nBut\r\n\r\nOf course, there is no requirement that the situation stay that way. We could properly separate the modules/*/tests_impl.h files; which would probably involve moving some of the shared helper functions in tests.c to a separate file, which can then be included by both tests.c and modulus/*/tests_impl.h\r\n\r\nI think that would be a good idea, actually. And if we do, @apoelstra's suggestion to try compiling all the impl files separately would be a nice way of testing that. Do you imagine that as actually renaming all the _impl.h files to .c in the repository, but just leaving the default compilation mode to still #include them into each other as now? Or do you mean e.g. having the CI script doing the renaming for this particular test? One concern I'd have with actually doing the renaming in-repo is that people building the project in an environment without our build system would actually build that way and get abysmal performance due to lack of inlining of field routines (actually, that's perhaps not uninteresting to test).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-999006220",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "mentioned",
      "id": 5800698286,
      "node_id": "MEE_lADOAP4Jqs5ALWtqzwAAAAFZv6Gu",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5800698286",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:37:05Z"
    },
    {
      "event": "subscribed",
      "id": 5800698291,
      "node_id": "SE_lADOAP4Jqs5ALWtqzwAAAAFZv6Gz",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5800698291",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:37:05Z"
    },
    {
      "event": "mentioned",
      "id": 5800698298,
      "node_id": "MEE_lADOAP4Jqs5ALWtqzwAAAAFZv6G6",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5800698298",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:37:05Z"
    },
    {
      "event": "subscribed",
      "id": 5800698305,
      "node_id": "SE_lADOAP4Jqs5ALWtqzwAAAAFZv6HB",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5800698305",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:37:05Z"
    },
    {
      "event": "commented",
      "id": 999009192,
      "node_id": "IC_kwDOAP4Jqs47i6uo",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/999009192",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:41:56Z",
      "updated_at": "2021-12-21T18:45:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "> And if we do, @apoelstra's suggestion to try compiling all the impl files separately would be a nice way of testing that. Do you imagine that as actually renaming all the _impl.h files to .c in the repository, but just leaving the default compilation mode to still #include them into each other as now? Or do you mean e.g. having the CI script doing the renaming for this particular test?\r\n\r\nIf the goal is just to solve this issue and test this, then it would suffice to have CI compile the `_impl.h` files (and the other `.h` files). No need to rename them. *edit: and just invoke the compiler on them manually without autotools.* (That's what I meant when I said above that renaming is orthogonal -- I realize that we were writing our comments simultaneously.).",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-999009192",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "mentioned",
      "id": 5800720213,
      "node_id": "MEE_lADOAP4Jqs5ALWtqzwAAAAFZv_dV",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5800720213",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:41:56Z"
    },
    {
      "event": "subscribed",
      "id": 5800720218,
      "node_id": "SE_lADOAP4Jqs5ALWtqzwAAAAFZv_da",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5800720218",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T18:41:56Z"
    },
    {
      "event": "commented",
      "id": 999943096,
      "node_id": "IC_kwDOAP4Jqs47meu4",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/999943096",
      "actor": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-22T23:41:40Z",
      "updated_at": "2021-12-22T23:41:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "My intention was to do the bare minimum to test compiling the `_impl`s in CI. Agreed that we should not make it easy or natural for library users to do this. I assumed, but did not check, that gcc would want a file to be called `.c` rather than `.h` for it to compile it as a unit, which is why I suggested the renaming.\r\n\r\nI didn't consider just having the CI script do the renaming though. I think that might get us exactly what we want (a CI test of @sipa's semantic model of dependencies, as approximated by `#include` lines).",
      "user": {
        "login": "apoelstra",
        "id": 1351933,
        "node_id": "MDQ6VXNlcjEzNTE5MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apoelstra",
        "html_url": "https://github.com/apoelstra",
        "followers_url": "https://api.github.com/users/apoelstra/followers",
        "following_url": "https://api.github.com/users/apoelstra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/apoelstra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/apoelstra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
        "organizations_url": "https://api.github.com/users/apoelstra/orgs",
        "repos_url": "https://api.github.com/users/apoelstra/repos",
        "events_url": "https://api.github.com/users/apoelstra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/apoelstra/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-999943096",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    },
    {
      "event": "mentioned",
      "id": 5807276439,
      "node_id": "MEE_lADOAP4Jqs5ALWtqzwAAAAFaJAGX",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5807276439",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-22T23:41:40Z"
    },
    {
      "event": "subscribed",
      "id": 5807276441,
      "node_id": "SE_lADOAP4Jqs5ALWtqzwAAAAFaJAGZ",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5807276441",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-22T23:41:40Z"
    },
    {
      "event": "referenced",
      "id": 9059293618,
      "node_id": "REFE_lADOAP4Jqs5ALWtqzwAAAAIb-dmy",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/9059293618",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "a6f4bcf6e1025f88597d3fd569899178570917c6",
      "commit_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits/a6f4bcf6e1025f88597d3fd569899178570917c6",
      "created_at": "2023-04-20T16:18:17Z"
    },
    {
      "event": "commented",
      "id": 3018403396,
      "node_id": "IC_kwDOAP4Jqs6z6S5E",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/3018403396",
      "actor": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-30T09:15:31Z",
      "updated_at": "2025-06-30T09:43:45Z",
      "author_association": "CONTRIBUTOR",
      "body": "> The way I like to think about source code organization is that the .h and .c file (or in our case, .h and _impl.h file) are one \"unit\".\n\nRight. Even `_test.c` belongs to the same unit. While some newer programming languages allow putting the interface, the implementation, and unit tests in a single source file, C requires that separate files are used.\n\nTools like `include-what-you-use` and `clang-tidy` work on the unit level. When a source file (`.c` or `_test.c`) is tested, they also report diagnostics for the `.h` file of the same unit. To get results from those tools, it is important that each unit has at least one source file, be it `.c` or `_test.c`.\n\n> When you have units that depend in that way on each other, you have a \"semantic\" cyclic dependency between those units, which is a sign that those two units should really be one unit, or organized differently.\n\nIdeally, yes. But there is no technical requirement that units must form a DAG. This is exactly what `#include` guards are for.\nAlso, whether the file is called  `_impl.h` or  `.c` does not affect what unit it belongs to. Hence, renaming `_impl.h` to  `.c` would not affect the unit dependency graph.\n\nI recommend renaming `_impl.h` to `.c`, so that above mentioned tools actually work correctly. (I can also submit a PR if you give me thumbs up.)",
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1039#issuecomment-3018403396",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1039"
    }
  ]
}