{
  "type": "issue",
  "issue": {
    "id": 1073735631,
    "node_id": "I_kwDOAP4Jqs4__-fP",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1037",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1037/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1037/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1037/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1037",
    "number": 1037,
    "state": "open",
    "state_reason": null,
    "title": "Split tests into public and internal ones",
    "body": "The current unit tests are all built against the library's internal source code directly. That means they have the advantage of being to test internal functions that aren't exposed from the library, but it also means the tests cannot actually run against the normal release build of the library.\r\n\r\nTo improve this:\r\n* Split the tests into separate public API tests, and internal tests.\r\n* A public test binary: public API tests, linked against the release build of the library (no -DVERIFY).\r\n* An internal test binary: #include's the library code directly, plus public API tests, plus internal test (compiled with -DVERIFY).",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 165017692,
        "node_id": "MDU6TGFiZWwxNjUwMTc2OTI=",
        "url": "https://api.github.com/repos/bitcoin-core/secp256k1/labels/assurance",
        "name": "assurance",
        "description": "",
        "color": "A6DF3D",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 1,
    "created_at": "2021-12-07T20:36:27Z",
    "updated_at": "2023-01-05T11:01:24Z"
  },
  "events": [
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-23T18:34:37Z",
      "updated_at": "2021-12-23T18:34:37Z",
      "source": {
        "issue": {
          "id": 1071526117,
          "node_id": "PR_kwDOAP4Jqs4vaAyB",
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1033",
          "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
          "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1033/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1033/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1033/events",
          "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1033",
          "number": 1033,
          "state": "closed",
          "state_reason": null,
          "title": "Add _fe_half and use in _gej_add_ge and _gej_double",
          "body": "- Trades 1 _half for 3 _mul_int and 2 _normalize_weak\r\n\r\nGives around 2-3% faster signing and ECDH, depending on compiler/platform.",
          "user": {
            "login": "peterdettman",
            "id": 3423981,
            "node_id": "MDQ6VXNlcjM0MjM5ODE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/peterdettman",
            "html_url": "https://github.com/peterdettman",
            "followers_url": "https://api.github.com/users/peterdettman/followers",
            "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
            "organizations_url": "https://api.github.com/users/peterdettman/orgs",
            "repos_url": "https://api.github.com/users/peterdettman/repos",
            "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/peterdettman/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 34,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1033",
            "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1033",
            "diff_url": "https://github.com/bitcoin-core/secp256k1/pull/1033.diff",
            "patch_url": "https://github.com/bitcoin-core/secp256k1/pull/1033.patch"
          },
          "closed_at": "2022-02-21T10:00:22Z",
          "created_at": "2021-12-05T18:30:54Z",
          "updated_at": "2022-02-21T10:00:22Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T07:13:39Z",
      "updated_at": "2023-01-05T07:13:39Z",
      "source": {
        "issue": {
          "id": 1005912802,
          "node_id": "PR_kwDOAP4Jqs4sNrZc",
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/979",
          "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
          "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/979/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/979/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/979/events",
          "html_url": "https://github.com/bitcoin-core/secp256k1/pull/979",
          "number": 979,
          "state": "closed",
          "state_reason": null,
          "title": "Native jacobi symbol algorithm",
          "body": "This introduces variants of the vartime divsteps-based GCD algorithm used for modular inverses to compute Jacobi symbols. Changes compared to the normal vartime divsteps:\r\n* Only positive matrices are used, guaranteeing that f and g remain positive.\r\n* An additional jac variable is updated to track sign changes during matrix computation.\r\n* There is (so far) no proof that this algorithm terminates within reasonable amount of time for every input, but experimentally it appears to almost always need less than 900 iterations. To account for that, only a bounded number of iterations is performed (1500), after which failure is returned. The field logic then falls back to using square roots to determining the result.\r\n* The algorithm converges to f=g=gcd(f0,g0) rather than g=0. To keep this test simple, the end condition is f=1, which won't be reached if started with g=0. That case is dealt with specially.\r\n\r\nThis code is currently unused, except for tests. I don't aim for it to be merged until there is a need for it, but this demonstrates its feasibility.\r\n\r\nIn terms of performance:\r\n```\r\nfield_inverse: min 1.76us / avg 1.76us / max 1.78us\r\nfield_inverse_var: min 0.991us / avg 0.993us / max 0.996us\r\nfield_jacobi_var: min 1.31us / avg 1.31us / max 1.31us\r\nfield_sqrt: min 4.36us / avg 4.37us / max 4.40us\r\n```\r\n\r\nwhile with the older (f24e122d13db7061b1086ddfd21d3a1c5294213b) libgmp based Jacobi code on the same system:\r\n```\r\nnum_jacobi: min 1.53us / avg 1.54us / max 1.55us\r\n```\r\n",
          "user": {
            "login": "sipa",
            "id": 548488,
            "node_id": "MDQ6VXNlcjU0ODQ4OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sipa",
            "html_url": "https://github.com/sipa",
            "followers_url": "https://api.github.com/users/sipa/followers",
            "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
            "organizations_url": "https://api.github.com/users/sipa/orgs",
            "repos_url": "https://api.github.com/users/sipa/repos",
            "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sipa/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 16,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/979",
            "html_url": "https://github.com/bitcoin-core/secp256k1/pull/979",
            "diff_url": "https://github.com/bitcoin-core/secp256k1/pull/979.diff",
            "patch_url": "https://github.com/bitcoin-core/secp256k1/pull/979.patch"
          },
          "closed_at": "2023-03-01T14:44:13Z",
          "created_at": "2021-09-23T22:54:02Z",
          "updated_at": "2023-04-10T06:29:06Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1371870423,
      "node_id": "IC_kwDOAP4Jqs5RxRTX",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1371870423",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T07:29:12Z",
      "updated_at": "2023-01-05T07:29:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "I also see some value in running the internal tests without -DVERIFY. This would exercise a lot of functions with their production source.\r\n\r\nThat doesn't mean that we'll get the same compiler output as in production (but probably the compiler will be closer to production at least). And it will catch cases in our source code, in which VERIFY code introduces real differences (which it should not).\r\n\r\nSo it's not perfect but tests are never perfect. I think this is a low hanging fruit, given that it should not be a lot of effort. It will just be a second internal test binary.",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1037#issuecomment-1371870423",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1037"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T10:39:56Z",
      "updated_at": "2023-01-05T10:39:56Z",
      "source": {
        "issue": {
          "id": 1520509926,
          "node_id": "PR_kwDOAP4Jqs5GtVu5",
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1188",
          "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
          "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1188/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1188/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1188/events",
          "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1188",
          "number": 1188,
          "state": "closed",
          "state_reason": null,
          "title": "tests: Add noverify_tests which is like tests but without VERIFY",
          "body": "mentioned in https://github.com/bitcoin-core/secp256k1/issues/1037#issuecomment-1371870423\r\n\r\nLet's see how this affects CI time",
          "user": {
            "login": "real-or-random",
            "id": 1071625,
            "node_id": "MDQ6VXNlcjEwNzE2MjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/real-or-random",
            "html_url": "https://github.com/real-or-random",
            "followers_url": "https://api.github.com/users/real-or-random/followers",
            "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
            "organizations_url": "https://api.github.com/users/real-or-random/orgs",
            "repos_url": "https://api.github.com/users/real-or-random/repos",
            "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/real-or-random/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin-core/secp256k1/pulls/1188",
            "html_url": "https://github.com/bitcoin-core/secp256k1/pull/1188",
            "diff_url": "https://github.com/bitcoin-core/secp256k1/pull/1188.diff",
            "patch_url": "https://github.com/bitcoin-core/secp256k1/pull/1188.patch"
          },
          "closed_at": "2023-01-09T16:06:33Z",
          "created_at": "2023-01-05T10:39:56Z",
          "updated_at": "2023-01-09T16:06:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 8159203483,
      "node_id": "LE_lADOAP4Jqs4__-fPzwAAAAHmU5Cb",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/8159203483",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T11:01:24Z",
      "label": {
        "name": "assurance",
        "color": "A6DF3D"
      }
    },
    {
      "event": "referenced",
      "id": 8183359872,
      "node_id": "REFE_lADOAP4Jqs4__-fPzwAAAAHnxCmA",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/8183359872",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "cbe41ac138bc0773d60ab1942b7ad6fc5eccfc19",
      "commit_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits/cbe41ac138bc0773d60ab1942b7ad6fc5eccfc19",
      "created_at": "2023-01-09T16:06:33Z"
    }
  ]
}