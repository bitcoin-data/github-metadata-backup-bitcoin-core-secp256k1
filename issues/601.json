{
  "type": "issue",
  "issue": {
    "id": 422025617,
    "node_id": "MDU6SXNzdWU0MjIwMjU2MTc=",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/601",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/601/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/601/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/601/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/601",
    "number": 601,
    "state": "closed",
    "state_reason": "completed",
    "title": "bug of leading zeros public keys",
    "body": "I got a problem when I wrote code for sequentially calculating public keys (for the vanity generator). Verification fails when I tried to verify a bundle (created by a fast algorithm) using another function of the standard algorithm. I am attaching a simple demo C code and its output so that you can reproduce the problem.\r\n\r\nIf you look at the output, you will see that all coordinates have leading zeros. This is very similar to the sequel of \"bug of leading zeros privkey\" bitpay / bitcore-lib # 47 (github.com/iancoleman/bip39/issues/58).\r\nOnly now - for public keys.\r\nIf I'm right, we have a big hidden problem for a long time.\r\nAbout once every 10,000, a public key with leading zeros occurs and it has a chance to calculate it incorrectly. \r\nOnly secp256k1_gej_add_ge() yields correct results.\r\nIncorrect calculations for secp256k1_ecmult(), secp256k1_gej_add_ge_var(), secp256k1_gej_add_var().\r\nI check the \"correctness\" of the result on the brainwalletx.github.io, (but there are no guarantees that it is also not verified by this bug).\r\n\r\nDebian 4.13.0 amd64 SMP x86_64\r\nI use the library from 02.2019 (tried 2018, 2017 too).\r\nLibrary compiled as standard\r\n./configure\r\nor deployed for my system as\r\n./configure --enable-ecmult-static-precomputation --with-bignum=gmp --with-scalar=64bit --with-field=64bit --with-asm=x86_64\r\nExperiments have revealed that the situation is very acute if\r\n./configure --with-field=32bit\r\nThere is clearly something broken - public keys with leading zeros lose half of the digits.\r\nThe rest of the keys do not affect.\r\n\r\nDear developer(s), please fix it!\r\n[compare.c.txt](https://github.com/bitcoin-core/secp256k1/files/2976304/compare.c.txt)\r\n[compare_output_tests.log](https://github.com/bitcoin-core/secp256k1/files/2976305/compare_output_tests.log)\r\n\r\n",
    "user": {
      "login": "Telariust",
      "id": 35634666,
      "node_id": "MDQ6VXNlcjM1NjM0NjY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/35634666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Telariust",
      "html_url": "https://github.com/Telariust",
      "followers_url": "https://api.github.com/users/Telariust/followers",
      "following_url": "https://api.github.com/users/Telariust/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Telariust/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Telariust/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Telariust/subscriptions",
      "organizations_url": "https://api.github.com/users/Telariust/orgs",
      "repos_url": "https://api.github.com/users/Telariust/repos",
      "events_url": "https://api.github.com/users/Telariust/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Telariust/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "closed_at": "2019-03-18T21:15:26Z",
    "created_at": "2019-03-18T03:48:37Z",
    "updated_at": "2019-03-18T21:15:26Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 473866768,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mzg2Njc2OA==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/473866768",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-18T11:07:59Z",
      "updated_at": "2019-03-18T11:07:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "This smells like the same (non-)issue as in https://github.com/bitcoin-core/secp256k1/issues/565. Please have a look.",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/601#issuecomment-473866768",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/601"
    },
    {
      "event": "commented",
      "id": 474104080,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDEwNDA4MA==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/474104080",
      "actor": {
        "login": "Telariust",
        "id": 35634666,
        "node_id": "MDQ6VXNlcjM1NjM0NjY2",
        "avatar_url": "https://avatars.githubusercontent.com/u/35634666?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Telariust",
        "html_url": "https://github.com/Telariust",
        "followers_url": "https://api.github.com/users/Telariust/followers",
        "following_url": "https://api.github.com/users/Telariust/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Telariust/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Telariust/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Telariust/subscriptions",
        "organizations_url": "https://api.github.com/users/Telariust/orgs",
        "repos_url": "https://api.github.com/users/Telariust/repos",
        "events_url": "https://api.github.com/users/Telariust/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Telariust/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-18T21:15:26Z",
      "updated_at": "2019-03-18T21:15:26Z",
      "author_association": "NONE",
      "body": "Ok! I read in /src/field.h\r\n`/** Compare two field elements. Requires both inputs to be normalized */`\r\n`static int secp256k1_fe_cmp_var(const secp256k1_fe *a, const secp256k1_fe *b);`\r\nand I added normalize_var before fe_cmp_var\r\n`\t\tsecp256k1_fe_normalize_var(&packGe1[i].x);`\r\n`\t\tsecp256k1_fe_normalize_var(&packGe2[i].x);`\r\n`\t\tif(1 && (0 != secp256k1_fe_cmp_var(&packGe1[i].x, &packGe2[i].x))`\r\n`..............`\r\n`\t\tsecp256k1_fe_normalize_var(&packGe1[i].y);`\r\n`\t\tsecp256k1_fe_normalize_var(&packGe2[i].y);`\r\n`\t\tif(1 && (0 != secp256k1_fe_cmp_var(&packGe1[i].y, &packGe2[i].y))`\r\nand verify success for all combinations!\r\n\"I learned something new today\"\r\nBig thx, master!) and close.",
      "user": {
        "login": "Telariust",
        "id": 35634666,
        "node_id": "MDQ6VXNlcjM1NjM0NjY2",
        "avatar_url": "https://avatars.githubusercontent.com/u/35634666?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Telariust",
        "html_url": "https://github.com/Telariust",
        "followers_url": "https://api.github.com/users/Telariust/followers",
        "following_url": "https://api.github.com/users/Telariust/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Telariust/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Telariust/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Telariust/subscriptions",
        "organizations_url": "https://api.github.com/users/Telariust/orgs",
        "repos_url": "https://api.github.com/users/Telariust/repos",
        "events_url": "https://api.github.com/users/Telariust/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Telariust/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/601#issuecomment-474104080",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/601"
    },
    {
      "event": "closed",
      "id": 2211771885,
      "node_id": "MDExOkNsb3NlZEV2ZW50MjIxMTc3MTg4NQ==",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/2211771885",
      "actor": {
        "login": "Telariust",
        "id": 35634666,
        "node_id": "MDQ6VXNlcjM1NjM0NjY2",
        "avatar_url": "https://avatars.githubusercontent.com/u/35634666?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Telariust",
        "html_url": "https://github.com/Telariust",
        "followers_url": "https://api.github.com/users/Telariust/followers",
        "following_url": "https://api.github.com/users/Telariust/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Telariust/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Telariust/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Telariust/subscriptions",
        "organizations_url": "https://api.github.com/users/Telariust/orgs",
        "repos_url": "https://api.github.com/users/Telariust/repos",
        "events_url": "https://api.github.com/users/Telariust/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Telariust/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-18T21:15:26Z"
    }
  ]
}