{
  "type": "issue",
  "issue": {
    "id": 1118698381,
    "node_id": "I_kwDOAP4Jqs5CrfuN",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1067",
    "number": 1067,
    "state": "closed",
    "state_reason": "completed",
    "title": "TypeError in prove_group_implementations.sage",
    "body": "```\r\n$ sage --version\r\nSageMath version 9.4, Release Date: 2021-08-22\r\n$ sage ./prove_group_implementations.sage\r\nFormula secp256k1_gej_add_var:\r\nTraceback (most recent call last):\r\n  File \"sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4680, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.reduce (build/cythonized/sage/rings/polynomial/multi_polynomial_libsingular.cpp:36255)\r\n  File \"sage/structure/parent_old.pyx\", line 185, in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:3973)\r\n  File \"sage/structure/parent.pyx\", line 1207, in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10953)\r\nTypeError: no canonical coercion from Multivariate Polynomial Ring in ax, bx, ay, by, Az, Bz, Ai, Bi over Rational Field to Multivariate Polynomial Ring in ax, bx, ay, by, Az, Bz, Ai, Bi over Integer Ring\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"secp256k1/sage/./prove_group_implementations.sage.py\", line 300, in <module>\r\n    check_symbolic_jacobian_weierstrass(\"secp256k1_gej_add_var\", _sage_const_0 , _sage_const_7 , _sage_const_5 , formula_secp256k1_gej_add_var)\r\n  File \"<string>\", line 255, in check_symbolic_jacobian_weierstrass\r\n  File \"<string>\", line 220, in check_symbolic_function\r\n  File \"<string>\", line 306, in check_symbolic\r\n  File \"<string>\", line 255, in prove_zero\r\n  File \"<string>\", line 230, in prove_nonzero\r\n  File \"/nix/store/fj99mwys7crk5iifzym7q1m4li9ksknc-python3-3.9.9-env/lib/python3.9/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 4530, in reduce\r\n    return f.reduce(gb)\r\n  File \"sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4683, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.reduce (build/cythonized/sage/rings/polynomial/multi_polynomial_libsingular.cpp:36314)\r\nTypeError: no canonical coercion from Multivariate Polynomial Ring in ax, bx, ay, by, Az, Bz, Ai, Bi over Rational Field to Multivariate Polynomial Ring in ax, bx, ay, by, Az, Bz, Ai, Bi over Integer Ring\r\n```\r\n\r\nFor what it's worth, I have only very limited understanding of what the sage script does, but if I change line 230 in group_prover.sage from\r\n```\r\nfor (f, n) in zero.reduce(numerator(allexprs)).factor():\r\n```\r\nto\r\n```\r\nfor (f, n) in zero.reduce(numerator(allexprs).change_ring(QQ)).factor():\r\n```\r\nthe type error disappears, but running `sage ./prove_group_implementations.sage` reports failure for `secp256k1_gej_add_var` (add) and `secp256k1_gej_add_zinv_var` (add).\r\n",
    "user": {
      "login": "jonasnick",
      "id": 2582071,
      "node_id": "MDQ6VXNlcjI1ODIwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasnick",
      "html_url": "https://github.com/jonasnick",
      "followers_url": "https://api.github.com/users/jonasnick/followers",
      "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasnick/orgs",
      "repos_url": "https://api.github.com/users/jonasnick/repos",
      "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jonasnick/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 4,
    "closed_at": "2022-02-05T22:07:44Z",
    "created_at": "2022-01-30T20:38:50Z",
    "updated_at": "2022-02-05T22:07:44Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1025226366,
      "node_id": "IC_kwDOAP4Jqs49G7Z-",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1025226366",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-30T20:41:15Z",
      "updated_at": "2022-01-30T20:41:15Z",
      "author_association": "MEMBER",
      "body": "Hmm, it works for me, in Sage 9.2.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1067#issuecomment-1025226366",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067"
    },
    {
      "event": "referenced",
      "id": 5979967933,
      "node_id": "REFE_lADOAP4Jqs5CrfuNzwAAAAFkbxG9",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5979967933",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e108d0039c36483dffe4be00815c1b6d65ef5751",
      "commit_url": "https://api.github.com/repos/real-or-random/secp256k1/commits/e108d0039c36483dffe4be00815c1b6d65ef5751",
      "created_at": "2022-01-31T11:15:44Z"
    },
    {
      "event": "commented",
      "id": 1025995865,
      "node_id": "IC_kwDOAP4Jqs49J3RZ",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1025995865",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T16:58:18Z",
      "updated_at": "2022-01-31T16:58:18Z",
      "author_association": "MEMBER",
      "body": "@sipa Just to be clear, that means that you do _not_ see the following failures in the output?\r\n```\r\nFormula secp256k1_gej_add_var:\r\n  add:\r\n    branch 4: FAIL, <map object at 0x7f417d48b820> fails (assuming )\r\n...\r\nFormula secp256k1_gej_add_zinv_var:\r\n  add:\r\n    branch 4: FAIL, <map object at 0x7f417d67d420> fails (assuming )\r\n...\r\n```",
      "user": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1067#issuecomment-1025995865",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067"
    },
    {
      "event": "mentioned",
      "id": 5982353539,
      "node_id": "MEE_lADOAP4Jqs5CrfuNzwAAAAFkk3iD",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5982353539",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T16:58:18Z"
    },
    {
      "event": "subscribed",
      "id": 5982353546,
      "node_id": "SE_lADOAP4Jqs5CrfuNzwAAAAFkk3iK",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/5982353546",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T16:58:18Z"
    },
    {
      "event": "commented",
      "id": 1025999275,
      "node_id": "IC_kwDOAP4Jqs49J4Gr",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1025999275",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T17:01:42Z",
      "updated_at": "2022-01-31T17:01:42Z",
      "author_association": "MEMBER",
      "body": "My output as of commit d8a246324650c3df8d54d133a8ac3c1b857a7a4e (master):\r\n\r\n```\r\n$ sage --version; sage prove_group_implementations.sage \r\nSageMath version 9.2, Release Date: 2020-10-24\r\nFormula secp256k1_gej_add_var:\r\n  add:\r\n    branch 4: OK\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 0: OK\r\n  add_infinite_b:\r\n    branch 1: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge_var:\r\n  add:\r\n    branch 4: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 3: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n    branch 1: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_ab:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n\r\nFormula secp256k1_gej_add_zinv_var:\r\n  add:\r\n    branch 4: OK\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 1: OK\r\n  add_infinite_b:\r\n    branch 0: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge:\r\n  add:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 3: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  double:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_opposite:\r\n    branch 9: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_a:\r\n    branch 4: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 6: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 7: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 13: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n\r\nFormula secp256k1_gej_add_ge_old [should fail]:\r\n  add:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 2: FAIL, ['finite_point', 'on_curve', 'colinear_1', 'colinear_2', 'colinear_3'] fails (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  double:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_opposite:\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_a:\r\n    branch 1: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n```\r\n\r\nMy output as of eb86372d5d411ccf200a3add49111d9c197d7dce (#1068):\r\n\r\n```\r\n$ sage --version; sage prove_group_implementations.sage \r\nSageMath version 9.2, Release Date: 2020-10-24\r\nFormula secp256k1_gej_add_var:\r\n  add:\r\n    branch 4: OK\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 0: OK\r\n  add_infinite_b:\r\n    branch 1: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge_var:\r\n  add:\r\n    branch 4: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 3: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n    branch 1: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_ab:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n\r\nFormula secp256k1_gej_add_zinv_var:\r\n  add:\r\n    branch 4: OK\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 1: OK\r\n  add_infinite_b:\r\n    branch 0: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge:\r\n  add:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 2: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 3: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 9: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 4: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 6: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 7: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 13: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n\r\nFormula secp256k1_gej_add_ge_old [should fail]:\r\n  add:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 2: FAIL, ['finite_point', 'on_curve', 'colinear_1', 'colinear_2', 'colinear_3'] fails (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 2: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 1: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n```\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1067#issuecomment-1025999275",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067"
    },
    {
      "event": "commented",
      "id": 1026695313,
      "node_id": "IC_kwDOAP4Jqs49MiCR",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1026695313",
      "actor": {
        "login": "siv2r",
        "id": 56887198,
        "node_id": "MDQ6VXNlcjU2ODg3MTk4",
        "avatar_url": "https://avatars.githubusercontent.com/u/56887198?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/siv2r",
        "html_url": "https://github.com/siv2r",
        "followers_url": "https://api.github.com/users/siv2r/followers",
        "following_url": "https://api.github.com/users/siv2r/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/siv2r/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/siv2r/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/siv2r/subscriptions",
        "organizations_url": "https://api.github.com/users/siv2r/orgs",
        "repos_url": "https://api.github.com/users/siv2r/repos",
        "events_url": "https://api.github.com/users/siv2r/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/siv2r/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-01T10:32:32Z",
      "updated_at": "2022-02-01T10:32:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "The branch 4 of `gej_add_var` and `gej_add_zinv_var` fails on `SageMath version 9.4, Release Date: 2021-08-22  `\r\n<details>\r\n<summary> Output on sage v9.4 </summary>\r\n\r\n```\r\nsage: load(\"prove_group_implementations.sage\")                                            \r\nFormula secp256k1_gej_add_var:\r\n  add:\r\n    branch 4: FAIL, <map object at 0x7fdf43f902b0> fails (assuming )\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 0: OK\r\n  add_infinite_b:\r\n    branch 1: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge_var:\r\n  add:\r\n    branch 4: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 3: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n    branch 1: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_ab:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n\r\nFormula secp256k1_gej_add_zinv_var:\r\n  add:\r\n    branch 4: FAIL, <map object at 0x7fdf443faac0> fails (assuming )\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 1: OK\r\n  add_infinite_b:\r\n    branch 0: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge:\r\n  add:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 2: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 3: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 9: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 4: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 6: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 7: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 13: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n\r\nFormula secp256k1_gej_add_ge_old [should fail]:\r\n  add:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n    branch 2: FAIL, ['finite_point', 'on_curve', 'colinear_1', 'colinear_2', 'colinear_3'] fails (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 0: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 2: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 1: OK (assuming Bi = 0 [b_finite], Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n```\r\n</details>\r\n\r\nBut there was no `TypeError` in my case. I used [CoCalc](https://cocalc.com/) to run the sage scripts.\r\n\r\nOn running, `sage ./prove_group_implementations.sage` for sage v9.0 (on my local machine) there are no errors (with or without the `change_ring` workaround).\r\n<details>\r\n<summary> Output on sage v9.0 </summary>\r\n\r\n```\r\n$ sage --version;sage ./prove_group_implementations.sage\r\nSageMath version 9.0, Release Date: 2020-01-01\r\nFormula secp256k1_gej_add_var:\r\n  add:\r\n    branch 4: OK\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 0: OK\r\n  add_infinite_b:\r\n    branch 1: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge_var:\r\n  add:\r\n    branch 4: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  double:\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_opposite:\r\n    branch 3: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_a:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_b:\r\n    branch 1: OK (assuming Bz - 1 = 0 [b.z=1])\r\n  add_infinite_ab:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1])\r\n\r\nFormula secp256k1_gej_add_zinv_var:\r\n  add:\r\n    branch 4: OK\r\n  double:\r\n    branch 2: OK\r\n  add_opposite:\r\n    branch 3: OK\r\n  add_infinite_a:\r\n    branch 1: OK\r\n  add_infinite_b:\r\n    branch 0: OK\r\n  add_infinite_ab:\r\n    branch 0: OK\r\n\r\nFormula secp256k1_gej_add_ge:\r\n  add:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 3: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  double:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_opposite:\r\n    branch 9: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_a:\r\n    branch 4: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 6: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 7: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 13: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n\r\nFormula secp256k1_gej_add_ge_old [should fail]:\r\n  add:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n    branch 2: FAIL, ['finite_point', 'on_curve', 'colinear_1', 'colinear_2', 'colinear_3'] fails (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  double:\r\n    branch 0: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_opposite:\r\n    branch 2: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_a:\r\n    branch 1: OK (assuming Bz - 1 = 0 [b.z=1], Bi = 0 [b_finite])\r\n  add_infinite_b:\r\n  add_infinite_ab:\r\n```\r\n\r\n</details>",
      "user": {
        "login": "siv2r",
        "id": 56887198,
        "node_id": "MDQ6VXNlcjU2ODg3MTk4",
        "avatar_url": "https://avatars.githubusercontent.com/u/56887198?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/siv2r",
        "html_url": "https://github.com/siv2r",
        "followers_url": "https://api.github.com/users/siv2r/followers",
        "following_url": "https://api.github.com/users/siv2r/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/siv2r/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/siv2r/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/siv2r/subscriptions",
        "organizations_url": "https://api.github.com/users/siv2r/orgs",
        "repos_url": "https://api.github.com/users/siv2r/repos",
        "events_url": "https://api.github.com/users/siv2r/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/siv2r/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1067#issuecomment-1026695313",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1067"
    },
    {
      "event": "closed",
      "id": 6014327797,
      "node_id": "CE_lADOAP4Jqs5CrfuNzwAAAAFme1v1",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/6014327797",
      "actor": {
        "login": "jonasnick",
        "id": 2582071,
        "node_id": "MDQ6VXNlcjI1ODIwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2582071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasnick",
        "html_url": "https://github.com/jonasnick",
        "followers_url": "https://api.github.com/users/jonasnick/followers",
        "following_url": "https://api.github.com/users/jonasnick/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasnick/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasnick/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasnick/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasnick/orgs",
        "repos_url": "https://api.github.com/users/jonasnick/repos",
        "events_url": "https://api.github.com/users/jonasnick/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasnick/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e108d0039c36483dffe4be00815c1b6d65ef5751",
      "commit_url": "https://api.github.com/repos/bitcoin-core/secp256k1/commits/e108d0039c36483dffe4be00815c1b6d65ef5751",
      "created_at": "2022-02-05T22:07:44Z"
    },
    {
      "event": "referenced",
      "id": 9309532748,
      "node_id": "REFE_lADOAP4Jqs5CrfuNzwAAAAIq5DJM",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/9309532748",
      "actor": {
        "login": "dderjoel",
        "id": 13455345,
        "node_id": "MDQ6VXNlcjEzNDU1MzQ1",
        "avatar_url": "https://avatars.githubusercontent.com/u/13455345?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dderjoel",
        "html_url": "https://github.com/dderjoel",
        "followers_url": "https://api.github.com/users/dderjoel/followers",
        "following_url": "https://api.github.com/users/dderjoel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dderjoel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dderjoel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dderjoel/subscriptions",
        "organizations_url": "https://api.github.com/users/dderjoel/orgs",
        "repos_url": "https://api.github.com/users/dderjoel/repos",
        "events_url": "https://api.github.com/users/dderjoel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dderjoel/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "9a3a468ff4c236b54f0a93bf5e601d3d84989e6e",
      "commit_url": "https://api.github.com/repos/dderjoel/secp256k1/commits/9a3a468ff4c236b54f0a93bf5e601d3d84989e6e",
      "created_at": "2023-05-23T01:15:37Z"
    }
  ]
}