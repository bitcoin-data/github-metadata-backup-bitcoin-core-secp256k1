{
  "type": "issue",
  "issue": {
    "id": 1668352843,
    "node_id": "I_kwDOAP4Jqs5jcQtL",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1280",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1280/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1280/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1280/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1280",
    "number": 1280,
    "state": "closed",
    "state_reason": "completed",
    "title": "autotools: `make precomp` does not work for out-of-source builds",
    "body": "On master (4258c54f4ebfc09390168e8a43306c46b315134b):\r\n```\r\n$ ./autogen.sh\r\n$ mkdir ../build && cd ../build\r\n$ ../secp256k1/configure\r\n$ make precomp\r\nmake: Nothing to be done for 'precomp'.\r\n$ make clean-precomp\r\nrm -f src/precomputed_ecmult_gen.c src/precomputed_ecmult.c\r\n$ make precomp\r\nmake: Nothing to be done for 'precomp'.\r\n```",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 2,
    "closed_at": "2023-04-19T14:03:23Z",
    "created_at": "2023-04-14T14:23:47Z",
    "updated_at": "2023-04-19T14:03:23Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1514726159,
      "node_id": "IC_kwDOAP4Jqs5aSOMP",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1514726159",
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-19T13:21:17Z",
      "updated_at": "2023-04-19T13:21:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "Well, I think that's somewhat by design. \r\n\r\nThe problem here is not that `make precomp` does not work. The problem is that `make clean-precomp` has nothing to clean: `src/precomputed_ecmult_gen.c src/precomputed_ecmult.c` simply don't exist in the build dir.\r\n\r\nSo, what is `make clean-precomp` supposed to do in an out-of-tree build? We have three options:\r\n 1. Do nothing. Disadvantage: It doesn't work.\r\n 2. Error out. Disadvantage: It doesn't work either.\r\n 3. Clean in the src dir. Disadvantage: That violates the convention that an out-of-tree build should not touch the source dir.\r\n\r\nAs I see it, the maintainer features generate source files, so it's natural that they only work in the source dir.\r\n\r\nHaving said that, it would probably be okay to implement 3. But I'm not convinced that this is much better. The build should work then somewhat because the precomp files are then generated in the *build dir* (since we have https://github.com/bitcoin-core/secp256k1/pull/1160/commits/e862c4af0c5a7300129700d38eff499a836a108d0). But this also means that another `make clean-precomp` will (try to) delete the files in the source dir again.\r\n\r\nI lean towards accepting that this is a maintainer-only feature and works only in the source dir. That will translate to option 2.\r\n\r\nHere's an entirely different idea:\r\nWith all this autotools mess, and since we don't even have these features in CMake, it would perhaps be cleaner to move (maintainer-)generation of the distributed files entirely out of the build system(s). This is currently hard since creating the files involves running a C program, which needs to be compiled, which needs some kind of build infrastructure. If we used Python to create the table files (see https://github.com/bitcoin-core/secp256k1/pull/919), this would simplify some things. In particular because we have a \"maintainer dependency\" on Python anyway now with the test vector scripts.... On the other hand, all of this is work and I doubt it's worth spending our time on this right now. (This is true in general when it comes to solving this \"issue\" here).\r\n",
      "user": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1280#issuecomment-1514726159",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1280"
    },
    {
      "event": "commented",
      "id": 1514794259,
      "node_id": "IC_kwDOAP4Jqs5aSe0T",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1514794259",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-19T14:03:11Z",
      "updated_at": "2023-04-19T14:03:11Z",
      "author_association": "MEMBER",
      "body": "Thanks for clarification!",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1280#issuecomment-1514794259",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1280"
    },
    {
      "event": "closed",
      "id": 9047051448,
      "node_id": "CE_lADOAP4Jqs5jcQtLzwAAAAIbPwy4",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/9047051448",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-19T14:03:23Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "real-or-random",
        "id": 1071625,
        "node_id": "MDQ6VXNlcjEwNzE2MjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/real-or-random",
        "html_url": "https://github.com/real-or-random",
        "followers_url": "https://api.github.com/users/real-or-random/followers",
        "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
        "organizations_url": "https://api.github.com/users/real-or-random/orgs",
        "repos_url": "https://api.github.com/users/real-or-random/repos",
        "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/real-or-random/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-19T14:22:24Z",
      "updated_at": "2023-04-19T14:22:24Z",
      "source": {
        "issue": {
          "id": 1675010804,
          "node_id": "I_kwDOAP4Jqs5j1qL0",
          "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1281",
          "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
          "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1281/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1281/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1281/events",
          "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1281",
          "number": 1281,
          "state": "open",
          "state_reason": null,
          "title": "build: Move generation of prebuilt files out of build system",
          "body": " #1245 and its need for #1277 have shown that \"abusing\" autotools to generate prebuilt files is hard to understand, and remains hard to maintain. \r\n\r\n> With all this autotools mess, and since we don't even have these features in CMake, it would perhaps be cleaner to move (maintainer-)generation of the distributed files entirely out of the build system(s). This is currently hard since creating the files involves running a C program, which needs to be compiled, which needs some kind of build infrastructure. If we used Python to create the table files (see https://github.com/bitcoin-core/secp256k1/pull/919), this would simplify some things. In particular because we have a \"maintainer dependency\" on Python anyway now with the test vector scripts.... On the other hand, all of this is work and I doubt it's worth spending our time on this right now.\r\n\r\n_Originally posted by @real-or-random in https://github.com/bitcoin-core/secp256k1/issues/1280#issuecomment-1514726159_\r\n",
          "user": {
            "login": "real-or-random",
            "id": 1071625,
            "node_id": "MDQ6VXNlcjEwNzE2MjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1071625?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/real-or-random",
            "html_url": "https://github.com/real-or-random",
            "followers_url": "https://api.github.com/users/real-or-random/followers",
            "following_url": "https://api.github.com/users/real-or-random/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/real-or-random/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/real-or-random/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/real-or-random/subscriptions",
            "organizations_url": "https://api.github.com/users/real-or-random/orgs",
            "repos_url": "https://api.github.com/users/real-or-random/repos",
            "events_url": "https://api.github.com/users/real-or-random/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/real-or-random/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "created_at": "2023-04-19T14:22:24Z",
          "updated_at": "2023-04-24T06:54:46Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unsubscribed",
      "id": 9048679605,
      "node_id": "UE_lADOAP4Jqs5jcQtLzwAAAAIbV-S1",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/9048679605",
      "actor": {
        "login": "romanz",
        "id": 9900,
        "node_id": "MDQ6VXNlcjk5MDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/9900?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/romanz",
        "html_url": "https://github.com/romanz",
        "followers_url": "https://api.github.com/users/romanz/followers",
        "following_url": "https://api.github.com/users/romanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/romanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/romanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/romanz/subscriptions",
        "organizations_url": "https://api.github.com/users/romanz/orgs",
        "repos_url": "https://api.github.com/users/romanz/repos",
        "events_url": "https://api.github.com/users/romanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/romanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-19T16:30:27Z"
    }
  ]
}