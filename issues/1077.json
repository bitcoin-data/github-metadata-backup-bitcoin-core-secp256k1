{
  "type": "issue",
  "issue": {
    "id": 1138274496,
    "node_id": "I_kwDOAP4Jqs5D2LDA",
    "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1077",
    "repository_url": "https://api.github.com/repos/bitcoin-core/secp256k1",
    "labels_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1077/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1077/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1077/events",
    "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1077",
    "number": 1077,
    "state": "closed",
    "state_reason": "completed",
    "title": "doc/safegcd_implementation: clarifications",
    "body": "Thank you for writing up the explanation on safegcd, very useful! However, could you please clarify a few points?\r\n\r\n* The body of the very first `gcd` function in Section 1 seems to be the function `divsteps2` from Figure 10.1 of the original paper but without all of the `truncate` calls. What are the consequences of omitting the calls? Aren't `f`, `g` going to be too large case then?\r\n* In the function `modinv` first introduced in Section 3, there is `f % 2**N`, `g % 2**N`. In Python `%` operator always returns non-negative result, even for negative arguments. Doesn't this throw `delta` out of sync with `f`, `g`?\r\n* If that's not too much to ask, could you please explain how a variable time and recursive version of `modinv_var` would look like, akin to `jumpdivsteps2` found in Figure 10.2?\r\n\r\nThank you very much in advance! I hope posting here is not too off-topic, I didn't know how else to reach the authors of the document.",
    "user": {
      "login": "TuomLarsen",
      "id": 2552859,
      "node_id": "MDQ6VXNlcjI1NTI4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2552859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TuomLarsen",
      "html_url": "https://github.com/TuomLarsen",
      "followers_url": "https://api.github.com/users/TuomLarsen/followers",
      "following_url": "https://api.github.com/users/TuomLarsen/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TuomLarsen/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TuomLarsen/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TuomLarsen/subscriptions",
      "organizations_url": "https://api.github.com/users/TuomLarsen/orgs",
      "repos_url": "https://api.github.com/users/TuomLarsen/repos",
      "events_url": "https://api.github.com/users/TuomLarsen/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TuomLarsen/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "closed_at": "2022-03-27T06:30:18Z",
    "created_at": "2022-02-15T07:07:16Z",
    "updated_at": "2022-03-27T06:30:18Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1072950142,
      "node_id": "IC_kwDOAP4Jqs4_8-t-",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1072950142",
      "actor": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-19T06:05:36Z",
      "updated_at": "2022-03-19T06:05:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "I guess the main point to make is that our implementation does not use the recursive structure of the general safegcd algorithm (because we are targeting only a fixed relatively-small field).\r\n\r\n> * The body of the very first `gcd` function in Section 1 seems to be the function `divsteps2` from Figure 10.1 of the original paper but without all of the `truncate` calls. What are the consequences of omitting the calls? Aren't `f`, `g` going to be too large case then?\r\n\r\nIMO, the gcd in Section 1 of the doc has more to do with shortgcd2 from Figure 1.2 of the paper, except using a (non-const-time) termination condition on g instead of a fixed number of iterations.\r\n\r\n> * In the function `modinv` first introduced in Section 3, there is `f % 2**N`, `g % 2**N`. In Python `%` operator always returns non-negative result, even for negative arguments. Doesn't this throw `delta` out of sync with `f`, `g`?\r\n\r\nNo. divsteps only operate on low bits of f/g without regard to the sign of the full value. Also delta is not tracking signs of f/g but rather the balance between how many times we've zeroed the LSB of f vs that of g. When we have a choice as to which of f/g to zero the LSB of next (i.e. when both f,g are odd), then we choose the one that has had the fewest zeroed so far, which is tracked by delta.\r\n\r\n> * If that's not too much to ask, could you please explain how a variable time and recursive version of `modinv_var` would look like, akin to `jumpdivsteps2` found in Figure 10.2?\r\n\r\nYeah, it's a bit much because we didn't actually do that. However regarding a var-time jumpdivsteps2, a general observation would be that once the low t bits of g are all 0, then the whole effect of divsteps2 (or the remaining iterations) is only to increase delta by 1 per iteration. That should also be true of jumpdivsteps2. So I would guess that you could test for g == 0 mod 2^t at the top of jumpdivsteps2, to then just return delta+t,f,g.\r\n",
      "user": {
        "login": "peterdettman",
        "id": 3423981,
        "node_id": "MDQ6VXNlcjM0MjM5ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3423981?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/peterdettman",
        "html_url": "https://github.com/peterdettman",
        "followers_url": "https://api.github.com/users/peterdettman/followers",
        "following_url": "https://api.github.com/users/peterdettman/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/peterdettman/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/peterdettman/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/peterdettman/subscriptions",
        "organizations_url": "https://api.github.com/users/peterdettman/orgs",
        "repos_url": "https://api.github.com/users/peterdettman/repos",
        "events_url": "https://api.github.com/users/peterdettman/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/peterdettman/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1077#issuecomment-1072950142",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1077"
    },
    {
      "event": "commented",
      "id": 1079850786,
      "node_id": "IC_kwDOAP4Jqs5AXTci",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/comments/1079850786",
      "actor": {
        "login": "TuomLarsen",
        "id": 2552859,
        "node_id": "MDQ6VXNlcjI1NTI4NTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2552859?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TuomLarsen",
        "html_url": "https://github.com/TuomLarsen",
        "followers_url": "https://api.github.com/users/TuomLarsen/followers",
        "following_url": "https://api.github.com/users/TuomLarsen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TuomLarsen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TuomLarsen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TuomLarsen/subscriptions",
        "organizations_url": "https://api.github.com/users/TuomLarsen/orgs",
        "repos_url": "https://api.github.com/users/TuomLarsen/repos",
        "events_url": "https://api.github.com/users/TuomLarsen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TuomLarsen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-27T06:30:18Z",
      "updated_at": "2022-03-27T06:30:18Z",
      "author_association": "NONE",
      "body": "Thank you very much for the reply! I'm closing it, then.",
      "user": {
        "login": "TuomLarsen",
        "id": 2552859,
        "node_id": "MDQ6VXNlcjI1NTI4NTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2552859?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TuomLarsen",
        "html_url": "https://github.com/TuomLarsen",
        "followers_url": "https://api.github.com/users/TuomLarsen/followers",
        "following_url": "https://api.github.com/users/TuomLarsen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TuomLarsen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TuomLarsen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TuomLarsen/subscriptions",
        "organizations_url": "https://api.github.com/users/TuomLarsen/orgs",
        "repos_url": "https://api.github.com/users/TuomLarsen/repos",
        "events_url": "https://api.github.com/users/TuomLarsen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TuomLarsen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin-core/secp256k1/issues/1077#issuecomment-1079850786",
      "issue_url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/1077"
    },
    {
      "event": "closed",
      "id": 6313226326,
      "node_id": "CE_lADOAP4Jqs5D2LDAzwAAAAF4TDBW",
      "url": "https://api.github.com/repos/bitcoin-core/secp256k1/issues/events/6313226326",
      "actor": {
        "login": "TuomLarsen",
        "id": 2552859,
        "node_id": "MDQ6VXNlcjI1NTI4NTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2552859?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TuomLarsen",
        "html_url": "https://github.com/TuomLarsen",
        "followers_url": "https://api.github.com/users/TuomLarsen/followers",
        "following_url": "https://api.github.com/users/TuomLarsen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TuomLarsen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TuomLarsen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TuomLarsen/subscriptions",
        "organizations_url": "https://api.github.com/users/TuomLarsen/orgs",
        "repos_url": "https://api.github.com/users/TuomLarsen/repos",
        "events_url": "https://api.github.com/users/TuomLarsen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TuomLarsen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-27T06:30:18Z"
    }
  ]
}